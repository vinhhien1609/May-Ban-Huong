define(["require","exports","react","./e_file_viewer_edison_shmodel_file_async","./c_tslib","./c_file_viewer_components_titlebar_menu_content","./e_edison","./c_apex-metrics_src_types","./e_core_exception","./c_core_exception_info","./c_lodash-es_lodash","./c_core_i18n","./c_src_sink_index","./c_init_data_runtime","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","metaserver/static/js/langpack","./c_core_notify","react-dom","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","./c_core_xhr","./c_csrf","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/fingerprintjs_constants","metaserver/static/js/modules/constants/sharing","./c_security_util","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/constants/pdf_editing","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/unity","metaserver/static/js/modules/constants/files_spa"],(function(e,i,t,n,o,s,a,r,c,d,l,u,p,g,A,_,f,v,y,b,T,m,w,O,C,h,E,L,P,S,U,M,I,x,R,k,F){"use strict";function j(e){if(e&&e.__esModule)return e;var i=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),i.default=e,Object.freeze(i)}var V=j(t);n.defineMessage({id:"fL9TKm",defaultMessage:"Edit"});const H=n.defineMessage({id:"1wQEUl",defaultMessage:"Rotate right"}),D=n.defineMessage({id:"2BgLiN",defaultMessage:"Rotate left"}),N=n.defineMessage({id:"tupnL9",defaultMessage:"Crop"}),G=n.defineMessage({id:"VghM9c",defaultMessage:"Flip"}),z=n.defineMessage({id:"nUBVPc",defaultMessage:"Adjust"}),B=(e,i,t,o)=>{const s=i&&"ON"===(null==o?void 0:o.previews_exp_ungate_image_edit);return!i||s?e:(e=>{const{action:i,encryptionOptions:t}=e;return n.loggedOutSUSIAndActionContinuationHandler(i,n.PreviewType.Image,t)})(t)},q=n.withActionCondition(n.imageEditingActionCondition,((e,i,t)=>(({sdkConfig:e,logUserAction:i,navigation:t},o,s)=>[{icon:n.ShapeRotateLeftLine,label:D,userAction:n.UserAction.RotateLeft,disabled:{disabled:!1},action:{type:"click",handler:B(n.onRotate(t,n.RotationDirection.LEFT,i,n.UserActionContext.EditMenu),o,{action:{action:"edit",initialAction:"rotateLeft"},encryptionOptions:s},e)}},{icon:n.ShapeRotateRightLine,label:H,userAction:n.UserAction.RotateRight,disabled:{disabled:!1},action:{type:"click",handler:B(n.onRotate(t,n.RotationDirection.RIGHT,i,n.UserActionContext.EditMenu),o,{action:{action:"edit",initialAction:"rotateRight"},encryptionOptions:s},e)}},{icon:n.FlipHorizontalLine,label:G,userAction:n.UserAction.FlipHorizontal,disabled:{disabled:!1},action:{type:"click",handler:B(n.onFlip(t,i,n.UserActionContext.EditMenu),o,{action:{action:"edit",initialAction:"flip"},encryptionOptions:s},e)}},{icon:n.CropLine,label:N,userAction:n.UserAction.Crop,disabled:{disabled:!1},action:{type:"click",handler:B(n.onCrop(t,i,n.UserActionContext.EditMenu),o,{action:{action:"edit",initialAction:"crop"},encryptionOptions:s},e)}},{icon:n.SliderLine,label:z,userAction:n.UserAction.Adjust,disabled:{disabled:!1},action:{type:"click",handler:B(n.onAdjust(t,i,n.UserActionContext.EditMenu),o,{action:{action:"edit",initialAction:"adjust"},encryptionOptions:s},e)}}])(i,!e.user,t)),[]),K=n.withActionCondition(n.selfSignActionCondition,((i,t,o,s,a)=>{if(s||a)return;const r=n.getSelfSignActionArgs(t,i.user,i.file,o,n.UserActionContext.EditMenu);return{label:n.SELF_SIGN_ACTION_STRING,icon:n.SignatureLine,userAction:n.UserAction.SelfSign,disabled:{disabled:!1},action:{type:"click",handler:()=>new Promise((function(i,t){e(["./c_action_plugins_self_sign_action_action"],i,t)})).then((({selfSignAction:e})=>e(r)))}}}),void 0),Q=n.withActionCondition(n.sendForSignatureActionCondition,((i,t,o,s,a)=>{if(s||a)return;const r=n.getActionArgs(t,i.user,i.file,o);return{label:n.SEND_FOR_SIGNATURE_ACTION_STRING,icon:n.SendLine,userAction:n.UserAction.SendForSignature,disabled:{disabled:!1},action:{type:"click",handler:()=>new Promise((function(i,t){e(["./c_action_plugins_send_for_signature_action_action"],i,t)})).then((({sendForSignatureAction:e})=>e(r)))}}}),void 0),W=(e,i,t)=>{if(!i)return e;const{action:o,encryptionOptions:s,previewType:a}=t;return n.loggedOutSUSIAndActionContinuationHandler(o,a,s)},Z=({loggedOut:e,encryptionOptions:i,previewType:t})=>({icon:n.CutLine,label:n.loggedOutEditButtonText,userAction:n.UserAction.VideoEdit,disabled:{disabled:!1},action:{type:"click",handler:W((()=>o.__awaiter(void 0,void 0,void 0,(function*(){}))),e,{action:{action:"edit"},encryptionOptions:i,previewType:t})}}),J=({context:e,loggedOut:i,encryptionOptions:t})=>[{icon:n.ShapeRotateLeftLine,label:n.ROTATE_LEFT_TOOLTIP,userAction:n.UserAction.RotateLeft,disabled:{disabled:!1},action:{type:"click",handler:W(n.rotateLeftHandler(e,n.UserActionContext.EditMenu),i,{action:{action:"edit",initialAction:"rotateLeft"},encryptionOptions:t,previewType:n.PreviewType.Video})}},{icon:n.ShapeRotateRightLine,label:n.ROTATE_RIGHT_TOOLTIP,userAction:n.UserAction.RotateRight,disabled:{disabled:!1},action:{type:"click",handler:W(n.rotateRightHandler(e,n.UserActionContext.EditMenu),i,{action:{action:"edit",initialAction:"rotateRight"},encryptionOptions:t,previewType:n.PreviewType.Video})}}],X=({context:e,loggedOut:i,encryptionOptions:t})=>[{icon:n.FlipHorizontalLine,label:n.FLIP_HORIZONTAL_LABEL,userAction:n.UserAction.FlipHorizontal,disabled:{disabled:!1},action:{type:"click",handler:W(n.flipHorizontalHandler(e,n.UserActionContext.EditMenu),i,{action:{action:"edit",initialAction:"flipHorizontal"},encryptionOptions:t,previewType:n.PreviewType.Video})}},{icon:n.FlipVerticalLine,label:n.FLIP_VERTICAL_LABEL,userAction:n.UserAction.FlipVertical,disabled:{disabled:!1},action:{type:"click",handler:W(n.flipVerticalHandler(e,n.UserActionContext.EditMenu),i,{action:{action:"edit",initialAction:"flipVertical"},encryptionOptions:t,previewType:n.PreviewType.Video})}}],Y=({context:e,encryptionOptions:i,loggedOut:t})=>({icon:n.CropLine,label:n.CROP_TOOLTIP,disabled:{disabled:!1},userAction:n.UserAction.Crop,action:{type:"click",handler:W(n.cropHandler(e,n.UserActionContext.EditMenu),t,{action:{action:"edit",initialAction:"crop"},encryptionOptions:i,previewType:n.PreviewType.Video})}}),$=({context:e,loggedOut:i,encryptionOptions:t,previewType:o})=>({icon:n.CutLine,label:n.TRIM_TOOLTIP,userAction:n.UserAction.Trim,disabled:{disabled:!1},action:{type:"click",handler:W(n.trimHandler(e,n.UserActionContext.EditMenu),i,{action:{action:"edit",initialAction:"trim"},encryptionOptions:t,previewType:o})}}),ee=(e,i,t)=>{if(!(n.isLoggedOutVideoEditEnabled(i.sdkConfig,e.previewType)&&n.getActionCondition(e,n.audioVideoEditingLoggedOutActionCondition)||n.getActionCondition(e,n.audioVideoEditingActionCondition)))return[];const o=e.previewType===n.PreviewType.Video,s="ON"===i.sdkConfig.previews_exp_audio_trimming_str&&e.previewType===n.PreviewType.Audio;return o?ie(i,!e.user,t):s?te(i,!e.user,t):[]},ie=(e,i,t)=>{const o={context:e,loggedOut:i,encryptionOptions:t,previewType:n.PreviewType.Video};return o.loggedOut&&"V1"===e.sdkConfig.previews_exp_logged_out_audio_video_editing?[Z(o)]:[$(o),Y(o),...J(o),...X(o)]},te=(e,i,t)=>{const o={context:e,loggedOut:i,encryptionOptions:t,previewType:n.PreviewType.Video};return o.loggedOut&&"V1"===o.context.sdkConfig.previews_exp_logged_out_audio_video_editing?[Z(o)]:[$(o)]},ne=n.withActionCondition(n.pdfEditActionCondition,((i,t,o,s)=>{const a="ON"===t.sdkConfig.previews_exp_ungate_pdf_edit;return i.user||a?[{label:n.EDIT_PDF_ACTION_STRING,icon:n.EditLine,userAction:n.UserAction.EditPdf,disabled:{disabled:!1},action:{type:"click",handler:()=>new Promise((function(i,t){e(["./c_action_plugins_pdf_edit_action_action"],i,t)})).then((({pdfEditAction:e})=>e({setActiveEditPlugin:t.navigation.setActiveEditPlugin,logUserAction:t.logUserAction,getCurrentPage:o},n.UserActionContext.EditMenu)))}}]:[{icon:n.EditLine,label:n.EDIT_PDF_ACTION_STRING,userAction:n.UserAction.EditPdf,disabled:{disabled:!1},action:{type:"click",handler:n.loggedOutSUSIAndActionContinuationHandler({action:"edit"},n.PreviewType.SsrDoc,s)}},{icon:n.ScribbleLine,userAction:n.UserAction.Draw,disabled:{disabled:!1},label:n.defineMessage({id:"7E2+UP",defaultMessage:"Draw"}),action:{type:"click",handler:n.loggedOutSUSIAndActionContinuationHandler({action:"edit"},n.PreviewType.SsrDoc,s)}},{icon:n.HighlightLine,userAction:n.UserAction.Highlight,disabled:{disabled:!1},label:n.defineMessage({id:"e7+jFI",defaultMessage:"Highlight"}),action:{type:"click",handler:n.loggedOutSUSIAndActionContinuationHandler({action:"edit"},n.PreviewType.SsrDoc,s)}},{icon:n.TextBoxLine,userAction:n.UserAction.AddText,disabled:{disabled:!1},label:n.defineMessage({id:"B1Oo3m",defaultMessage:"Add text"}),action:{type:"click",handler:n.loggedOutSUSIAndActionContinuationHandler({action:"edit"},n.PreviewType.SsrDoc,s)}}]}),[]),oe=n.withActionCondition(n.watermarkActionCondition,((e,i)=>({label:n.defineMessage({id:"MqyPTe",defaultMessage:"Watermark"}),userAction:n.UserAction.Watermark,disabled:{disabled:!1},icon:n.StampLine,action:{type:"click",handler:()=>o.__awaiter(void 0,void 0,void 0,(function*(){return i.navigation.setActiveEditPlugin(n.WATERMARKING_PLUGIN_ID,n.UserActionContext.EditMenu)}))}})),void 0);i.default=({contentProps:e,setMenuDisabled:i})=>{var t;const o=n.useIntl(),{pluginArgs:a,previewSurface:r}=n.usePluginMigrationContext(),{pluginContext:c,fileViewerId:d,logUserAction:l}=n.useFileViewerContext(),u=n.useFileViewerSelector(n.getCurrentPreviewKey,d),p=n.useCurrentPreviewMetadata(),g=null!==(t=p.previewType)&&void 0!==t?t:n.PreviewType.Loading,A=a.getActiveFile().file,_=a.getActiveFile().sharePermission,f=n.usePageCount(u,p),v=n.useFileViewerSelector(n.getCurrentFilePreviewUI,d),y=n.useStabilizedCallback((()=>{var e;return null===(e=n.filterDocFilePreviewUiState(v))||void 0===e?void 0:e.currentPageIndex})),{encryptionOptions:b,userHasDmtConflict:T,shouldDisableFeaturesIfTeamSuspended:m,user:w}=a,O=V.useMemo((()=>({file:A,user:w,previewSurface:r,previewType:g,sharePermission:_,previewKey:u})),[A,w,r,g,_,u]),C=V.useMemo((()=>[[...ne(O,c,y,b),...q(O,c,b),...ee(O,c,b)],[oe(O,c),K(O,c,f,T,m),Q(O,c,f,T,m)]]),[O,c,y,b,f,T,m]),h=n.useRootFile(),E=n.useAudioVideoEditDisabledTooltipMsg(null==h?void 0:h.name,null==h?void 0:h.size),L=g===n.PreviewType.Image||n.isLoggedOutVideoEditEnabled(c.sdkConfig,g)||g===n.PreviewType.SsrDoc;let P;const S=C.every((e=>e.every((e=>!e))));E?P=E:n.isDownloadPluginEnabled(A,_)?a.user||L?S&&(P=o.formatMessage({id:"qURjdV",defaultMessage:"Not available for this file"})):P=o.formatMessage({id:"8QvtQB",defaultMessage:"Log in or sign up to edit"}):P=o.formatMessage(n.DISABLED_FOR_THIS_FILE_TOOLTIP_STRING),V.useEffect((()=>{i({disabled:!!P,tooltip:P})}),[i,C,P]);const U=V.useCallback((e=>l(e,n.UserActionContext.EditMenu)),[l]);return V.createElement(s.TitlebarMenuContent,{contentProps:e,elementId:"edit-menu",options:C,logAction:U})}}));
//# sourceMappingURL=c_titlebar_dropdowns_titlebar_edit_dropdown.js-vflB4vtD-.map
