define(["exports","./c_tslib","react","./e_file_viewer_edison_shmodel_file_async","./c_sdk_file_viewer_preview_tour_tracker","./c_src_sink_index","./c_growth_ui_api","./c_browse_welcome_hub_lib_types","./e_edison","./c_apex-metrics_src_types","./e_core_exception","./c_core_exception_info","./c_lodash-es_lodash","./c_core_i18n","./c_init_data_runtime","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","metaserver/static/js/langpack","./c_core_notify","react-dom","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","./c_core_xhr","./c_csrf","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/fingerprintjs_constants","metaserver/static/js/modules/constants/sharing","./c_security_util","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/constants/pdf_editing","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/unity","metaserver/static/js/modules/constants/files_spa","./c_combinations_index","./c_growth_user_action_tracker"],(function(e,t,o,i,s,r,n,a,l,c,d,u,_,v,p,m,g,T,f,y,h,S,w,E,b,k,C,j,P,I,x,R,A,O,N,L,M,B,W,F){"use strict";function G(e){return e&&e.__esModule?e:{default:e}}var D=G(o);function H(e,o){return t.__awaiter(this,void 0,void 0,(function*(){if(e)try{yield e.track(o)}catch(e){r.getMetricsReporter().createStats({ns:"preview_tour",name:"track_action_failed"}).record(1)}}))}const V=({file:e,shareToken:r,user:l,linkOwnerName:c})=>{var d;const u=i.getExtension(e),[_,v]=o.useState(!1),[p,m]=o.useState(0),[g,T]=o.useState(!1),f=o.useRef(!1),y=()=>{l||window.localStorage.setItem("rrc_tooltip_tour_engaged","true")};let h;l&&(h=new s.PreviewTooltipTourTracker(l.id)),o.useEffect((()=>{f.current?T(!0):f.current=!0}),[e]),o.useEffect((()=>{(null==l?void 0:l.id)&&_&&(n.markModuleAsCompleted(null==l?void 0:l.id,a.ActivationTileMilestoneId.SEE_PREVIEW_TOUR),i.dispatchElementShown("browse-welcome-hub-edit-files-completion"))}),[null==l?void 0:l.id,_]);const S=i.getTooltipTourFileType(u),w=(e=>e?i.TooltipTourSurface.sharingLoggedInM0:i.TooltipTourSurface.sharingLoggedOutM0)(l),E=i.TooltipTourConfig[w][S],b=(()=>{if(_)return E[p];const e=S!==i.TooltipTourFileType.default&&l;return r.linkType===i.SharedLinkType.Content?e?i.PreviewTourTooltipType.SCLSharingEntrypointWithEditableFile:i.PreviewTourTooltipType.SCLSharingEntrypointWithNonEditableFile:e?i.PreviewTourTooltipType.ShmodelSharingEntrypointWithEditableFile:i.PreviewTourTooltipType.ShmodelSharingEntrypointWithNonEditableFile})(),k=i.TooltipTypeConfig[b],C=_?p+1:0,j=_?E.length:0,P=1===j,I=C===j,x=P?{}:{currentStep:C,totalSteps:j},R=D.default.useCallback(((t,o)=>{o.file_id=null==e?void 0:e.file_id,o.file_ext=u;const s=r.linkType===i.SharedLinkType.Shmodel?i.ShareTibEventLogger.get_shmodel_extra_for_logging(r,i.get_href()):i.ShareTibEventLogger.get_scl_extra_for_logging(r,i.get_href());o=Object.assign(Object.assign({},o),s),l?i.ShareTibEventLogger.log(l.id,t,i.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE,o):i.ShareTibEventLogger.log_unauth(t,i.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE,o)}),[r,l,e,u]);o.useEffect((()=>{R(i.TiburonEventName.RRCReceiverPreviewsTooltipTourView,{tour_surface:w,tooltip:b,current_step:C,total_steps:j})}),[w,b,C,j,R]);const A=e=>{R(i.TiburonEventName.RRCReceiverPreviewsTooltipTourClick,{tour_surface:w,tooltip:b,current_step:C,total_steps:j,cta_type:e})},O=((e,t,o)=>o?e||t?"gotit":"next":"showMe")(P,I,_);let N=k?s.getNodeByTooltipDataSelector(k.selector):void 0;const L=o.useMemo((()=>{if(N){const e=window.getComputedStyle(N),t={};return(null==k?void 0:k.additionalStyles)&&Object.keys(null==k?void 0:k.additionalStyles).forEach((o=>t[o]=e.getPropertyValue(o))),Object.assign({zIndex:e.zIndex,backgroundColor:e.backgroundColor,position:e.position,padding:e.padding},t)}}),[N]),M=()=>{var e;if(N&&L){let t;for(t in L){if(null===(e=null==k?void 0:k.stylesToPreserve)||void 0===e?void 0:e.includes(t))continue;const o=L[t];N.style[t]=null!=o?o:""}}};o.useEffect((()=>M),[]);const B=D.default.useCallback((()=>t.__awaiter(void 0,void 0,void 0,(function*(){T(!0),i.setCachedUserSeenTour(!0),yield H(h,s.PreviewTooltipTourActions.DISMISS)}))),[h]);o.useEffect((()=>N&&_&&k.shouldDismissTourOnClickInsideHighlights?(N.addEventListener("click",B),()=>{N.removeEventListener("click",B)}):()=>{}),[N,_,h,k,B]),o.useEffect((()=>{if(N&&_){const e=new MutationObserver((e=>{N&&!document.body.contains(N)&&B()}));return e.observe(document.body,{childList:!0,subtree:!0}),()=>e.disconnect()}return()=>{}}),[N,_,h,k,B]);const W=()=>{var e;if(N=s.getNodeByTooltipDataSelector(k.selector),N){const t=window.getComputedStyle(N).position,o=Object.assign({zIndex:"1",backgroundColor:"var(--dig-color__background__raised)",padding:"8px",position:"static"===t?"relative":t},null==k?void 0:k.additionalStyles);let i;for(i in o)(null===(e=null==k?void 0:k.stylesToPreserve)||void 0===e?void 0:e.includes(i))||(N.style[i]=o[i])}},F=()=>{y(),M(),I?T(!0):m((e=>e+1)),A(O)},G=()=>t.__awaiter(void 0,void 0,void 0,(function*(){y(),M(),T(!0),i.setCachedUserSeenTour(!0),yield H(h,s.PreviewTooltipTourActions.DISMISS)})),V="skip",U=()=>{G(),A(V)},z=()=>t.__awaiter(void 0,void 0,void 0,(function*(){y(),v(!0),i.setCachedUserSeenTour(!0),A(O),yield H(h,s.PreviewTooltipTourActions.START)}));return null===(d=k.extraAction)||void 0===d||d.call(k),g?null:_?D.default.createElement(s.ActivationTooltip,Object.assign({},k,{primaryButtonType:O,onPrimaryButtonClick:F,onTooltipClose:G,onComponentWillAnchor:W,disableClicksOutside:!0},x)):D.default.createElement("div",{"data-testid":"sharing-preview-tour-entrypoint-tooltip"},D.default.createElement(s.ActivationTooltip,Object.assign({},k,{titleFormatter:{linkOwnerName:c},primaryButtonType:O,onPrimaryButtonClick:z,secondaryButtonType:V,onSecondaryButtonClick:U})))};V.displayName="SharingPreviewTour",e.SharingPreviewTour=V}));
//# sourceMappingURL=c_sdk_file_viewer_preview_tour_sharing_tour.js-vflhZRboo.map
