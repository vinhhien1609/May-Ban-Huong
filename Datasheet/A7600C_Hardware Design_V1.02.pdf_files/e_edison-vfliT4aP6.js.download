define(["require","exports","./c_tslib","./c_browser_browser_detection"],(function(e,t,r,n){"use strict";var s,i;!function(e){e[e.Unary=0]="Unary",e[e.ServerStreaming=1]="ServerStreaming",e[e.ClientStreaming=2]="ClientStreaming",e[e.BiDiStreaming=3]="BiDiStreaming"}(s||(s={})),function(e){e[e.NoSideEffects=1]="NoSideEffects",e[e.Idempotent=2]="Idempotent"}(i||(i={}));class a extends n.Message{constructor(e){super(),this.typeUrl="",this.value=new Uint8Array(0),n.proto3.util.initPartial(e,this)}toJson(e){var t;if(""===this.typeUrl)return{};const r=this.typeUrlToName(this.typeUrl),n=null===(t=null==e?void 0:e.typeRegistry)||void 0===t?void 0:t.findMessage(r);if(!n)throw new Error(`cannot encode message google.protobuf.Any to JSON: "${this.typeUrl}" is not in the type registry`);let s=n.fromBinary(this.value).toJson(e);return(r.startsWith("google.protobuf.")||null===s||Array.isArray(s)||"object"!=typeof s)&&(s={value:s}),s["@type"]=this.typeUrl,s}fromJson(e,t){var r;if(null===e||Array.isArray(e)||"object"!=typeof e)throw new Error("cannot decode message google.protobuf.Any from JSON: expected object but got "+(null===e?"null":Array.isArray(e)?"array":typeof e));if(0==Object.keys(e).length)return this;const n=e["@type"];if("string"!=typeof n||""==n)throw new Error('cannot decode message google.protobuf.Any from JSON: "@type" is empty');const s=this.typeUrlToName(n),i=null===(r=null==t?void 0:t.typeRegistry)||void 0===r?void 0:r.findMessage(s);if(!i)throw new Error(`cannot decode message google.protobuf.Any from JSON: ${n} is not in the type registry`);let a;if(s.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(e,"value"))a=i.fromJson(e.value,t);else{const r=Object.assign({},e);delete r["@type"],a=i.fromJson(r,t)}return this.packFrom(a),this}packFrom(e){this.value=e.toBinary(),this.typeUrl=this.typeNameToUrl(e.getType().typeName)}unpackTo(e){return!!this.is(e.getType())&&(e.fromBinary(this.value),!0)}is(e){return this.typeUrl===this.typeNameToUrl(e.typeName)}typeNameToUrl(e){return`type.googleapis.com/${e}`}typeUrlToName(e){if(!e.length)throw new Error(`invalid type url: ${e}`);const t=e.lastIndexOf("/"),r=t>0?e.substring(t+1):e;if(!r.length)throw new Error(`invalid type url: ${e}`);return r}static pack(e){const t=new a;return t.packFrom(e),t}static fromBinary(e,t){return(new a).fromBinary(e,t)}static fromJson(e,t){return(new a).fromJson(e,t)}static fromJsonString(e,t){return(new a).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(a,e,t)}}a.runtime=n.proto3,a.typeName="google.protobuf.Any",a.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}]));const o={DEBUG:!1,IDLE_TIMEOUT:200,NETWORK_TIMEOUT:6e4};class c{static format(...e){return["[ttvc]",...e,"::",performance.now()]}static debug(...e){o.DEBUG&&console.debug(...this.format(...e))}static info(...e){o.DEBUG&&console.info(...this.format(...e))}static warn(...e){o.DEBUG&&console.warn(...this.format(...e))}}class d{constructor(){this.pendingRequests=0,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{c.debug("AjaxIdleObservable.next()",e),this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{if(0===o.NETWORK_TIMEOUT)return;this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{c.warn("AjaxIdleObservable","::","Timed out waiting for requests to resolve.","Make sure that incrementAjaxCount() is always matched with decrementAjaxCount().","::","pendingRequests =",this.pendingRequests),this.didNetworkTimeOut=!0,this.pendingRequests=0,this.next("IDLE")}),o.NETWORK_TIMEOUT)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.increment=()=>{this.startCleanupTimeout(),0===this.pendingRequests&&this.next("BUSY"),this.pendingRequests+=1},this.decrement=()=>{this.abortCleanupTimeout(),1===this.pendingRequests?this.next("IDLE"):this.startCleanupTimeout(),this.pendingRequests=Math.max(this.pendingRequests-1,0),this.pendingRequests<10&&c.debug("AjaxIdleObservable.decrement()","::","pendingRequests =",this.pendingRequests)},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}}}}class l{constructor(){this.pendingResources=new Set,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{c.debug("ResourceLoadingIdleObservable.next()",e),this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{if(0===o.NETWORK_TIMEOUT)return;this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{c.warn("ResourceLoadingIdleObservable","::","Timed out waiting for resources to resolve.","Consider filing a bug report if this continues to occur.","::","pendingResources =",this.pendingResources),this.didNetworkTimeOut=!0,this.pendingResources=new Set,this.next("IDLE")}),o.NETWORK_TIMEOUT)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.add=e=>{e instanceof HTMLImageElement&&!e.src||e instanceof HTMLImageElement&&e.complete||e instanceof HTMLLinkElement&&!e.href||e instanceof HTMLScriptElement&&!e.src||e instanceof HTMLIFrameElement&&!e.src||(this.startCleanupTimeout(),0===this.pendingResources.size&&this.next("BUSY"),this.pendingResources.add(e))},this.remove=e=>{this.abortCleanupTimeout(),this.pendingResources.delete(e),0===this.pendingResources.size?this.next("IDLE"):this.startCleanupTimeout(),this.pendingResources.size<10&&c.debug("ResourceLoadingIdleObservable.remove()","::","pendingResources =",this.pendingResources)},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},"undefined"!=typeof window&&(null===window||void 0===window?void 0:window.MutationObserver)&&window.addEventListener("load",(()=>{new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof HTMLScriptElement||e instanceof HTMLLinkElement||e instanceof HTMLImageElement||e instanceof HTMLIFrameElement?this.add(e):e.hasChildNodes()&&e instanceof HTMLElement&&e.querySelectorAll("img").forEach(this.add)}))}))})).observe(window.document.documentElement,{childList:!0,subtree:!0}),["load","error"].forEach((e=>{window.document.addEventListener(e,(e=>{(e.target instanceof HTMLScriptElement||e.target instanceof HTMLLinkElement||e.target instanceof HTMLImageElement||e.target instanceof HTMLIFrameElement)&&this.remove(e.target)}),{capture:!0})}))}))}}class u{constructor(){this.ajaxIdleObservable=new d,this.resourceLoadingIdleObservable=new l,this.subscribers=new Set,this.ajaxIdle=!0,this.scriptLoadingIdle=!0,this.handleUpdate=e=>t=>{const r=this.ajaxIdle&&this.scriptLoadingIdle;"AJAX"===e&&(this.ajaxIdle="IDLE"===t),"RESOURCE_LOADING"===e&&(this.scriptLoadingIdle="IDLE"===t);const n=this.ajaxIdle&&this.scriptLoadingIdle;r!==n&&this.next(n?"IDLE":"BUSY")},this.next=e=>{c.debug("NetworkIdleObservable.next()",e),this.subscribers.forEach((t=>t(e)))},this.incrementAjaxCount=()=>this.ajaxIdleObservable.increment(),this.decrementAjaxCount=()=>this.ajaxIdleObservable.decrement(),this.isIdle=()=>this.ajaxIdle&&this.scriptLoadingIdle,this.didNetworkTimeOut=()=>this.ajaxIdleObservable.didNetworkTimeOut||this.resourceLoadingIdleObservable.didNetworkTimeOut,this.resetDidNetworkTimeOut=()=>{this.ajaxIdleObservable.didNetworkTimeOut=!1,this.resourceLoadingIdleObservable.didNetworkTimeOut=!1},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},this.ajaxIdleObservable.subscribe(this.handleUpdate("AJAX")),this.resourceLoadingIdleObservable.subscribe(this.handleUpdate("RESOURCE_LOADING"))}}let m;const h=()=>(m||(m=new u),m);class g{constructor(e){this.mutationObserverConfig={attributeFilter:["hidden","style","src"],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0},this.mutations=new Map,this.mutationObserverCallback=e=>{c.debug("InViewportMutationObserver.mutationObserverCallback()","::","mutations =",e),e.forEach((e=>{e.timestamp=performance.now();let t=null;if(e.target instanceof Element&&(t=e.target),e.target instanceof Text&&(t=e.target.parentElement),t)if("childList"===e.type)e.addedNodes.forEach((t=>{t instanceof HTMLElement&&(this.intersectionObserver.observe(t),this.mutations.set(t,e)),t instanceof Text&&null!=t.parentElement&&(this.intersectionObserver.observe(t.parentElement),this.mutations.set(t.parentElement,e))}));else this.intersectionObserver.observe(t),this.mutations.set(t,e)}))},this.intersectionObserverCallback=e=>{c.debug("InViewportMutationObserver.intersectionObserverCallback()","::","entries =",e),e.forEach((e=>{const t=this.mutations.get(e.target);e.isIntersecting&&null!=t&&(c.info("InViewportMutationObserver.callback()","::","mutation =",t),this.callback(t)),this.mutations.delete(e.target),this.intersectionObserver.unobserve(e.target)}))},this.callback=e,this.mutationObserver=new MutationObserver(this.mutationObserverCallback),this.intersectionObserver=new IntersectionObserver(this.intersectionObserverCallback)}observe(e){c.info("InViewportMutationObserver.observe()","::","target =",e),this.mutationObserver.observe(e,this.mutationObserverConfig)}disconnect(){c.info("InViewportMutationObserver.disconnect()"),this.mutationObserver.disconnect(),this.intersectionObserver.disconnect()}}function f(e){const t=h();let r,n=t.isIdle();const s=e=>{n="IDLE"===e,n?(e=>{var t;(null!==(t=window.requestIdleCallback)&&void 0!==t?t:window.setTimeout)((()=>{window.requestAnimationFrame((()=>window.requestAnimationFrame(e)))}))})(i):(window.clearTimeout(r),r=void 0)},i=()=>{c.debug("requestAllIdleCallback.handleCpuIdle()"),n&&!r&&a()},a=()=>{r=window.setTimeout((()=>{const r=t.didNetworkTimeOut();t.resetDidNetworkTimeOut(),c.info("requestAllIdleCallback: ALL IDLE"),e(r),d()}),o.IDLE_TIMEOUT)},d=t.subscribe(s);n&&s("IDLE")}class p{constructor(e){this.imageLoadTimes=new Map,this.lastImageLoadTimestamp=0,this.intersectionObserverCallback=e=>{e.forEach((e=>{const t=e.target,r=this.imageLoadTimes.get(t);e.isIntersecting&&null!=r&&(c.info("InViewportImageObserver.callback()","::","timestamp =",r),this.callback(r,t)),this.intersectionObserver.unobserve(t),this.imageLoadTimes.delete(t)}))},this.handleLoadOrErrorEvent=e=>{(e.target instanceof HTMLImageElement||e.target instanceof HTMLIFrameElement)&&(c.debug("InViewportImageObserver.handleLoadOrErrorEvent()","::","event =",e),this.imageLoadTimes.set(e.target,e.timeStamp),this.intersectionObserver.observe(e.target))},this.callback=e,this.intersectionObserver=new IntersectionObserver(this.intersectionObserverCallback)}observe(){c.info("InViewportImageObserver.observe()"),document.addEventListener("load",this.handleLoadOrErrorEvent,{capture:!0}),document.addEventListener("error",this.handleLoadOrErrorEvent,{capture:!0})}disconnect(){c.info("InViewportImageObserver.disconnect()"),this.lastImageLoadTimestamp=0,this.imageLoadTimes.clear(),this.intersectionObserver.disconnect(),document.removeEventListener("load",this.handleLoadOrErrorEvent),document.removeEventListener("error",this.handleLoadOrErrorEvent)}}const w=()=>{var e;return(null===(e=window.performance.getEntriesByType("navigation")[0])||void 0===e?void 0:e.type)||(()=>{const e=window.performance.navigation.type;return 2===e?"back_forward":1===e?"reload":"navigate"})()},v=()=>{var e;return(null===(e=window.performance.getEntriesByType("navigation")[0])||void 0===e?void 0:e.activationStart)||0};class y{constructor(){if(this.debug=!1,this.idleTimeout=200,this.lastImageLoadTimestamp=-1,this.navigationCount=0,this.successSubscribers=new Set,this.errorSubscribers=new Set,this.onTTVC=(e,t)=>(this.successSubscribers.add(e),t&&this.errorSubscribers.add(t),()=>{this.successSubscribers.delete(e),t&&this.errorSubscribers.delete(t)}),!y.isSupportedEnvironment())throw new Error("VisuallyCompleteCalculator: This browser/runtime is not supported.");this.inViewportMutationObserver=new g((e=>{var t,r,n;(null!==(t=e.timestamp)&&void 0!==t?t:0)>=(null!==(n=null===(r=this.lastMutation)||void 0===r?void 0:r.timestamp)&&void 0!==n?n:0)&&(this.lastMutation=e)})),this.inViewportImageObserver=new p(((e,t)=>{e>=this.lastImageLoadTimestamp&&(this.lastImageLoadTimestamp=e,this.lastImageLoadTarget=t)}))}static isSupportedEnvironment(){var e;return void 0!==window&&"MutationObserver"in window&&"IntersectionObserver"in window&&"function"==typeof document.querySelectorAll&&(null===(e=window.performance)||void 0===e?void 0:e.timing)}cancel(e){c.info("VisuallyCompleteCalculator.cancel()","::","index =",this.activeMeasurementIndex),this.activeMeasurementIndex&&this.error({start:v(),end:performance.now(),cancellationReason:"MANUAL_CANCELLATION",eventType:e,navigationType:w(),lastVisibleChange:this.getLastVisibleChange()}),this.activeMeasurementIndex=void 0}async start(e=0,t=!1){var r,n;const s=this.navigationCount+=1;this.activeMeasurementIndex=s,c.info("VisuallyCompleteCalculator.start()","::","index =",s);let i=t?"back_forward":e>0?"script":w();const a=v();a>e&&(e=a,i="prerender");const o=(t,r)=>{this.activeMeasurementIndex===s&&(this.activeMeasurementIndex=void 0,this.error({start:e,end:performance.now(),cancellationReason:r,eventType:t.type,eventTarget:t.target||void 0,navigationType:i,lastVisibleChange:this.getLastVisibleChange()}))},d=e=>o(e,"USER_INTERACTION"),l=e=>o(e,"NEW_NAVIGATION"),u=e=>o(e,"VISIBILITY_CHANGE");this.inViewportImageObserver.observe(),this.inViewportMutationObserver.observe(document.documentElement),window.addEventListener("pagehide",l),window.addEventListener("visibilitychange",u),window.setTimeout((()=>{window.addEventListener("click",d),window.addEventListener("keydown",d)}),0),await("complete"===document.readyState?Promise.resolve():new Promise((e=>{const t=()=>{e(),window.removeEventListener("load",t)};window.addEventListener("load",t)})));const m=await new Promise(f);if(s===this.activeMeasurementIndex){const t=Math.max(e,this.lastImageLoadTimestamp,null!==(n=null===(r=this.lastMutation)||void 0===r?void 0:r.timestamp)&&void 0!==n?n:0);this.next({start:e,end:t,duration:t-e,detail:{navigationType:i,didNetworkTimeOut:m,lastVisibleChange:this.getLastVisibleChange()}})}else c.debug("VisuallyCompleteCalculator: Measurement discarded","::","index =",s),this.activeMeasurementIndex&&this.error({start:e,end:performance.now(),cancellationReason:"NEW_NAVIGATION",navigationType:i,lastVisibleChange:this.getLastVisibleChange()});window.removeEventListener("pagehide",l),window.removeEventListener("visibilitychange",u),window.removeEventListener("click",d),window.removeEventListener("keydown",d),s===this.navigationCount&&(this.inViewportImageObserver.disconnect(),this.inViewportMutationObserver.disconnect())}next(e){var t,r;e.end>Number.MAX_SAFE_INTEGER?c.warn("VisuallyCompleteCalculator.next()","::","This browser reported a time larger than MAX_SAFE_INTEGER. We are ignoring it.","::",e):(c.debug("VisuallyCompleteCalculator.next()","::","lastImageLoadTimestamp =",this.lastImageLoadTimestamp,"lastMutationTimestamp =",null!==(r=null===(t=this.lastMutation)||void 0===t?void 0:t.timestamp)&&void 0!==r?r:0,"::","index =",this.activeMeasurementIndex),c.info("TTVC:",e,"::","index =",this.activeMeasurementIndex),this.successSubscribers.forEach((t=>t(e))))}error(e){c.debug("VisuallyCompleteCalculator.error()","::","cancellationReason =",e.cancellationReason,"::","eventType =",e.eventType||"none","::","index =",this.activeMeasurementIndex),this.errorSubscribers.forEach((t=>t(e)))}getLastVisibleChange(){var e,t;return this.lastImageLoadTimestamp>(null!==(t=null===(e=this.lastMutation)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:0)?this.lastImageLoadTarget:this.lastMutation}}let b;let E;const P=h().incrementAjaxCount,T=h().decrementAjaxCount;function _(e,t,r={}){if(e)return;const n=new Error(`Assertion Error: ${t}`),{tags:s=[],exc_extra:i=null}=r;throw n.assertOptions={tags:s.concat("module:exception","assert"),exc_extra:i},n.isAssertion=!0,n}const S=/^(?:([^:\/\\?#]+):)?(?:[\/\\]{2}([^\/\\?#]*))?([^?#]*)(?:\?([^#]*))?(?:[#](.*))?$/,I=/^[a-zA-Z][a-zA-Z0-9+.\-]*$/;class R{constructor(e={}){this.dict={},this.add(e)}static parseString(e){if(!e)return{};const t={};return e.split("&").forEach((e=>{if(""!==e){const r=e.split("="),n=R.decode(r[0]),s=R.decode(r.slice(1).join("="));if(t.hasOwnProperty(n)){const e=t[n];let r;r="string"==typeof e?[e]:void 0===e?[]:e,r.push(s),t[n]=r}else t[n]=s}})),t}add(e,t){if("string"==typeof e)t&&(Array.isArray(t)?this.dict[e]=t.map(String):this.dict[e]=String(t));else for(const t in e)if(e.hasOwnProperty(t)){const r=e[t];null!=r&&(Array.isArray(r)?this.dict[t]=r.map(String):this.dict[t]=String(r))}return this}remove(e){return delete this.dict[e],this}replace(e){return this.dict=e,this}toString(e){const t=[],r=Object.keys(this.dict).sort(e);for(const e of r)if(this.dict.hasOwnProperty(e)){const r=this.dict[e];Array.isArray(r)?r.forEach((r=>{t.push(R.encode(e)+"="+R.encode(r))})):t.push(R.encode(e)+"="+R.encode(r))}return t.length?t.join("&"):""}static decode(e){return null==e?"":O.decode(e.replace(/\+/g,"%20"))}static encode(e){return null==e?"":O.encode(e).replace(/%20/g,"+")}}class O{constructor(e={}){this.query=new R,this.initFromObject(e)}initFromObject(e){this.setScheme(e.scheme),this.authority=e.authority||"",this.path=e.path||"",this.setQuery(e.query),this.fragment=e.fragment||""}getScheme(){return this.scheme}getAuthority(){return this.authority}getPath(){return this.path}getQuery(){return this.query.dict}getFragment(){return this.fragment}setScheme(e=""){return _(!e||Boolean(e.match(I)),"Invalid scheme",{exc_extra:{scheme_param:e}}),this.scheme=e,this}setAuthority(e=""){return this.authority=e,this}setPath(e=""){return this.path=e,this}setQuery(e={}){return this.query=new R(e),this}setFragment(e=""){return this.fragment=e,this}updateQuery(e,t){return this.query.add(e,t),this}removeQuery(e){return this.query.remove(e),this}clone(){return new O(this.toObject())}toObject(){return{scheme:this.getScheme(),authority:this.getAuthority(),path:this.getPath(),query:this.getQuery(),fragment:this.getFragment()}}toString(e){let t="";return this.scheme&&(t+=this.scheme+":"),this.authority&&(t+="//"+O.encode(this.authority,":@[]")),t+this.toRelativeUri(e)}toRelativeUri(e){let t="";this.path&&(_(!this.authority||!this.path.length||"/"===this.path[0],'Path must start with a "/" if URI is not relative'),t+=O.encode(this.path,"/"));const r=this.query.toString(e);return r&&(t+="?"+r),this.fragment&&(t+="#"+O.encode(this.fragment,":@[]/&=+?#!")),t}static parse(e){const t=String(e).match(S)||[],[,r,n,s,i,a]=t,o=new O;return o.setScheme(r),o.setAuthority(O.decode(n)),o.setPath(O.decode(s)),o.setQuery(R.parseString(i)),o.setFragment(O.decode(a)),o}static decode(e){return e?decodeURIComponent(e):""}static encode(e,t=""){if(!e)return"";e=encodeURIComponent(e),t+="~";for(const r of t){const t=encodeURIComponent(r);e=e.replace(new RegExp(t,"g"),r)}return e}static encode_parts(e,t="/"){return e.split(t).map((e=>O.encode(e))).join(t)}}function C(e){return _(e.startsWith("/static/"),`'${e}' is not a /static url`),new O({scheme:"https",authority:"cfl.dropboxstatic.com",path:e}).toString()}O.Query=R;const L=["edison:preloadCss","js:requireCssWithComponent","js:require_css","loadCssWithCache","ensemble","CssEntryPoint","css-modules"],M=["css-modules"];function A(e,t,r){if(r[t].length>0){if(M.includes(t)){const n=r[t];for(let t=0;t<n.length;t++){const{elem:r,path:s}=n[t];if(s>e.path)return[r,t]}}return[r[t][r[t].length-1].elem.nextElementSibling,null]}const n=L.indexOf(t);for(let e=n-1;e>=0;e--){const t=r[L[e]]||[];if(t.length>0)return[t[t.length-1].elem.nextElementSibling,null]}for(let e=n+1;e<L.length;e++){const t=r[L[e]]||[];if(t.length>0)return[t[0].elem,null]}return[null,null]}function k(e,t,r,n,s){e.elem.setAttribute("data-loader",t),e.elem instanceof HTMLStyleElement&&e.elem.setAttribute("path",e.path);let i=null,a=null;if(!s){if(M.includes(t)&&function(e,t,r){if(r.hasOwnProperty(t)&&null!=r[t]&&r[t].length>0)return r[t].map((({path:e})=>e)).includes(e.path);return!1}(e,t,r))return!1;[i,a]=A(e,t,r)}return null===a?r[t].push(e):r[t].splice(a,0,e),i?n.insertBefore(e.elem,i):n.appendChild(e.elem),!0}function N(e,t,r=document){const n=r.defaultView;n.__injectCssCache||(n.__injectCssCache=function(){const e={};for(const t of["edison:preloadCss","js:require_css","js:requireCssWithComponent","loadCssWithCache","ensemble","CssEntryPoint","css-modules"])e[t]=[];return e}());const s=n.__injectCssCache;s[t]=s[t]?s[t]:[];const i=M.includes(t);if(!i&&e.length>1){const[n]=A(e[0],t,s),a=r.createDocumentFragment();let o=0;for(const r of e){k(r,t,s,a,!i)&&o++}return null===n?r.head.appendChild(a):r.head.insertBefore(a,n),o}{let n=0;for(const i of e){k(i,t,s,r.head,!1)&&n++}return n}}function x(e){try{const t=new URL(e);return t.pathname?decodeURIComponent(t.pathname):""}catch(e){return""}}function D(e=document){const t=q(e),r=e.querySelectorAll('link[rel="stylesheet"]');for(let e=0;e<r.length;e++){let n=x(r[e].href);null==t.already_loaded_css_paths[n]&&(t.loaded_css[n]=Promise.resolve(),t.already_loaded_css_paths[n]="loaded")}}function q(e){const t=e;return t._cssCache||(t._cssCache={loaded_css:Object.create(null),already_loaded_css_paths:Object.create(null)}),t._cssCache}function U(e,t,r,n){const s=r.pathname;let i=t.loaded_css[s];return i||(i=new Promise(((i,a)=>{const o=e.createElement("link");return o.href=r.toString(),o.rel="stylesheet",o.type="text/css",o.crossorigin="anonymous",o.onload=function(){return t.already_loaded_css_paths[s]="loaded",i()},o.onerror=a,N([{elem:o,path:r.pathname}],n,e),o})),t.loaded_css[s]=i,t.already_loaded_css_paths[s]="downloading"),i}function j(e,t){const r="string"==typeof e?n.protoBase64.dec(e):e;try{const e=a.fromBinary(r);if(e&&e.typeUrl&&e.typeUrl.startsWith("type.googleapis.com/")&&e.value)return t.fromBinary(e.value)}catch(e){}try{return t.fromBinary(r)}catch(e){throw new Error(`Invalid data while trying to unpack encoded proto: ${e}`)}}function B(e){return n.protoBase64.enc(e.toBinary())}var J;function F(e){const t=J[e];return"string"!=typeof t?e.toString():t[0].toLowerCase()+t.substring(1).replace(/[A-Z]/g,(e=>"_"+e.toLowerCase()))}D(),function(e){e[e.Canceled=1]="Canceled",e[e.Unknown=2]="Unknown",e[e.InvalidArgument=3]="InvalidArgument",e[e.DeadlineExceeded=4]="DeadlineExceeded",e[e.NotFound=5]="NotFound",e[e.AlreadyExists=6]="AlreadyExists",e[e.PermissionDenied=7]="PermissionDenied",e[e.ResourceExhausted=8]="ResourceExhausted",e[e.FailedPrecondition=9]="FailedPrecondition",e[e.Aborted=10]="Aborted",e[e.OutOfRange=11]="OutOfRange",e[e.Unimplemented=12]="Unimplemented",e[e.Internal=13]="Internal",e[e.Unavailable=14]="Unavailable",e[e.DataLoss=15]="DataLoss",e[e.Unauthenticated=16]="Unauthenticated"}(J||(J={}));class V extends Error{constructor(e,t=J.Unknown,r,n){var s;super(function(e,t){return e.length?`[${F(t)}] ${e}`:`[${F(t)}]`}(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t;const i=null!==(s=null!=n?n:Array.isArray(r)?void 0:r)&&void 0!==s?s:{};this.metadata=new Headers(i),this.details=[]}}function $(e,t=J.Unknown){return e instanceof V?e:e instanceof Error?"AbortError"==e.name?new V(e.message,J.Canceled):new V(e.message):new V(String(e),t)}function H(e,t){return function(e,t){const r={};for(const[n,s]of Object.entries(e.methods)){const i=t(Object.assign(Object.assign({},s),{localName:n,service:e}));null!=i&&(r[n]=i)}return r}(e,(r=>{switch(r.kind){case s.Unary:return function(e,t,r){return async function(n,s){var i,a;const o=await e.unary(t,r,null==s?void 0:s.signal,null==s?void 0:s.timeoutMs,null==s?void 0:s.headers,n);return null===(i=null==s?void 0:s.onHeader)||void 0===i||i.call(s,o.header),null===(a=null==s?void 0:s.onTrailer)||void 0===a||a.call(s,o.trailer),o.message}}(t,e,r);case s.ServerStreaming:return function(e,t,r){return function(n,s){let i;return{[Symbol.asyncIterator]:()=>({async next(){var a,o;i||(i=await e.serverStream(t,r,null==s?void 0:s.signal,null==s?void 0:s.timeoutMs,null==s?void 0:s.headers,n),null===(a=null==s?void 0:s.onHeader)||void 0===a||a.call(s,i.header));const c=await i.read();return c.done?(null===(o=null==s?void 0:s.onTrailer)||void 0===o||o.call(s,i.trailer),{done:!0,value:void 0}):{done:!1,value:c.value}}})}}}(t,e,r);default:return null}}))}function z(e,t){return t.concat().reverse().reduce(((e,t)=>t(e)),e)}function W(e){let t,r=new Uint8Array(0);function n(e){const t=new Uint8Array(r.length+e.length);t.set(r),t.set(e,r.length),r=t}return new ReadableStream({start(){t=e.getReader()},async pull(e){let s;for(;;){if(void 0===s&&r.byteLength>=5){let e=0;for(let t=1;t<5;t++)e=(e<<8)+r[t];s={flags:r[0],length:e}}if(void 0!==s&&r.byteLength>=s.length+5)break;const e=await t.read();if(e.done)break;n(e.value)}if(void 0===s)return 0==r.byteLength?void e.close():void e.error(new V("premature end of stream",J.DataLoss));const i=r.subarray(5,5+s.length);r=r.subarray(5+s.length),e.enqueue({flags:s.flags,data:i})}})}function K(e,t,r){const n=e.data.length+5,s=new Uint8Array(t,r,n);s[0]=e.flags;for(let t=e.data.length,r=4;r>0;r--)s[r]=t%256,t>>>=8;return s.set(e.data,5),n}class G extends n.Message{constructor(e){super(),this.code=0,this.message="",this.details=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new G).fromBinary(e,t)}static fromJson(e,t){return(new G).fromJson(e,t)}static fromJsonString(e,t){return(new G).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(G,e,t)}}function X(e){!function(){try{new Headers}catch(e){throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}();const t=e;return{async unary(r,n,s,i,a,o){var c,d,l,u;try{return await(d={stream:!1,service:r,method:n,url:`${e.baseUrl.replace(/\/$/,"")}/${r.typeName}/${n.name}`,init:{method:"POST",credentials:null!==(c=e.credentials)&&void 0!==c?c:"same-origin",redirect:"error",mode:"cors"},header:ee(a,i),message:o instanceof n.I?o:new n.I(o),signal:null!=s?s:(new AbortController).signal},l=async r=>{var s,i,a;const o=await fetch(r.url,Object.assign(Object.assign({},r.init),{headers:r.header,signal:r.signal,body:Q(r.message,e.binaryOptions)})),c=null!==(a=null!==(i=null!==(s=re(o))&&void 0!==s?s:te(o.headers))&&void 0!==i?i:se(o.headers))&&void 0!==a?a:ne(o.headers);if(c)throw c;if(!o.body)throw"missing response body";const d=W(o.body).getReader(),l=await d.read();if(l.done)throw"premature eof";if(l.value.flags===Z)throw ie(l.value.data),"unexpected trailer";const u=n.O.fromBinary(l.value.data,t.binaryOptions),m=await d.read();if(m.done)throw"missing trailer";if(m.value.flags!==Z)throw"missing trailer";const h=ie(m.value.data);if(!(await d.read()).done)throw"extraneous data";return{stream:!1,header:o.headers,message:u,trailer:h}},u=t.interceptors,u&&(l=z(l,u)),l(d))}catch(e){throw $(e,J.Internal)}},async serverStream(t,r,n,s,i,a){var o,c,d,l;try{return await(c={stream:!1,service:t,method:r,url:`${e.baseUrl.replace(/\/$/,"")}/${t.typeName}/${r.name}`,init:{method:"POST",credentials:null!==(o=e.credentials)&&void 0!==o?o:"same-origin",redirect:"error",mode:"cors"},header:ee(i,s),message:a instanceof r.I?a:new r.I(a),signal:null!=n?n:(new AbortController).signal},d=async n=>{var s,i,a;const o=await fetch(n.url,Object.assign(Object.assign({},n.init),{headers:n.header,signal:n.signal,body:Q(n.message,e.binaryOptions)})),c=null!==(a=null!==(i=null!==(s=re(o))&&void 0!==s?s:te(o.headers))&&void 0!==i?i:se(o.headers))&&void 0!==a?a:ne(o.headers);if(c)throw c;if(!o.body)throw"missing response body";const d=W(o.body).getReader();let l=!1,u=!1;return{stream:!0,service:t,method:r,header:o.headers,trailer:new Headers,async read(){try{const t=await d.read();if(t.done){if(u&&!l)throw new V("missing trailers",J.Internal);return{done:!0,value:void 0}}return(t.value.flags&Z)===Z?(l=!0,ie(t.value.data).forEach(((e,t)=>this.trailer.append(t,e))),{done:!0,value:void 0}):(u=!0,{done:!1,value:r.O.fromBinary(t.value.data,e.binaryOptions)})}catch(e){throw $(e)}}}},l=e.interceptors,l&&(d=z(d,l)),d(c))}catch(e){throw $(e,J.Internal)}}}}function Q(e,t){return function(...e){const t=new ArrayBuffer(e.reduce(((e,t)=>e+t.data.length+5),0));let r=0;for(const n of e)r+=K(n,t,r);return new Uint8Array(t)}({data:e.toBinary(t),flags:Y})}G.runtime=n.proto3,G.typeName="grpc.status.v1.Status",G.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:a,repeated:!0}]));const Y=0,Z=128;function ee(e,t){const r=new Headers(null!=e?e:{});return r.set("Content-Type","application/grpc-web+proto"),r.set("X-Grpc-Web","1"),r.set("X-User-Agent","@bufbuild/connect-web"),void 0!==t&&r.set("Grpc-Timeout",`${t}m`),r}function te(e){const t=e.get("Content-Type");switch(null==t?void 0:t.toLowerCase()){case"application/grpc-web":case"application/grpc-web+proto":return;case"application/grpc-web-text":case"application/grpc-web-text+proto":return new V("grpc-web-text is not supported",J.Internal);default:return new V(`unexpected content type: ${String(t)}`,J.Internal)}}function re(e){var t;const r=function(e){switch(e){case 200:return null;case 400:return J.Internal;case 401:return J.Unauthenticated;case 403:return J.PermissionDenied;case 404:return J.Unimplemented;case 429:case 502:case 503:case 504:return J.Unavailable;default:return J.Unknown}}(e.status);if(r)return new V(decodeURIComponent(null!==(t=e.headers.get("grpc-message"))&&void 0!==t?t:""),r)}function ne(e){var t;const r=e.get("grpc-status");if(null===r)return;const n=parseInt(r);return 0!==n?n in J?new V(decodeURIComponent(null!==(t=e.get("grpc-message"))&&void 0!==t?t:""),n,void 0,e):new V(`invalid grpc-status: ${r}`,J.Internal,void 0,e):void 0}function se(e){const t=e.get("grpc-status-details-bin");if(null!=t)try{const r=function(e,t,r){try{const s=n.protoBase64.dec(e);return t?t.fromBinary(s,r):s}catch(e){throw new V(e instanceof Error?e.message:String(e),J.DataLoss)}}(t,G);if(0==r.code)return;const s=new V(r.message,r.code,void 0,e);return s.details.push(...r.details),s}catch(t){const r=$(t,J.Internal);return e.forEach(((e,t)=>r.metadata.append(t,e))),r}}function ie(e){var t;const r=function(e){const t=new Headers,r=String.fromCharCode(...e).split("\r\n");for(const e of r){if(""===e)continue;const r=e.indexOf(":");if(r>0){const n=e.substring(0,r).trim(),s=e.substring(r+1).trim();t.append(n,s)}}return t}(e),n=null!==(t=se(r))&&void 0!==t?t:ne(r);if(n)throw n;return r}var ae,oe;function ce(){const e=window.performance?window.performance.now():0;return Math.floor(e)}!function(e){e.JsExecutionStart="js_execution_start",e.RequireLoadCallbackTime="require_load_callback_time",e.InitPageModuleLoadTime="init_page_module_load_time",e.PreloadModulesLoadTime="preload_modules_load_time",e.InitReceived="init_received",e.RenderStarted="render_started",e.RenderComplete="render_complete",e.FirstDataModuleReceived="first_data_module_received",e.LastDataModuleReceived="last_data_module_received",e.FirstCssPreloadReceived="first_css_preload_received",e.LastCssPreloadReceived="last_css_preload_received",e.ServerSidePrefetchStartedReceived="server_side_prefetch_started_received",e.DoneStreamingReceived="done_streaming_received",e.StreamedPrefetchWaitTime="streamed_prefetch_wait_time"}(ae||(ae={})),function(e){e.PageLoadComplete="page_load_complete",e.ErrorPageShown="error_page_shown"}(oe||(oe={}));class de{constructor(e){this.AMP_NAMESPACE="web_timing",this.marked={};const{atlasservlet:t,pageName:r,performanceNow:n=ce,getLazyMetricsReporter:s}=e;this.atlasservlet=t,this.pageName=r,this.performanceNow=n,this.lazyMetricsReporter=s?s():null;let i=()=>{};this.renderCompletePromise=new Promise((e=>{i=e})),this.renderCompleteResolveFn=i,this.eventTimings={},this.streamedPrefetchRequestTimingQueues={},this.streamedPrefetchResponseTimings={}}recordEventTime(e){this.eventTimings[e]=this.performanceNow()}recordEventTimeOnce(e){this.eventTimings[e]||this.recordEventTime(e)}getTags(e){return Object.assign({atlasservlet:this.atlasservlet,edison_page_name:this.pageName},e)}recordInitReceived(){this.recordEventTimeOnce(ae.InitReceived)}recordRenderStarted(){this.recordEventTimeOnce(ae.RenderStarted)}recordRenderComplete(){this.recordEventTimeOnce(ae.RenderComplete),this.renderCompleteResolveFn()}recordDataModuleReceived(){this.recordEventTimeOnce(ae.FirstDataModuleReceived),this.recordEventTime(ae.LastDataModuleReceived)}recordCssPreloadReceived(){this.recordEventTimeOnce(ae.FirstCssPreloadReceived),this.recordEventTime(ae.LastCssPreloadReceived)}recordServerSidePrefetchStartedReceived(){this.recordEventTimeOnce(ae.ServerSidePrefetchStartedReceived)}recordDoneStreamingReceived(){this.recordEventTimeOnce(ae.DoneStreamingReceived)}saveEventTimings(){return r.__awaiter(this,void 0,void 0,(function*(){if(!this.lazyMetricsReporter)return;yield this.renderCompletePromise;const e=yield this.lazyMetricsReporter,t=Object.assign(Object.assign({},function(){const e={};return"number"==typeof window.EDISON_METRICS_JS_EXECUTION_START&&(e[ae.JsExecutionStart]=window.EDISON_METRICS_JS_EXECUTION_START),"number"==typeof window.EDISON_METRICS_REQUIRE_LOAD_CALLBACK_TIME&&(e[ae.RequireLoadCallbackTime]=window.EDISON_METRICS_REQUIRE_LOAD_CALLBACK_TIME),"number"==typeof window.EDISON_METRICS_INIT_PAGE_MODULE_LOAD_TIME&&(e[ae.InitPageModuleLoadTime]=window.EDISON_METRICS_INIT_PAGE_MODULE_LOAD_TIME),"number"==typeof window.EDISON_METRICS_PRELOAD_MODULES_LOAD_TIME&&(e[ae.PreloadModulesLoadTime]=window.EDISON_METRICS_PRELOAD_MODULES_LOAD_TIME),e}()),this.eventTimings);for(const[r,s]of Object.entries(t)){const t=this.getTags();e.createStats({ns:this.AMP_NAMESPACE,name:`edison/${r}`},t).recordDuration(s,n.TimeUnit.MILLISECONDS)}}))}recordStreamedPrefetchRequestTime(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.streamedPrefetchRequestTimingQueues[e]||(this.streamedPrefetchRequestTimingQueues[e]=[]),this.streamedPrefetchRequestTimingQueues[e].push({loggingIdentifier:t,requestTime:this.performanceNow(),processed:!1}),yield this.flushPrefetchTimingRecordQueue()}))}recordStreamedPrefetchResponseTime(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.streamedPrefetchResponseTimings[e]||(this.streamedPrefetchResponseTimings[e]={responseTime:this.performanceNow(),failed:t},yield this.flushPrefetchTimingRecordQueue())}))}markPageLoadSuccess(){this.recordPageMarker(oe.PageLoadComplete,{result:"success"})}markPageLoadFailed(){this.recordPageMarker(oe.PageLoadComplete,{result:"error"})}markErrorPageShown(){const e=!!this.marked[oe.PageLoadComplete];e||this.markPageLoadFailed(),this.recordPageMarker(oe.ErrorPageShown,{page_load_completed:e.toString()})}recordPageMarker(e,t={}){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield this.lazyMetricsReporter;if(this.marked[e])return;const s=null==r?void 0:r.createCounter({ns:this.AMP_NAMESPACE,name:`edison/page/${e}`},this.getTags(Object.assign({browser:n.getBrowserShortName(),source:n.is_mobile_or_tablet()?"mobile":"web"},t)));null==s||s.increment(),null==s||s.record(),this.marked[e]=!0}catch(t){console.error("Fail to record page event: ",e)}}))}flushPrefetchTimingRecordQueue(){return r.__awaiter(this,void 0,void 0,(function*(){if(!this.lazyMetricsReporter)return;const e=yield this.lazyMetricsReporter,t={};for(const[r,s]of Object.entries(this.streamedPrefetchRequestTimingQueues)){const i=this.streamedPrefetchResponseTimings[r];if(i)for(const r of s){const{loggingIdentifier:s,requestTime:a}=r,{responseTime:o,failed:c}=i;if(t[s]||(t[s]=0),t[s]++,r.processed)continue;const d=`${s}_${t[s]}`,l=this.getTags({prefetch_id:d,failed:`${c}`}),u=e.createStats({ns:this.AMP_NAMESPACE,name:`edison/${ae.StreamedPrefetchWaitTime}`},l),m=Math.max(o-a,0);u.recordDuration(m,n.TimeUnit.MILLISECONDS),r.processed=!0}}}))}}class le extends n.Message{constructor(e){super(),this.originalUrl="",this.currentUrl="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new le).fromBinary(e,t)}static fromJson(e,t){return(new le).fromJson(e,t)}static fromJsonString(e,t){return(new le).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(le,e,t)}}le.runtime=n.proto3,le.typeName="edison.prefetch.PrefetchArgs",le.fields=n.proto3.util.newFieldList((()=>[{no:10,name:"original_url",kind:"scalar",T:9},{no:11,name:"current_url",kind:"scalar",T:9}]));class ue extends n.Message{constructor(e){super(),this.type={case:void 0},n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new ue).fromBinary(e,t)}static fromJson(e,t){return(new ue).fromJson(e,t)}static fromJsonString(e,t){return(new ue).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(ue,e,t)}}ue.runtime=n.proto3,ue.typeName="edison.prefetch.Prefetch",ue.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"pending",kind:"message",T:me,oneof:"type"},{no:2,name:"result",kind:"message",T:he,oneof:"type"}]));class me extends n.Message{constructor(e){super(),this.requestKeys=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new me).fromBinary(e,t)}static fromJson(e,t){return(new me).fromJson(e,t)}static fromJsonString(e,t){return(new me).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(me,e,t)}}me.runtime=n.proto3,me.typeName="edison.prefetch.Prefetch.Pending",me.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"request_keys",kind:"scalar",T:9,repeated:!0}]));class he extends n.Message{constructor(e){super(),this.requestKey="",this.response=new Uint8Array(0),this.error="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new he).fromBinary(e,t)}static fromJson(e,t){return(new he).fromJson(e,t)}static fromJsonString(e,t){return(new he).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(he,e,t)}}he.runtime=n.proto3,he.typeName="edison.prefetch.Prefetch.Result",he.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"request_key",kind:"scalar",T:9},{no:2,name:"response",kind:"scalar",T:12},{no:3,name:"error",kind:"scalar",T:9}]));const ge={typeName:"edison.prefetch.PrefetchService",methods:{streamPrefetches:{name:"StreamPrefetches",I:le,O:ue,kind:s.ServerStreaming}}};class fe extends n.Message{constructor(e){super(),this.isFromOfficeIp=!1,n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new fe).fromBinary(e,t)}static fromJson(e,t){return(new fe).fromJson(e,t)}static fromJsonString(e,t){return(new fe).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(fe,e,t)}}fe.runtime=n.proto3,fe.typeName="edison_dws2.PrefetchArguments",fe.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"is_from_office_ip",kind:"scalar",T:8},{no:2,name:"proto_arguments",kind:"message",T:a}]));class pe extends n.Message{constructor(e){super(),this.rpcProxyUrl="",this.atlasservlet="",this.pageName="",this.pageLifecycle="",this.activeUserId=n.protoInt64.zero,this.activeTeamId=n.protoInt64.zero,this.authRole=0,this.authActionType=0,this.uriPath="",this.legacyController="",this.legacyAction="",this.isOfficeIp=!1,this.staticRepoRev="",this.dws2RepoRev="",this.streamingEnabled=!1,this.isBuildTimePrefetchesEnabled=!1,this.skipBuildTimePrefetchDurationThreshold=0,this.isCssPreloadEnabled=!1,this.entryPointModuleName="",this.beforeRenderModuleName="",this.isDws2Stage=!1,this.originalUrl="",this.originalReferer="",this.prefetchVersion=0,this.isProd=!1,this.gates={},this.browserId="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new pe).fromBinary(e,t)}static fromJson(e,t){return(new pe).fromJson(e,t)}static fromJsonString(e,t){return(new pe).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(pe,e,t)}}pe.runtime=n.proto3,pe.typeName="edison_dws2.EdisonInitParams",pe.fields=n.proto3.util.newFieldList((()=>[{no:22,name:"rpc_proxy_url",kind:"scalar",T:9},{no:2,name:"atlasservlet",kind:"scalar",T:9},{no:3,name:"page_name",kind:"scalar",T:9},{no:15,name:"page_lifecycle",kind:"scalar",T:9},{no:4,name:"active_user_id",kind:"scalar",T:4},{no:5,name:"active_team_id",kind:"scalar",T:4},{no:31,name:"auth_role",kind:"scalar",T:13},{no:32,name:"auth_action_type",kind:"scalar",T:13},{no:6,name:"uri_path",kind:"scalar",T:9},{no:9,name:"legacy_controller",kind:"scalar",T:9},{no:10,name:"legacy_action",kind:"scalar",T:9},{no:11,name:"is_office_ip",kind:"scalar",T:8},{no:12,name:"static_repo_rev",kind:"scalar",T:9},{no:13,name:"dws2_repo_rev",kind:"scalar",T:9},{no:14,name:"streaming_enabled",kind:"scalar",T:8},{no:30,name:"is_build_time_prefetches_enabled",kind:"scalar",T:8},{no:37,name:"skip_build_time_prefetch_duration_threshold",kind:"scalar",T:5},{no:36,name:"is_css_preload_enabled",kind:"scalar",T:8},{no:25,name:"entry_point_module_name",kind:"scalar",T:9},{no:26,name:"before_render_module_name",kind:"scalar",T:9},{no:27,name:"is_dws2_stage",kind:"scalar",T:8},{no:28,name:"original_url",kind:"scalar",T:9},{no:29,name:"original_referer",kind:"scalar",T:9},{no:33,name:"prefetchVersion",kind:"scalar",T:5},{no:34,name:"is_prod",kind:"scalar",T:8},{no:35,name:"gates",kind:"map",K:9,V:{kind:"scalar",T:8}},{no:38,name:"browserId",kind:"scalar",T:9}]));class we extends n.Message{constructor(e){super(),this.type={case:void 0},this.b64RequestKey="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new we).fromBinary(e,t)}static fromJson(e,t){return(new we).fromJson(e,t)}static fromJsonString(e,t){return(new we).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(we,e,t)}}we.runtime=n.proto3,we.typeName="edison_dws2.EdisonRequest",we.fields=n.proto3.util.newFieldList((()=>[{no:2,name:"service_method_prefetch",kind:"message",T:ve,oneof:"type"},{no:3,name:"css_preload",kind:"message",T:ye,oneof:"type"},{no:5,name:"module_preload",kind:"message",T:be,oneof:"type"},{no:4,name:"b64_request_key",kind:"scalar",T:9}]));class ve extends n.Message{constructor(e){super(),this.service="",this.method="",this.initialPageAtlasservlet="",this.initialPageName="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new ve).fromBinary(e,t)}static fromJson(e,t){return(new ve).fromJson(e,t)}static fromJsonString(e,t){return(new ve).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(ve,e,t)}}ve.runtime=n.proto3,ve.typeName="edison_dws2.EdisonRequest.ServiceMethodPrefetch",ve.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"service",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"proto_arguments",kind:"message",T:a},{no:5,name:"initial_page_atlasservlet",kind:"scalar",T:9},{no:6,name:"initial_page_name",kind:"scalar",T:9}]));class ye extends n.Message{constructor(e){super(),this.cssPaths=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new ye).fromBinary(e,t)}static fromJson(e,t){return(new ye).fromJson(e,t)}static fromJsonString(e,t){return(new ye).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(ye,e,t)}}ye.runtime=n.proto3,ye.typeName="edison_dws2.EdisonRequest.CssPreload",ye.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"css_paths",kind:"scalar",T:9,repeated:!0}]));class be extends n.Message{constructor(e){super(),this.modulePaths=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new be).fromBinary(e,t)}static fromJson(e,t){return(new be).fromJson(e,t)}static fromJsonString(e,t){return(new be).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(be,e,t)}}be.runtime=n.proto3,be.typeName="edison_dws2.EdisonRequest.ModulePreload",be.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"module_paths",kind:"scalar",T:9,repeated:!0}]));class Ee extends n.Message{constructor(e){super(),this.encodedProto="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new Ee).fromBinary(e,t)}static fromJson(e,t){return(new Ee).fromJson(e,t)}static fromJsonString(e,t){return(new Ee).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(Ee,e,t)}}Ee.runtime=n.proto3,Ee.typeName="edison_dws2.InitProps",Ee.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"encodedProto",kind:"scalar",T:9}]));class Pe extends n.Message{constructor(e){super(),this.modules=[],this.yapsProject="",this.yapsDeployment="",this.atlasservlet="",this.pageName="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new Pe).fromBinary(e,t)}static fromJson(e,t){return(new Pe).fromJson(e,t)}static fromJsonString(e,t){return(new Pe).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(Pe,e,t)}}Pe.runtime=n.proto3,Pe.typeName="datamodules.DataModulesPrefetchArguments",Pe.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"modules",kind:"scalar",T:9,repeated:!0},{no:3,name:"yaps_project",kind:"scalar",T:9},{no:4,name:"yaps_deployment",kind:"scalar",T:9},{no:5,name:"atlasservlet",kind:"scalar",T:9},{no:6,name:"page_name",kind:"scalar",T:9}]));class Te extends n.Message{constructor(e){super(),this.type={case:void 0},n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new Te).fromBinary(e,t)}static fromJson(e,t){return(new Te).fromJson(e,t)}static fromJsonString(e,t){return(new Te).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(Te,e,t)}}Te.runtime=n.proto3,Te.typeName="datamodules.JsonOrProtoAny",Te.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"json",kind:"scalar",T:9,oneof:"type"},{no:2,name:"proto_any",kind:"message",T:a,oneof:"type"}]));class _e extends n.Message{constructor(e){super(),this.name="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new _e).fromBinary(e,t)}static fromJson(e,t){return(new _e).fromJson(e,t)}static fromJsonString(e,t){return(new _e).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(_e,e,t)}}_e.runtime=n.proto3,_e.typeName="datamodules.DataModule",_e.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"data",kind:"message",T:Te}]));class Se extends n.Message{constructor(e){super(),this.dataModules=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new Se).fromBinary(e,t)}static fromJson(e,t){return(new Se).fromJson(e,t)}static fromJsonString(e,t){return(new Se).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(Se,e,t)}}Se.runtime=n.proto3,Se.typeName="datamodules.DataModulesPrefetchData",Se.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"data_modules",kind:"message",T:_e,repeated:!0}]));const Ie="Edison not initialized.";var Re;t.EdisonPrefetchStatus=void 0,(Re=t.EdisonPrefetchStatus||(t.EdisonPrefetchStatus={}))[Re.PendingStreaming=0]="PendingStreaming",Re[Re.PendingAjax=1]="PendingAjax",Re[Re.StreamedAndNotConsumed=2]="StreamedAndNotConsumed",Re[Re.StreamedAndConsumed=3]="StreamedAndConsumed",Re[Re.FetchedByAjax=4]="FetchedByAjax";class Oe{constructor(e){this.data=e}toBinary(){return this.data}}const Ce=new n.Empty,Le=["browse_web.BrowseWebInternal","browse_web.BrowseWebPrefetch","growth_plans.SubscriptionsPrefetchService","checkout.CheckoutEdison"];class Me{setEntryInPrefetchLog(e,t,r,n){for(const s of this.prefetchLog)if(s.requestKey===e&&s.status===t)return s.status=r,void(n&&Object.assign(s,n))}constructor(e,t){this.isDoneStreaming=!1,this.isServerSidePrefetchStarted=!1,this.loadedDataModules={},this.pendingDataModulePromises={},this.pendingDataModuleResolveFns={},this.consumedPrefetches={},this.pendingPrefetchPromises={},this.pendingPrefetchResolveFns={},this.pendingServerSidePrefetchKeys=[],this.numPrefetchesRequestedBeforeDoneStreaming=0,this.numPrefetchesRequestedAfterDoneStreaming=0,this.numPrefetchesByAjax=0,this.numPrefetchesStreamed=0,this.prefetchLog=[],this.preloadedCssPaths=new Set,this.initParams=e;const{atlasservlet:r,pageName:n}=e,{getLazyMetricsReporter:s}=t;this.metrics=new de({atlasservlet:r,pageName:n,getLazyMetricsReporter:s})}static initialized(){return!!Me.instance}static waitUntilInitialized(){return r.__awaiter(this,void 0,void 0,(function*(){yield Me.initializedPromise}))}static init(e,t={}){if(Me.instance)throw new Error("Edison is already initialized.");const{activeUserId:r,pageName:n,rpcProxyUrl:s}=e;if(!s&&!window.RUNNING_IN_REACTSERVER)throw new Error("rpcProxyUrl init param missing. This is required for the browser environment.");Me.instance=new Me(e,t),Me.instance.metrics.recordInitReceived(),window.RUNNING_IN_EDISON=!0,window.EDISON_ACTIVE_USER_ID=Number(r)>0?Number(r):void 0,window.EDISON_PAGE_NAME=n,Me.initializedResolveFn()}static reset(){Me.instance=null}static beforeRender(e){const{beforeRenderModuleName:t}=Me.getInitParams(),{beforeRender:r}=e;if(!r)throw new Error(`Module '${t}' does not export a beforeRender function.`);if("function"!=typeof r)throw new Error(`beforeRender member exported from '${t}' is not a function.`);e.beforeRender()}static getInitParams(){if(!Me.instance)throw new Error(Ie);return Me.instance.initParams}static getAtlasservlet(){return Me.getInitParams().atlasservlet}static getAttribution(){const{atlasservlet:e,pageLifecycle:t}=Me.getInitParams();return`${e}:${t}`}static getPageName(){return Me.getInitParams().pageName}static getPageLifecycle(){return Me.getInitParams().pageLifecycle}static getIsOfficeIp(){return Me.getInitParams().isOfficeIp}static getActiveUserId(){return Number(Me.getInitParams().activeUserId)}static getActiveTeamId(){return Number(Me.getInitParams().activeTeamId)}static getLegacyController(){return Me.getInitParams().legacyController}static getLegacyAction(){return Me.getInitParams().legacyAction}static isStreamingEnabled(){return Me.getInitParams().streamingEnabled}static isDoneStreaming(){var e;return(null===(e=Me.instance)||void 0===e?void 0:e.isDoneStreaming)||!1}static getStaticRepoRev(){return Me.getInitParams().staticRepoRev}static getDws2RepoRev(){return Me.getInitParams().dws2RepoRev}static getIsBuildTimePrefetchesEnabled(){return Me.getInitParams().isBuildTimePrefetchesEnabled}static getSkipBuildTimePrefetchDurationThreshold(){return Me.getInitParams().skipBuildTimePrefetchDurationThreshold}static getIsCSSPreloadEnabled(){return Me.getInitParams().isCssPreloadEnabled}static getIsDws2Stage(){return Me.getInitParams().isDws2Stage}static getEntryPointModuleName(){return Me.getInitParams().entryPointModuleName}static getOriginalUrl(){return Me.getInitParams().originalUrl}static getOriginalReferer(){return Me.getInitParams().originalReferer}static getPrefetchLog(){if(!Me.instance)throw new Error(Ie);return[...Me.instance.prefetchLog]}static getPrefetchVersion(){return Me.getInitParams().prefetchVersion||0}static getIsProd(){return Me.getInitParams().isProd}static getMetrics(){if(!Me.instance)throw new Error(Ie);return Me.instance.metrics}static getEdisonFeatureGates(){return Me.getInitParams().gates||{}}static _grpcWebAjax(e,s){return r.__awaiter(this,void 0,void 0,(function*(){if("serviceMethodPrefetch"!==e.type.case)throw new Error(`Unsupported edison request type: ${e.type.case}`);P();try{const{rpcProxyUrl:r}=Me.getInitParams(),i=Me.getHeadersForPrefetchRequest();let a=r;const{service:o,method:c,protoArguments:d}=e.type.value;(function(e,t){return!Le.includes(e)||t.enable_grpc_web_new})(o,Me.getEdisonFeatureGates())&&(a="/web-grpc/edison",i["X-Dropbox-Authority"]=window.location.host);const l=X({baseUrl:a}),u=yield l.unary({typeName:o},{name:c,I:Oe,O:{fromBinary:e=>e}},void 0,void 0,i,null==d?void 0:d.value),m=n.protoBase64.enc(u.message);return Me.instance.setEntryInPrefetchLog(s,t.EdisonPrefetchStatus.PendingAjax,t.EdisonPrefetchStatus.FetchedByAjax,{failed:!1,result:m}),m}finally{T()}}))}static getHeadersForPrefetchRequest(){const{atlasservlet:e,pageName:t,originalUrl:r,originalReferer:n,legacyController:s,legacyAction:i,browserId:a}=Me.getInitParams(),o=Object.assign({"Accept-Language":document.documentElement.lang,"X-Edison-Atlasservlet":e,"X-Edison-Page-Name":t,"X-Edison-Original-Url":r,"X-Edison-Original-Referer":n,"X-Edison-Prompt-Controller":s,"X-Edison-Prompt-Action":i,"X-Dropbox-Client-Yaps-Attribution":Me.getAttribution()},Me.getAuthHeaders());return a&&(o["X-Dropbox-Browser-Id"]=a),o}static getAuthHeaders(){const e={},{activeUserId:t,activeTeamId:r,authRole:n,authActionType:s}=Me.getInitParams();return t&&(e["X-Dropbox-Uid"]=t.toString()),r&&(e["X-Dropbox-Teamid"]=r.toString()),(n||s)&&(e["X-Dropbox-Team-Authorization"]=JSON.stringify({auth_role:String(n),auth_action_type:String(s)})),e}static preloadCSS(e){if(!Me.instance)throw new Error(Ie);const t=Me.instance,r=window;if(window.RUNNING_IN_REACTSERVER){const n=[];for(const r of e)t.preloadedCssPaths.has(r)||(n.push(r),t.preloadedCssPaths.add(r));if(n.length>0){const e=B(new we({type:{case:"cssPreload",value:{cssPaths:n}}}));r.ReactserverEdisonClient.sendEdisonRequest(e)}}else{t.metrics.recordCssPreloadReceived();const r=document,n=q(r);e.forEach((e=>{U(r,n,new URL(C(e)),"edison:preloadCss")}))}}static _prefetch(e,r,n){if(!Me.instance)throw new Error(Ie);const{atlasservlet:s,pageName:i}=Me.getInitParams(),o=new we({type:{case:"serviceMethodPrefetch",value:{service:e,method:r,protoArguments:(c=n||Ce,new a({typeUrl:d,value:c.toBinary()})),initialPageAtlasservlet:s,initialPageName:i}}});var c,d;const l=`${e}.${r}`,u=Me.instance;if(u.isDoneStreaming?u.numPrefetchesRequestedAfterDoneStreaming++:u.numPrefetchesRequestedBeforeDoneStreaming++,o.b64RequestKey)throw new Error("The EdisonRequest proto message parameter to prefetchHelper must not have a b64PrefetchKey set (it is computed here so we make sure it is the same between browser and streaming reactserver).");const m=B(o),h=!!u.pendingPrefetchPromises[m];return!u.initParams.streamingEnabled||u.consumedPrefetches[m]||u.isServerSidePrefetchStarted&&!u.pendingServerSidePrefetchKeys.includes(m)&&!h||u.isDoneStreaming&&!h?(u.numPrefetchesByAjax++,u.prefetchLog.push({edisonRequest:o,requestKey:m,status:t.EdisonPrefetchStatus.PendingAjax}),Me._grpcWebAjax(o,m)):(h?u.setEntryInPrefetchLog(m,t.EdisonPrefetchStatus.StreamedAndNotConsumed,t.EdisonPrefetchStatus.StreamedAndConsumed):(u.pendingPrefetchPromises[m]=new Promise(((e,t)=>{u.pendingPrefetchResolveFns[m]={requestMsg:o,resolve:e,reject:t}})),u.prefetchLog.push({edisonRequest:o,requestKey:m,status:t.EdisonPrefetchStatus.PendingStreaming})),u.metrics.recordStreamedPrefetchRequestTime(m,l),u.consumedPrefetches[m]=!0,u.pendingPrefetchPromises[m])}static fetch(e,t,r){const{originalUrl:n}=Me.getInitParams(),s=Object.assign({originalUrl:n},r||{});s.currentUrl=s.currentUrl||n;const i=Me.getPrefetchVersion()>0?new le(s):void 0;return this._prefetch(e,t,i)}static preloadJSModules(e){if(window.RUNNING_IN_REACTSERVER){const t=B(new we({type:{case:"modulePreload",value:{modulePaths:e}}}));window.ReactserverEdisonClient.sendEdisonRequest(t)}}static registerStreamedPrefetch(e,r,n=!1){if(!Me.instance)throw new Error(Ie);const s=Me.instance;if(!s.initParams.streamingEnabled)throw new Error("Edison must be initialized with streaming enabled to handle streaming prefetches.");if(s.isDoneStreaming)throw new Error("Cannot register new streamed prefetch after marking that we are done streaming.");if(s.metrics.recordStreamedPrefetchResponseTime(e,n),s.numPrefetchesStreamed++,!s.pendingPrefetchPromises[e]){s.pendingPrefetchPromises[e]=n?Promise.reject(new Error(r)):Promise.resolve(r);const i=j(e,we),a={requestKey:e,status:t.EdisonPrefetchStatus.StreamedAndNotConsumed,failed:n,result:r};return i&&(a.edisonRequest=i),void s.prefetchLog.push(a)}s.pendingPrefetchResolveFns[e]&&(n?s.pendingPrefetchResolveFns[e].reject(new Error(r)):s.pendingPrefetchResolveFns[e].resolve(r),delete s.pendingPrefetchResolveFns[e],s.setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.StreamedAndConsumed,{result:r,failed:n}))}static loadDataModule(e){if(!Me.instance)throw new Error(Ie);const t={};for(const r of e)r in Me.instance.loadedDataModules&&(t[r]=Me.instance.loadedDataModules[r]);if(Object.keys(t).length===e.length)return Promise.resolve(t);{const r=e.filter((e=>!(e in Me.instance.loadedDataModules)));return Me._prefetch("data_modules.DataModules","DataModulesPrefetch",new Pe({modules:r})).then((e=>{const n=j(e,Se).dataModules;if(n.length!==r.length)throw new Error("unexpected number of data modules in the response -- we should have received exactly "+r.length+" but instead we got "+n.length);for(const{data:e,name:r}of n){if(!e||"json"!==e.type.case||!e.type.value)throw new Error("handling data modules with protobuf return type not yet implemented");{const n=JSON.parse(e.type.value);Me.instance.loadedDataModules[r]=n,t[r]=n}}return t}))}}static registerStreamedDataModule(e,t,r){if(!Me.instance)throw new Error(Ie);const n=Me.instance;if(n.isDoneStreaming)throw new Error("Cannot register new streamed data modules after marking that we are done streaming.");if("proto"===t)throw new Error("handling data modules with protobuf return type not yet implemented");n.metrics.recordDataModuleReceived();const s=JSON.parse(r);if(n.pendingDataModulePromises[e]){if(!n.pendingDataModuleResolveFns[e])throw new Error(`Trying to resolve the promise for the streamed data module "${e}" but could not find resolve function in pendingDataModuleResolveFns`);n.pendingDataModuleResolveFns[e].resolve(s),delete n.pendingDataModuleResolveFns[e]}else n.pendingDataModulePromises[e]=Promise.resolve(s)}static getStreamedDataModule(e){if(!Me.instance)throw new Error(Ie);const t=Me.instance;if(!t.initParams.streamingEnabled)throw new Error("Edison must be initialized with streaming enabled to get data modules streamed in page response.");if(!t.pendingDataModulePromises[e]){if(t.isDoneStreaming)throw new Error(`Data module "${e}" was not streamed.`);t.pendingDataModulePromises[e]=new Promise(((r,n)=>{t.pendingDataModuleResolveFns[e]={resolve:r,reject:n}}))}return t.pendingDataModulePromises[e]}static markServerSidePrefetchStarted(e){if(!Me.instance)throw new Error(Ie);if(!Array.isArray(e))throw new Error("requestKeys must be an array");const r=Me.instance;r.isServerSidePrefetchStarted=!0,r.pendingServerSidePrefetchKeys=e,r.metrics.recordServerSidePrefetchStartedReceived();Object.keys(r.pendingPrefetchResolveFns).filter((t=>!e.includes(t))).forEach((e=>{const{requestMsg:n,resolve:s,reject:i}=r.pendingPrefetchResolveFns[e];r.setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.PendingAjax),Me._grpcWebAjax(n,e).then(s).catch(i),delete r.pendingPrefetchResolveFns[e],r.numPrefetchesByAjax++}))}static doneStreaming(){if(!Me.instance)throw new Error(Ie);const e=Me.instance;if(!e.initParams.streamingEnabled)throw new Error("Cannot stop processing streaming chunks if Edison is not initialized with streaming enabled.");if(!e.isDoneStreaming){e.metrics.recordDoneStreamingReceived(),e.metrics.saveEventTimings();for(const t in e.pendingDataModuleResolveFns){if(t in e.loadedDataModules)throw new Error(`${t} was still pending registration by streamed inline chunks at time of "done streaming", but there already is a result for this data module being loaded already. This is an invalid state.`);e.pendingDataModuleResolveFns[t].reject(new Error("canceling data module progress: done streaming before receiving data module result")),delete e.pendingDataModuleResolveFns[t]}for(const r in e.pendingPrefetchResolveFns)if(e.pendingPrefetchResolveFns.hasOwnProperty(r)){const{requestMsg:n,resolve:s,reject:i}=e.pendingPrefetchResolveFns[r];e.setEntryInPrefetchLog(r,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.PendingAjax),Me._grpcWebAjax(n,r).then(s).catch(i),delete e.pendingPrefetchResolveFns[r],e.numPrefetchesByAjax++}e.pendingServerSidePrefetchKeys=[],e.isDoneStreaming=!0}}static getPrefetchCounts(){if(!Me.instance)throw new Error(Ie);const e=Me.instance;return{numPrefetchesRequestedAfterDoneStreaming:e.numPrefetchesRequestedAfterDoneStreaming,numPrefetchesRequestedBeforeDoneStreaming:e.numPrefetchesRequestedBeforeDoneStreaming,numPrefetchesByAjax:e.numPrefetchesByAjax,numPrefetchesStreamed:e.numPrefetchesStreamed}}static loadPrefetches(){var e,t,s,i;return r.__awaiter(this,void 0,void 0,(function*(){if(!Me.instance)throw new Error(Ie);const{originalUrl:a}=Me.getInitParams(),o=X({baseUrl:"/dws2/rpc/"}),c=H(ge,o),d=new le({originalUrl:a,currentUrl:a}),l=Me.getHeadersForPrefetchRequest(),u=new Set;try{try{for(var m,h=!0,g=r.__asyncValues(c.streamPrefetches(d,{headers:l}));m=yield g.next(),!(e=m.done);){i=m.value,h=!1;try{const e=i;if("pending"===e.type.case&&(Me.markServerSidePrefetchStarted(e.type.value.requestKeys),e.type.value.requestKeys.forEach((e=>u.add(e)))),"result"===e.type.case){const{requestKey:t,response:r,error:s}=e.type.value;u.delete(t),s?Me.registerStreamedPrefetch(t,s,!0):Me.registerStreamedPrefetch(t,n.protoBase64.enc(r),!1)}}finally{h=!0}}}catch(e){t={error:e}}finally{try{h||e||!(s=g.return)||(yield s.call(g))}finally{if(t)throw t.error}}}catch(e){u.forEach((t=>{Me.registerStreamedPrefetch(t,e.toString(),!0)}))}finally{Me.doneStreaming()}}))}}Me.instance=null,Me.initializedPromise=new Promise((e=>{Me.initializedResolveFn=e}));var Ae=Object.freeze({__proto__:null,Edison:Me,get EdisonPrefetchStatus(){return t.EdisonPrefetchStatus}});function ke(){return r.__awaiter(this,void 0,void 0,(function*(){const{getMetricsReporter:t}=yield new Promise((function(t,r){e(["./c_src_sink_index"],t,r)})).then((function(e){return e.index_esnext}));return t()}))}function Ne(){return r.__awaiter(this,void 0,void 0,(function*(){const{ensureCookiesAreEnabled:t}=yield new Promise((function(t,r){e(["./c_edison_cookies_check"],t,r)}));if(!t())return;(()=>{r.__awaiter(this,void 0,void 0,(function*(){const{showToastFromCookie:t}=yield new Promise((function(t,r){e(["./c_core_toast_toast_on_init"],t,r)}));t()}))})()}))}t.Edison=Me,t.InitProps=Ee,t.URI=O,t.assert=_,t.decrementAjaxCount=T,t.edison_esnext=Ae,t.getOrCreateCache=q,t.incrementAjaxCount=P,t.init=e=>{var t;(e=>{(null==e?void 0:e.debug)&&(o.DEBUG=e.debug),(null==e?void 0:e.idleTimeout)&&(o.IDLE_TIMEOUT=e.idleTimeout),(null==e?void 0:e.networkTimeout)&&(o.NETWORK_TIMEOUT=e.networkTimeout)})(e),c.info("init()"),b||(b=new y),E=b,t=()=>{E.start(),window.addEventListener("locationchange",(e=>{E.start(e.timeStamp)})),window.addEventListener("pageshow",(e=>{e.persisted&&E.start(e.timeStamp,!0)}))},document.prerendering?window.addEventListener("prerenderingchange",t,!0):t()},t.initFromDws=function(e){Me.init(e),Ne()},t.initPage=function(e){const t="string"==typeof e?j(e,pe):pe.fromJson(e);window.RUNNING_IN_REACTSERVER?Me.init(t):(Me.init(t,{getLazyMetricsReporter:ke}),Ne())},t.injectCss=N,t.loadCssWithCache=U,t.onTTVC=(e,t)=>null==E?void 0:E.onTTVC(e,t),t.rescanForMoreCssLinks=D,t.static_url=C,t.unmarshalProto=j}));
//# sourceMappingURL=e_edison.js-vflsPuREZ.map
