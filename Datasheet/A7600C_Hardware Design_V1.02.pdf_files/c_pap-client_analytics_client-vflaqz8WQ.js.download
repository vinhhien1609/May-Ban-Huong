define(["exports","./e_privacy_consent_static_ccpa_iframe","./c_core_exception_info","./c_tslib","./c_src_sink_index","./c_browser_browser_detection","react","./e_edison","./c_init_data_runtime","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_xhr","./c_csrf","metaserver/static/js/modules/constants/viewer","./e_core_exception","./c_core_notify","react-dom","./c_core_i18n","metaserver/static/js/langpack","metaserver/static/js/modules/constants/env"],(function(e,t,i,n,r,s,o,a,c,d,h,l,u,p,f,v,g,m,y,w){"use strict";var b,_={exports:{}};b=_,function(){var e={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};function t(t,i,n){if(4!==i.length)throw new e.exception.invalid("invalid aes block size");var r=t.b[n],s=i[0]^r[0],o=i[n?3:1]^r[1],a=i[2]^r[2];i=i[n?1:3]^r[3];var c,d,h,l,u=r.length/4-2,p=4,f=[0,0,0,0];t=(c=t.s[n])[0];var v=c[1],g=c[2],m=c[3],y=c[4];for(l=0;l<u;l++)c=t[s>>>24]^v[o>>16&255]^g[a>>8&255]^m[255&i]^r[p],d=t[o>>>24]^v[a>>16&255]^g[i>>8&255]^m[255&s]^r[p+1],h=t[a>>>24]^v[i>>16&255]^g[s>>8&255]^m[255&o]^r[p+2],i=t[i>>>24]^v[s>>16&255]^g[o>>8&255]^m[255&a]^r[p+3],p+=4,s=c,o=d,a=h;for(l=0;4>l;l++)f[n?3&-l:l]=y[s>>>24]<<24^y[o>>16&255]<<16^y[a>>8&255]<<8^y[255&i]^r[p++],c=s,s=o,o=a,a=i,i=c;return f}function i(e,t){var i,n,r,s=e.F,o=e.b,a=s[0],c=s[1],d=s[2],h=s[3],l=s[4],u=s[5],p=s[6],f=s[7];for(i=0;64>i;i++)16>i?n=t[i]:(n=t[i+1&15],r=t[i+14&15],n=t[15&i]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+t[15&i]+t[i+9&15]|0),n=n+f+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(p^l&(u^p))+o[i],f=p,p=u,u=l,l=h+n|0,h=d,d=c,a=n+((c=a)&d^h&(c^d))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;s[0]=s[0]+a|0,s[1]=s[1]+c|0,s[2]=s[2]+d|0,s[3]=s[3]+h|0,s[4]=s[4]+l|0,s[5]=s[5]+u|0,s[6]=s[6]+p|0,s[7]=s[7]+f|0}function n(t,i){var n,r=e.random.K[t],s=[];for(n in r)r.hasOwnProperty(n)&&s.push(r[n]);for(n=0;n<s.length;n++)s[n](i)}function r(e,t){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?e.addEntropy(window.performance.now(),t,"loadtime"):e.addEntropy((new Date).valueOf(),t,"loadtime")}function s(t){t.b=o(t).concat(o(t)),t.L=new e.cipher.aes(t.b)}function o(e){for(var t=0;4>t&&(e.h[t]=e.h[t]+1|0,!e.h[t]);t++);return e.L.encrypt(e.h)}function a(e,t){return function(){t.apply(e,arguments)}}e.cipher.aes=function(t){this.s[0][0][0]||this.O();var i,n,r,s,o=this.s[0][4],a=this.s[1],c=1;if(4!==(i=t.length)&&6!==i&&8!==i)throw new e.exception.invalid("invalid aes key size");for(this.b=[r=t.slice(0),s=[]],t=i;t<4*i+28;t++)n=r[t-1],(0==t%i||8===i&&4==t%i)&&(n=o[n>>>24]<<24^o[n>>16&255]<<16^o[n>>8&255]<<8^o[255&n],0==t%i&&(n=n<<8^n>>>24^c<<24,c=c<<1^283*(c>>7))),r[t]=r[t-i]^n;for(i=0;t;i++,t--)n=r[3&i?t:t-4],s[i]=4>=t||4>i?n:a[0][o[n>>>24]]^a[1][o[n>>16&255]]^a[2][o[n>>8&255]]^a[3][o[255&n]]},e.cipher.aes.prototype={encrypt:function(e){return t(this,e,0)},decrypt:function(e){return t(this,e,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var e,t,i,n,r,s,o,a=this.s[0],c=this.s[1],d=a[4],h=c[4],l=[],u=[];for(e=0;256>e;e++)u[(l[e]=e<<1^283*(e>>7))^e]=e;for(t=i=0;!d[t];t^=n||1,i=u[i]||1)for(s=(s=i^i<<1^i<<2^i<<3^i<<4)>>8^255&s^99,d[t]=s,h[s]=t,o=16843009*(r=l[e=l[n=l[t]]])^65537*e^257*n^16843008*t,r=257*l[s]^16843008*s,e=0;4>e;e++)a[e][t]=r=r<<24^r>>>8,c[e][s]=o=o<<24^o>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),c[e]=c[e].slice(0)}},e.bitArray={bitSlice:function(t,i,n){return t=e.bitArray.$(t.slice(i/32),32-(31&i)).slice(1),void 0===n?t:e.bitArray.clamp(t,n-i)},extract:function(e,t,i){var n=Math.floor(-t-i&31);return(-32&(t+i-1^t)?e[t/32|0]<<32-n^e[t/32+1|0]>>>n:e[t/32|0]>>>n)&(1<<i)-1},concat:function(t,i){if(0===t.length||0===i.length)return t.concat(i);var n=t[t.length-1],r=e.bitArray.getPartial(n);return 32===r?t.concat(i):e.bitArray.$(i,r,0|n,t.slice(0,t.length-1))},bitLength:function(t){var i=t.length;return 0===i?0:32*(i-1)+e.bitArray.getPartial(t[i-1])},clamp:function(t,i){if(32*t.length<i)return t;var n=(t=t.slice(0,Math.ceil(i/32))).length;return i&=31,0<n&&i&&(t[n-1]=e.bitArray.partial(i,t[n-1]&2147483648>>i-1,1)),t},partial:function(e,t,i){return 32===e?t:(i?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(t,i){if(e.bitArray.bitLength(t)!==e.bitArray.bitLength(i))return!1;var n,r=0;for(n=0;n<t.length;n++)r|=t[n]^i[n];return 0===r},$:function(t,i,n,r){var s;for(s=0,void 0===r&&(r=[]);32<=i;i-=32)r.push(n),n=0;if(0===i)return r.concat(t);for(s=0;s<t.length;s++)r.push(n|t[s]>>>i),n=t[s]<<32-i;return s=t.length?t[t.length-1]:0,t=e.bitArray.getPartial(s),r.push(e.bitArray.partial(i+t&31,32<i+t?n:r.pop(),1)),r},i:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},byteswapM:function(e){var t,i;for(t=0;t<e.length;++t)i=e[t],e[t]=i>>>24|i>>>8&65280|(65280&i)<<8|i<<24;return e}},e.codec.utf8String={fromBits:function(t){var i,n,r="",s=e.bitArray.bitLength(t);for(i=0;i<s/8;i++)0==(3&i)&&(n=t[i/4]),r+=String.fromCharCode(n>>>8>>>8>>>8),n<<=8;return decodeURIComponent(escape(r))},toBits:function(t){t=unescape(encodeURIComponent(t));var i,n=[],r=0;for(i=0;i<t.length;i++)r=r<<8|t.charCodeAt(i),3==(3&i)&&(n.push(r),r=0);return 3&i&&n.push(e.bitArray.partial(8*(3&i),r)),n}},e.codec.hex={fromBits:function(t){var i,n="";for(i=0;i<t.length;i++)n+=(0xf00000000000+(0|t[i])).toString(16).substr(4);return n.substr(0,e.bitArray.bitLength(t)/4)},toBits:function(t){var i,n,r=[];for(n=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",i=0;i<t.length;i+=8)r.push(0^parseInt(t.substr(i,8),16));return e.bitArray.clamp(r,4*n)}},e.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(t,i,n){var r=e.codec.base32.BASE,s=e.codec.base32.REMAINING,o="",a=0,c=e.codec.base32.B,d=0,h=e.bitArray.bitLength(t);for(n&&(c=e.codec.base32.X),n=0;o.length*r<h;)o+=c.charAt((d^t[n]>>>a)>>>s),a<r?(d=t[n]<<r-a,a+=s,n++):(d<<=r,a-=r);for(;7&o.length&&!i;)o+="=";return o},toBits:function(t,i){t=t.replace(/\s|=/g,"").toUpperCase();var n,r,s=e.codec.base32.BITS,o=e.codec.base32.BASE,a=e.codec.base32.REMAINING,c=[],d=0,h=e.codec.base32.B,l=0,u="base32";for(i&&(h=e.codec.base32.X,u="base32hex"),n=0;n<t.length;n++){if(0>(r=h.indexOf(t.charAt(n)))){if(!i)try{return e.codec.base32hex.toBits(t)}catch(e){}throw new e.exception.invalid("this isn't "+u+"!")}d>a?(d-=a,c.push(l^r>>>d),l=r<<s-d):l^=r<<s-(d+=o)}return 56&d&&c.push(e.bitArray.partial(56&d,l,1)),c}},e.codec.base32hex={fromBits:function(t,i){return e.codec.base32.fromBits(t,i,1)},toBits:function(t){return e.codec.base32.toBits(t,1)}},e.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,i,n){var r="",s=0,o=e.codec.base64.B,a=0,c=e.bitArray.bitLength(t);for(n&&(o=o.substr(0,62)+"-_"),n=0;6*r.length<c;)r+=o.charAt((a^t[n]>>>s)>>>26),6>s?(a=t[n]<<6-s,s+=26,n++):(a<<=6,s-=6);for(;3&r.length&&!i;)r+="=";return r},toBits:function(t,i){t=t.replace(/\s|=/g,"");var n,r,s=[],o=0,a=e.codec.base64.B,c=0;for(i&&(a=a.substr(0,62)+"-_"),n=0;n<t.length;n++){if(0>(r=a.indexOf(t.charAt(n))))throw new e.exception.invalid("this isn't base64!");26<o?(o-=26,s.push(c^r>>>o),c=r<<32-o):c^=r<<32-(o+=6)}return 56&o&&s.push(e.bitArray.partial(56&o,c,1)),s}},e.codec.base64url={fromBits:function(t){return e.codec.base64.fromBits(t,1,1)},toBits:function(t){return e.codec.base64.toBits(t,1)}},e.hash.sha256=function(e){this.b[0]||this.O(),e?(this.F=e.F.slice(0),this.A=e.A.slice(0),this.l=e.l):this.reset()},e.hash.sha256.hash=function(t){return(new e.hash.sha256).update(t).finalize()},e.hash.sha256.prototype={blockSize:512,reset:function(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update:function(t){"string"==typeof t&&(t=e.codec.utf8String.toBits(t));var n,r=this.A=e.bitArray.concat(this.A,t);if(n=this.l,9007199254740991<(t=this.l=n+e.bitArray.bitLength(t)))throw new e.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var s=new Uint32Array(r),o=0;for(n=512+n-(512+n&511);n<=t;n+=512)i(this,s.subarray(16*o,16*(o+1))),o+=1;r.splice(0,16*o)}else for(n=512+n-(512+n&511);n<=t;n+=512)i(this,r.splice(0,16));return this},finalize:function(){var t,n=this.A,r=this.F;for(t=(n=e.bitArray.concat(n,[e.bitArray.partial(1,1)])).length+2;15&t;t++)n.push(0);for(n.push(Math.floor(this.l/4294967296)),n.push(0|this.l);n.length;)i(this,n.splice(0,16));return this.reset(),r},Y:[],b:[],O:function(){function e(e){return 4294967296*(e-Math.floor(e))|0}for(var t,i,n=0,r=2;64>n;r++){for(i=!0,t=2;t*t<=r;t++)if(0==r%t){i=!1;break}i&&(8>n&&(this.Y[n]=e(Math.pow(r,.5))),this.b[n]=e(Math.pow(r,1/3)),n++)}}},e.mode.ccm={name:"ccm",G:[],listenProgress:function(t){e.mode.ccm.G.push(t)},unListenProgress:function(t){-1<(t=e.mode.ccm.G.indexOf(t))&&e.mode.ccm.G.splice(t,1)},fa:function(t){var i,n=e.mode.ccm.G.slice();for(i=0;i<n.length;i+=1)n[i](t)},encrypt:function(t,i,n,r,s){var o,a=i.slice(0),c=e.bitArray,d=c.bitLength(n)/8,h=c.bitLength(a)/8;if(s=s||64,r=r||[],7>d)throw new e.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;4>o&&h>>>8*o;o++);return o<15-d&&(o=15-d),n=c.clamp(n,8*(15-o)),i=e.mode.ccm.V(t,i,n,r,s,o),a=e.mode.ccm.C(t,a,n,i,s,o),c.concat(a.data,a.tag)},decrypt:function(t,i,n,r,s){s=s||64,r=r||[];var o=e.bitArray,a=o.bitLength(n)/8,c=o.bitLength(i),d=o.clamp(i,c-s),h=o.bitSlice(i,c-s);if(c=(c-s)/8,7>a)throw new e.exception.invalid("ccm: iv must be at least 7 bytes");for(i=2;4>i&&c>>>8*i;i++);if(i<15-a&&(i=15-a),n=o.clamp(n,8*(15-i)),d=e.mode.ccm.C(t,d,n,h,s,i),t=e.mode.ccm.V(t,d.data,n,r,s,i),!o.equal(d.tag,t))throw new e.exception.corrupt("ccm: tag doesn't match");return d.data},na:function(t,i,n,r,s,o){var a=[],c=e.bitArray,d=c.i;if(r=[c.partial(8,(i.length?64:0)|r-2<<2|o-1)],(r=c.concat(r,n))[3]|=s,r=t.encrypt(r),i.length)for(65279>=(n=c.bitLength(i)/8)?a=[c.partial(16,n)]:4294967295>=n&&(a=c.concat([c.partial(16,65534)],[n])),a=c.concat(a,i),i=0;i<a.length;i+=4)r=t.encrypt(d(r,a.slice(i,i+4).concat([0,0,0])));return r},V:function(t,i,n,r,s,o){var a=e.bitArray,c=a.i;if((s/=8)%2||4>s||16<s)throw new e.exception.invalid("ccm: invalid tag length");if(4294967295<r.length||4294967295<i.length)throw new e.exception.bug("ccm: can't deal with 4GiB or more data");for(n=e.mode.ccm.na(t,r,n,s,a.bitLength(i)/8,o),r=0;r<i.length;r+=4)n=t.encrypt(c(n,i.slice(r,r+4).concat([0,0,0])));return a.clamp(n,8*s)},C:function(t,i,n,r,s,o){var a,c=e.bitArray;a=c.i;var d=i.length,h=c.bitLength(i),l=d/50,u=l;if(n=c.concat([c.partial(8,o-1)],n).concat([0,0,0]).slice(0,4),r=c.bitSlice(a(r,t.encrypt(n)),0,s),!d)return{tag:r,data:[]};for(a=0;a<d;a+=4)a>l&&(e.mode.ccm.fa(a/d),l+=u),n[3]++,s=t.encrypt(n),i[a]^=s[0],i[a+1]^=s[1],i[a+2]^=s[2],i[a+3]^=s[3];return{tag:r,data:c.clamp(i,h)}}},e.mode.ocb2={name:"ocb2",encrypt:function(t,i,n,r,s,o){if(128!==e.bitArray.bitLength(n))throw new e.exception.invalid("ocb iv must be 128 bits");var a,c=e.mode.ocb2.S,d=e.bitArray,h=d.i,l=[0,0,0,0];n=c(t.encrypt(n));var u,p=[];for(r=r||[],s=s||64,a=0;a+4<i.length;a+=4)l=h(l,u=i.slice(a,a+4)),p=p.concat(h(n,t.encrypt(h(n,u)))),n=c(n);return u=i.slice(a),i=d.bitLength(u),a=t.encrypt(h(n,[0,0,0,i])),u=d.clamp(h(u.concat([0,0,0]),a),i),l=h(l,h(u.concat([0,0,0]),a)),l=t.encrypt(h(l,h(n,c(n)))),r.length&&(l=h(l,o?r:e.mode.ocb2.pmac(t,r))),p.concat(d.concat(u,d.clamp(l,s)))},decrypt:function(t,i,n,r,s,o){if(128!==e.bitArray.bitLength(n))throw new e.exception.invalid("ocb iv must be 128 bits");s=s||64;var a,c,d=e.mode.ocb2.S,h=e.bitArray,l=h.i,u=[0,0,0,0],p=d(t.encrypt(n)),f=e.bitArray.bitLength(i)-s,v=[];for(r=r||[],n=0;n+4<f/32;n+=4)a=l(p,t.decrypt(l(p,i.slice(n,n+4)))),u=l(u,a),v=v.concat(a),p=d(p);if(c=f-32*n,a=t.encrypt(l(p,[0,0,0,c])),a=l(a,h.clamp(i.slice(n),c).concat([0,0,0])),u=l(u,a),u=t.encrypt(l(u,l(p,d(p)))),r.length&&(u=l(u,o?r:e.mode.ocb2.pmac(t,r))),!h.equal(h.clamp(u,s),h.bitSlice(i,f)))throw new e.exception.corrupt("ocb: tag doesn't match");return v.concat(h.clamp(a,c))},pmac:function(t,i){var n,r=e.mode.ocb2.S,s=e.bitArray,o=s.i,a=[0,0,0,0],c=o(c=t.encrypt([0,0,0,0]),r(r(c)));for(n=0;n+4<i.length;n+=4)c=r(c),a=o(a,t.encrypt(o(c,i.slice(n,n+4))));return n=i.slice(n),128>s.bitLength(n)&&(c=o(c,r(c)),n=s.concat(n,[-2147483648,0,0,0])),a=o(a,n),t.encrypt(o(r(o(c,r(c))),a))},S:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^135*(e[0]>>>31)]}},e.mode.gcm={name:"gcm",encrypt:function(t,i,n,r,s){var o=i.slice(0);return i=e.bitArray,r=r||[],t=e.mode.gcm.C(!0,t,o,r,n,s||128),i.concat(t.data,t.tag)},decrypt:function(t,i,n,r,s){var o=i.slice(0),a=e.bitArray,c=a.bitLength(o);if(r=r||[],(s=s||128)<=c?(i=a.bitSlice(o,c-s),o=a.bitSlice(o,0,c-s)):(i=o,o=[]),t=e.mode.gcm.C(!1,t,o,r,n,s),!a.equal(t.tag,i))throw new e.exception.corrupt("gcm: tag doesn't match");return t.data},ka:function(t,i){var n,r,s,o,a,c=e.bitArray.i;for(s=[0,0,0,0],o=i.slice(0),n=0;128>n;n++){for((r=0!=(t[Math.floor(n/32)]&1<<31-n%32))&&(s=c(s,o)),a=0!=(1&o[3]),r=3;0<r;r--)o[r]=o[r]>>>1|(1&o[r-1])<<31;o[0]>>>=1,a&&(o[0]^=-520093696)}return s},j:function(t,i,n){var r,s=n.length;for(i=i.slice(0),r=0;r<s;r+=4)i[0]^=4294967295&n[r],i[1]^=4294967295&n[r+1],i[2]^=4294967295&n[r+2],i[3]^=4294967295&n[r+3],i=e.mode.gcm.ka(i,t);return i},C:function(t,i,n,r,s,o){var a,c,d,h,l,u,p,f,v=e.bitArray;for(u=n.length,p=v.bitLength(n),f=v.bitLength(r),c=v.bitLength(s),a=i.encrypt([0,0,0,0]),96===c?(s=s.slice(0),s=v.concat(s,[1])):(s=e.mode.gcm.j(a,[0,0,0,0],s),s=e.mode.gcm.j(a,s,[0,0,Math.floor(c/4294967296),4294967295&c])),c=e.mode.gcm.j(a,[0,0,0,0],r),l=s.slice(0),r=c.slice(0),t||(r=e.mode.gcm.j(a,c,n)),h=0;h<u;h+=4)l[3]++,d=i.encrypt(l),n[h]^=d[0],n[h+1]^=d[1],n[h+2]^=d[2],n[h+3]^=d[3];return n=v.clamp(n,p),t&&(r=e.mode.gcm.j(a,c,n)),t=[Math.floor(f/4294967296),4294967295&f,Math.floor(p/4294967296),4294967295&p],r=e.mode.gcm.j(a,r,t),d=i.encrypt(s),r[0]^=d[0],r[1]^=d[1],r[2]^=d[2],r[3]^=d[3],{tag:v.bitSlice(r,0,o),data:n}}},e.misc.hmac=function(t,i){this.W=i=i||e.hash.sha256;var n,r=[[],[]],s=i.prototype.blockSize/32;for(this.w=[new i,new i],t.length>s&&(t=i.hash(t)),n=0;n<s;n++)r[0][n]=909522486^t[n],r[1][n]=1549556828^t[n];this.w[0].update(r[0]),this.w[1].update(r[1]),this.R=new i(this.w[0])},e.misc.hmac.prototype.encrypt=e.misc.hmac.prototype.mac=function(t){if(this.aa)throw new e.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)},e.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1},e.misc.hmac.prototype.update=function(e){this.aa=!0,this.R.update(e)},e.misc.hmac.prototype.digest=function(){var e=this.R.finalize();return e=new this.W(this.w[1]).update(e).finalize(),this.reset(),e},e.misc.pbkdf2=function(t,i,n,r,s){if(n=n||1e4,0>r||0>n)throw new e.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=e.codec.utf8String.toBits(t)),"string"==typeof i&&(i=e.codec.utf8String.toBits(i)),t=new(s=s||e.misc.hmac)(t);var o,a,c,d,h=[],l=e.bitArray;for(d=1;32*h.length<(r||1);d++){for(s=o=t.encrypt(l.concat(i,[d])),a=1;a<n;a++)for(o=t.encrypt(o),c=0;c<o.length;c++)s[c]^=o[c];h=h.concat(s)}return r&&(h=l.clamp(h,r)),h},e.prng=function(t){this.c=[new e.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=t,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80},e.prng.prototype={randomWords:function(t,i){var n,r,a=[];if((n=this.isReady(i))===this.u)throw new e.exception.notReady("generator isn't seeded");if(n&this.J){n=!(n&this.I),r=[];var c,d=0;for(this.Z=r[0]=(new Date).valueOf()+this.da,c=0;16>c;c++)r.push(4294967296*Math.random()|0);for(c=0;c<this.c.length&&(r=r.concat(this.c[c].finalize()),d+=this.m[c],this.m[c]=0,n||!(this.P&1<<c));c++);for(this.P>=1<<this.c.length&&(this.c.push(new e.hash.sha256),this.m.push(0)),this.f-=d,d>this.o&&(this.o=d),this.P++,this.b=e.hash.sha256.hash(this.b.concat(r)),this.L=new e.cipher.aes(this.b),n=0;4>n&&(this.h[n]=this.h[n]+1|0,!this.h[n]);n++);}for(n=0;n<t;n+=4)0==(n+1)%this.ca&&s(this),r=o(this),a.push(r[0],r[1],r[2],r[3]);return s(this),a.slice(0,t)},setDefaultParanoia:function(t,i){if(0===t&&"Setting paranoia=0 will ruin your security; use it only for testing"!==i)throw new e.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=t},addEntropy:function(t,i,r){r=r||"user";var s,o,a=(new Date).valueOf(),c=this.H[r],d=this.isReady(),h=0;switch(void 0===(s=this.U[r])&&(s=this.U[r]=this.ha++),void 0===c&&(c=this.H[r]=0),this.H[r]=(this.H[r]+1)%this.c.length,typeof t){case"number":void 0===i&&(i=1),this.c[c].update([s,this.N++,1,i,a,1,0|t]);break;case"object":if("[object Uint32Array]"===(r=Object.prototype.toString.call(t))){for(o=[],r=0;r<t.length;r++)o.push(t[r]);t=o}else for("[object Array]"!==r&&(h=1),r=0;r<t.length&&!h;r++)"number"!=typeof t[r]&&(h=1);if(!h){if(void 0===i)for(r=i=0;r<t.length;r++)for(o=t[r];0<o;)i++,o>>>=1;this.c[c].update([s,this.N++,2,i,a,t.length].concat(t))}break;case"string":void 0===i&&(i=t.length),this.c[c].update([s,this.N++,3,i,a,t.length]),this.c[c].update(t);break;default:h=1}if(h)throw new e.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[c]+=i,this.f+=i,d===this.u&&(this.isReady()!==this.u&&n("seeded",Math.max(this.o,this.f)),n("progress",this.getProgress()))},isReady:function(e){return e=this.T[void 0!==e?e:this.M],this.o&&this.o>=e?this.m[0]>this.ba&&(new Date).valueOf()>this.Z?this.J|this.I:this.I:this.f>=e?this.J|this.u:this.u},getProgress:function(e){return e=this.T[e||this.M],this.o>=e||this.f>e?1:this.f/e},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:a(this,this.ma),mouseCollector:a(this,this.oa),keyboardCollector:a(this,this.la),accelerometerCollector:a(this,this.ea),touchCollector:a(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else{if(!document.attachEvent)throw new e.exception.bug("can't attach event");document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)}this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(e,t){this.K[e][this.ga++]=t},removeEventListener:function(e,t){var i,n,r=this.K[e],s=[];for(n in r)r.hasOwnProperty(n)&&r[n]===t&&s.push(n);for(i=0;i<s.length;i++)delete r[n=s[i]]},la:function(){r(this,1)},oa:function(e){var t,i;try{t=e.x||e.clientX||e.offsetX||0,i=e.y||e.clientY||e.offsetY||0}catch(e){i=t=0}0!=t&&0!=i&&this.addEntropy([t,i],2,"mouse"),r(this,0)},qa:function(e){e=e.touches[0]||e.changedTouches[0],this.addEntropy([e.pageX||e.clientX,e.pageY||e.clientY],1,"touch"),r(this,0)},ma:function(){r(this,2)},ea:function(e){if(e=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z,window.orientation){var t=window.orientation;"number"==typeof t&&this.addEntropy(t,1,"accelerometer")}e&&this.addEntropy(e,2,"accelerometer"),r(this,0)}},e.random=new e.prng(6);e:try{var c,d,h,l;if(l=b.exports){var u;try{u=require("crypto")}catch(e){u=null}l=d=u}if(l&&d.randomBytes)c=d.randomBytes(128),c=new Uint32Array(new Uint8Array(c).buffer),e.random.addEntropy(c,1024,"crypto['randomBytes']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(h=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(h);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break e;window.msCrypto.getRandomValues(h)}e.random.addEntropy(h,1024,"crypto['getRandomValues']")}}catch(e){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(e))}e.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(t,i,n,r){n=n||{},r=r||{};var s,o=e.json,a=o.g({iv:e.random.randomWords(4,0)},o.defaults);if(o.g(a,n),n=a.adata,"string"==typeof a.salt&&(a.salt=e.codec.base64.toBits(a.salt)),"string"==typeof a.iv&&(a.iv=e.codec.base64.toBits(a.iv)),!e.mode[a.mode]||!e.cipher[a.cipher]||"string"==typeof t&&100>=a.iter||64!==a.ts&&96!==a.ts&&128!==a.ts||128!==a.ks&&192!==a.ks&&256!==a.ks||2>a.iv.length||4<a.iv.length)throw new e.exception.invalid("json encrypt: invalid parameters");return"string"==typeof t?(t=(s=e.misc.cachedPbkdf2(t,a)).key.slice(0,a.ks/32),a.salt=s.salt):e.ecc&&t instanceof e.ecc.elGamal.publicKey&&(s=t.kem(),a.kemtag=s.tag,t=s.key.slice(0,a.ks/32)),"string"==typeof i&&(i=e.codec.utf8String.toBits(i)),"string"==typeof n&&(a.adata=n=e.codec.utf8String.toBits(n)),s=new e.cipher[a.cipher](t),o.g(r,a),r.key=t,a.ct="ccm"===a.mode&&e.arrayBuffer&&e.arrayBuffer.ccm&&i instanceof ArrayBuffer?e.arrayBuffer.ccm.encrypt(s,i,a.iv,n,a.ts):e.mode[a.mode].encrypt(s,i,a.iv,n,a.ts),a},encrypt:function(t,i,n,r){var s=e.json,o=s.ja.apply(s,arguments);return s.encode(o)},ia:function(t,i,n,r){n=n||{},r=r||{};var s,o,a=e.json;if(s=(i=a.g(a.g(a.g({},a.defaults),i),n,!0)).adata,"string"==typeof i.salt&&(i.salt=e.codec.base64.toBits(i.salt)),"string"==typeof i.iv&&(i.iv=e.codec.base64.toBits(i.iv)),!e.mode[i.mode]||!e.cipher[i.cipher]||"string"==typeof t&&100>=i.iter||64!==i.ts&&96!==i.ts&&128!==i.ts||128!==i.ks&&192!==i.ks&&256!==i.ks||!i.iv||2>i.iv.length||4<i.iv.length)throw new e.exception.invalid("json decrypt: invalid parameters");return"string"==typeof t?(t=(o=e.misc.cachedPbkdf2(t,i)).key.slice(0,i.ks/32),i.salt=o.salt):e.ecc&&t instanceof e.ecc.elGamal.secretKey&&(t=t.unkem(e.codec.base64.toBits(i.kemtag)).slice(0,i.ks/32)),"string"==typeof s&&(s=e.codec.utf8String.toBits(s)),o=new e.cipher[i.cipher](t),s="ccm"===i.mode&&e.arrayBuffer&&e.arrayBuffer.ccm&&i.ct instanceof ArrayBuffer?e.arrayBuffer.ccm.decrypt(o,i.ct,i.iv,i.tag,s,i.ts):e.mode[i.mode].decrypt(o,i.ct,i.iv,s,i.ts),a.g(r,i),r.key=t,1===n.raw?s:e.codec.utf8String.fromBits(s)},decrypt:function(t,i,n,r){var s=e.json;return s.ia(t,s.decode(i),n,r)},encode:function(t){var i,n="{",r="";for(i in t)if(t.hasOwnProperty(i)){if(!i.match(/^[a-z0-9]+$/i))throw new e.exception.invalid("json encode: invalid property name");switch(n+=r+'"'+i+'":',r=",",typeof t[i]){case"number":case"boolean":n+=t[i];break;case"string":n+='"'+escape(t[i])+'"';break;case"object":n+='"'+e.codec.base64.fromBits(t[i],0)+'"';break;default:throw new e.exception.bug("json encode: unsupported type")}}return n+"}"},decode:function(t){if(!(t=t.replace(/\s/g,"")).match(/^\{.*\}$/))throw new e.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var i,n,r={};for(i=0;i<t.length;i++){if(!(n=t[i].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new e.exception.invalid("json decode: this isn't json!");null!=n[3]?r[n[2]]=parseInt(n[3],10):null!=n[4]?r[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?e.codec.base64.toBits(n[4]):unescape(n[4]):null!=n[5]&&(r[n[2]]="true"===n[5])}return r},g:function(t,i,n){if(void 0===t&&(t={}),void 0===i)return t;for(var r in i)if(i.hasOwnProperty(r)){if(n&&void 0!==t[r]&&t[r]!==i[r])throw new e.exception.invalid("required parameter overridden");t[r]=i[r]}return t},sa:function(e,t){var i,n={};for(i in e)e.hasOwnProperty(i)&&e[i]!==t[i]&&(n[i]=e[i]);return n},ra:function(e,t){var i,n={};for(i=0;i<t.length;i++)void 0!==e[t[i]]&&(n[t[i]]=e[t[i]]);return n}},e.encrypt=e.json.encrypt,e.decrypt=e.json.decrypt,e.misc.pa={},e.misc.cachedPbkdf2=function(t,i){var n,r=e.misc.pa;return n=(i=i||{}).iter||1e3,(n=(r=r[t]=r[t]||{})[n]=r[n]||{firstSalt:i.salt&&i.salt.length?i.salt.slice(0):e.random.randomWords(2,0)})[r=void 0===i.salt?n.firstSalt:i.salt]=n[r]||e.misc.pbkdf2(t,r,i.iter),{key:n[r].slice(0),salt:r.slice(0)}},b.exports&&(b.exports=e),window.sjcl=e}();var S=_.exports;class A{executeRpc(e,i,n,r){var s;const o=null===(s=navigator.sendBeacon)||void 0===s?void 0:s.bind(navigator);if(o)return new Promise((function(s,a){var c;const d=function(e,t){const i=S.codec.utf8String.toBits(e),n=new S.misc.hmac(i,S.hash.sha256).encrypt(t);return S.codec.base64url.fromBits(n)}(null!==(c=i[t.ApiV2HeaderNames.CsrfToken])&&void 0!==c?c:"",e.getPath());e.updateQuery({t:d});const h=new Blob([n,JSON.stringify(Object.assign(Object.assign({},i),{"Content-Type":r}))],{type:r}),l=o(e.toString(),h),u={result:JSON.parse(JSON.stringify({beacon:l})),headers:i};return l?s(u):a(u)}));return(new t.FetchAsyncTransport).executeRpc(e,i,n,r)}executeBinaryRpc(e,i,n,r){return(new t.FetchAsyncTransport).executeBinaryRpc(e,i,n,r)}}function E(e){return e.replace(/[A-Z]/g,((e,t)=>0===t?e.toLowerCase():"_"+e.toLowerCase()))}function R(e,t=25){let i="";const n=e.toLowerCase().split(/\s+/).join("-");for(const e of n){if(i.length>=t)break;const n=e.charCodeAt(0);(n>47&&n<58||n>96&&n<123||45===n&&"-"!==i[i.length-1])&&(i+=e)}return"-"===i[i.length-1]&&(i=i.slice(0,i.length-1)),i}function C(){const e=/([^(]+)@|at ([^(]+) \(/,t=new Error;if(void 0===t.stack)return"unknown";let i="";return t.stack.split("\n").slice(3,7).forEach((t=>{const n=e.exec(t);i+="/"+(null===n?"?":(n[1]||n[2]).replace("<anonymous>","?"))})),i.substring(0,64)}const B=["actionSurface","eventClass","eventState"];function x(e){if("class"in e&&"action"in e&&"object"in e)return e}function k(e){const t=x(e);return t?t.class:q(e,"eventClass",0)}function O(e){const t=j(e),i=I(e);if(void 0!==t&&void 0!==i)return t+"."+i}function j(e){var t;const i=x(e);if(i)return i.action;try{const i=null===(t=e.constructor)||void 0===t?void 0:t.getTypeUrl().split(".").pop();return E(null==i?void 0:i.split("_")[0])}catch(e){}}function I(e){var t;const i=x(e);if(i)return i.object;try{const i=null===(t=e.constructor)||void 0===t?void 0:t.getTypeUrl().split(".").pop();return E(null==i?void 0:i.split("_")[1])}catch(e){}}function P(e){var t;const i=x(e);return i?null===(t=i.properties)||void 0===t?void 0:t.actionSurface:null==e?void 0:e.actionSurface}function L(e){var t,i;return(null===(i=null===(t=x(e))||void 0===t?void 0:t.properties)||void 0===i?void 0:i.eventState)||"unknown_event_state"}function T(e){return".tag"in e&&"stormcrow_exposure_event"===e[".tag"]}function F(e){const t={},i=x(e);if(i)for(const e in i.properties)-1===B.indexOf(e)&&i.properties.hasOwnProperty(e)&&void 0!==i.properties[e]&&null!==i.properties[e]&&(t[E(e)]=i.properties[e].toString());else for(const i in e)if(-1===B.indexOf(i)&&e.hasOwnProperty(i)){const n=q(e,i);t[E(i)]=n||e[i].toString()}return t}function q(e,t,i){var n;if(!t||!t.length)return;const r=t.charAt(0).toUpperCase()+t.substring(1),s=(null===(n=e.constructor)||void 0===n?void 0:n[r])||{},o=e[t]||i;for(const e of Object.keys(s))if(parseInt(s[e],10)===o)return e.toLowerCase()}const U={CRITICAL:"critical",NONCRITICAL:"non-critical",USER_ERROR:"user-error",UNCAUGHT:"uncaught",OPERATIONAL:"operational"};function M(e,t){const i=new Error(e),n={force:!0,severity:(null==t?void 0:t.severity)||U.NONCRITICAL,tags:(null==t?void 0:t.tags)||["pap_web"]};N(Object.assign({err:i},n))}function N(e){const{err:t}=e;t.tags=[...(null==t?void 0:t.tags)||[],...(null==e?void 0:e.tags)||["pap_web"]],t.severity=e.severity,t.force=e.force,"undefined"==typeof jest&&setTimeout((()=>{throw t}),0)}const D={apiv2:"apiv2",fetch:"fetch",sdk:"sdk"},z="pap_event_logging",V="log_events";function G(e,t){return n.__awaiter(this,void 0,void 0,(function*(){switch(t.type){case D.fetch:return t.fetch(`/2/${z}/${V}`,{method:"POST",body:JSON.stringify({event_entries:e}),headers:{"Content-Type":"application/json"}});case D.apiv2:return t.apiV2Client.ns(z).rpc(V,{event_entries:e},{});case D.sdk:return t.sdk.papEventLoggingLogEvents({event_entries:e})}}))}function W(e){const{identity:t}=e;return(null==t?void 0:t.foreignUserProvider)&&(null==t?void 0:t.foreignUserId)?{foreign_user_provider:null==t?void 0:t.foreignUserProvider,foreign_user_id:null==t?void 0:t.foreignUserId,user_id:void 0,team_id:void 0,paired_user_id:void 0}:(null==t?void 0:t.foreignUserProvider)&&!(null==t?void 0:t.foreignUserId)||!(null==t?void 0:t.foreignUserProvider)&&(null==t?void 0:t.foreignUserId)?((null==t?void 0:t.foreignUserId)?(null==t?void 0:t.foreignUserProvider)||M("Missing foreign_user_provider"):M("Missing foreign_user_id"),{foreign_user_provider:null==t?void 0:t.foreignUserProvider,foreign_user_id:null==t?void 0:t.foreignUserId,user_id:null==t?void 0:t.userId,team_id:null==t?void 0:t.teamId,paired_user_id:null==t?void 0:t.pairedUserId}):{user_id:null==t?void 0:t.userId,team_id:null==t?void 0:t.teamId,paired_user_id:null==t?void 0:t.pairedUserId}}function H(e,i,n,r){var s,o,a,c,d;return{application_fields:{build_channel:{".tag":"stable"},product_name:{".tag":i.application.productName}},device_fields:{locale:navigator.languages&&navigator.languages.length>0?navigator.languages[0]:navigator.language,platform_fields:{".tag":"client_web_device_fields",ua_browser_lang:null===(s=null==r?void 0:r.navigator)||void 0===s?void 0:s.language,is_br_cookies_enabled:null===(o=null==r?void 0:r.navigator)||void 0===o?void 0:o.cookieEnabled,ua_br_color_depth:null===(a=null==r?void 0:r.screen)||void 0===a?void 0:a.colorDepth,ua_br_viewport_width:null==r?void 0:r.innerWidth,ua_br_viewport_height:null==r?void 0:r.innerHeight,device_screen_height:null===(c=null==r?void 0:r.screen)||void 0===c?void 0:c.height,device_screen_width:null===(d=null==r?void 0:r.screen)||void 0===d?void 0:d.width,url:null==r?void 0:r.location.href,referrer:null===document||void 0===document?void 0:document.referrer,request_id:n.requestId}},client_identity_fields:W(i),events:e.map((({payload:e,ts:i,sessionId:n})=>function(e,i,n){return T(e)?{event_identifier:e,event_ts:new Date(i).toISOString(),platform_session_id:n,event_guid:t.UUID.v4()}:{event_identifier:{event_action:j(e),event_object:I(e),".tag":"predefined_event"},event_properties:F(e),event_ts:new Date(i).toISOString(),action_surface:P(e),event_class:k(e),event_state:{".tag":L(e)},platform_session_id:n,event_guid:t.UUID.v4()}}(e,i,n)))}}const J="pap_session_value",Q="pap_session_last_used";class K{constructor(e){this.events=[],this.metricsReporter=e.metricsReporter,this.configMaxSize=(null==e?void 0:e.maxSize)||2e4}dropEvents(e,t){const i=this.popEvents(e);i.forEach((e=>{void 0!==e&&e.options.onFailedToSendEvent&&e.options.onFailedToSendEvent(!1)})),this.metricsReporter.recordEventsDropped(i.length,{reason:null!=t?t:"unknown_reason"})}popEvents(e){return this.events.splice(0,e)}add(e){this.isFull()&&this.dropEvents(this.events.length-this.configMaxSize+1,"queue_full"),this.events.push(e)}requeue(e){this.events.unshift(...e),this.isFull()&&this.dropEvents(this.events.length-this.configMaxSize,"queue_full")}size(){return this.events.length}isEmpty(){return 0===this.events.length}isFull(){return this.events.length>=this.configMaxSize}}class ${constructor(e){this.eventQueueByPersistentFields={},this.configs={},this.transport=e.transport,this.sendBeaconTransport=e.sendBeaconTransport,this.configMaxEventsPerRequest=e.maxEventsPerRequest||2e3,this.metricsReporter=e.metricsReporter,this.populateWindowPropertiesCache(),this.start()}populateWindowPropertiesCache(){this.windowPropertiesCache="undefined"!=typeof window?{navigator:{language:window.navigator.language,cookieEnabled:window.navigator.cookieEnabled},screen:{height:window.screen.height,width:window.screen.width,colorDepth:window.screen.colorDepth},location:{href:window.location.href},innerWidth:window.innerWidth,innerHeight:window.innerHeight}:{navigator:{language:void 0,cookieEnabled:void 0},screen:{height:void 0,width:void 0,colorDepth:void 0},location:{href:void 0},innerWidth:0,innerHeight:0}}start(){try{document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&this.flush(!0)}))}catch(e){}try{window.addEventListener("pagehide",(()=>{this.flush(!0)}))}catch(e){}this.scheduleFlush(5e3)}add(e,t,i){this.populateWindowPropertiesCache(),function(e){return!!T(e)||void 0!==j(e)&&void 0!==I(e)}(e)||M(`Invalid event name ${O(e)}`);let n=this.eventQueueByPersistentFields[JSON.stringify(i)];void 0===n&&(n=new K({metricsReporter:this.metricsReporter}),this.eventQueueByPersistentFields[JSON.stringify(i)]=n),n.add({payload:e,ts:Date.now(),sendAttempts:0,sessionId:this.getSessionId(),options:t}),t.flush&&this.flush(),this.metricsReporter.recordQueueSize(n.size())}scheduleFlush(e){this.timeoutId=setTimeout((()=>this.flush()),e)}flush(e){var t;return n.__awaiter(this,void 0,void 0,(function*(){this.timeoutId&&clearTimeout(this.timeoutId);let i=3e4;for(const[n,r]of Object.entries(this.eventQueueByPersistentFields)){if(void 0===r||r.isEmpty())continue;const s=r.popEvents(this.configMaxEventsPerRequest);let o=!1;s.forEach((e=>e.sendAttempts++));try{const t=H(s,JSON.parse(n),this.configs,this.windowPropertiesCache),i=this.metricsReporter.createSendEventsTimer({beacon:Boolean(e).toString()});yield G(t,e&&this.sendBeaconTransport?this.sendBeaconTransport:this.transport),i.record(),o=!0}catch(e){N({err:e}),this.metricsReporter.recordRequestsFailed(1,{error_name:(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:null==e?void 0:e.message)?R(e.message):"unknown_error"})}if(this.metricsReporter.recordRequestsEvents(s.length),o)this.metricsReporter.recordRequestsSuccess(1),this.metricsReporter.recordRequestsAttempts(Math.max(...s.map((e=>e.sendAttempts)))),this.metricsReporter.recordEventsSent(s.length),r.isEmpty()||(i=2e3);else{const e=s.filter((e=>(e.options.onFailedToSendEvent&&e.options.onFailedToSendEvent(e.sendAttempts<4),e.sendAttempts<4)));e.length>0&&r.requeue(e);const t=s.length-e.length;t>0&&(this.metricsReporter.recordRequestsAttempts(Math.max(...s.map((e=>e.sendAttempts)))),this.metricsReporter.recordEventsDropped(t,{reason:"hit_max_retries"}))}}this.scheduleFlush(Math.floor(i*(.8+.4*Math.random())))}))}getSessionId(){let e;try{e=window.localStorage}catch(e){return Date.now().toString()}if(!e)return Date.now().toString();const t=e.getItem(Q);let i=e.getItem(J);return(!i||!t||parseInt(t,10)<Date.now()-18e5)&&(i=Date.now().toString(),e.setItem(J,i)),e.setItem(Q,Date.now().toString()),i}updateConfigs(e){this.configs=Object.assign(Object.assign({},this.configs),e)}}const Y="web_product_analytics_pipeline";class X{constructor(e){this.metricsReporter=r.getMetricsReporter({clientFactory:()=>n.__awaiter(this,void 0,void 0,(function*(){return(e=>{switch(e.type){case D.fetch:return r.clientFetchAdaptor(e.fetch);case D.apiv2:return r.clientBaseAdaptor(e.apiV2Client);case D.sdk:return r.clientSDKAdaptor(e.sdk)}})(e.transport)})),originKind:"pap-client"}),this.counterEventsSent=this.metricsReporter.createCounter({ns:Y,name:"pap/web/events/sent"}),this.counterRequestsEvents=this.metricsReporter.createCounter({ns:Y,name:"pap/web/requests/events"}),this.counterRequestsSuccess=this.metricsReporter.createCounter({ns:Y,name:"pap/web/requests/success"}),this.counterRequestsAttempts=this.metricsReporter.createCounter({ns:Y,name:"pap/web/requests/attempts"}),this.statsQueueSize=this.metricsReporter.createStats({ns:Y,name:"pap/web/events/queued"})}recordEventsDropped(e,t){const i=this.metricsReporter.createCounter({ns:Y,name:"pap/web/events/dropped"},t);i.increment(e),i.record()}recordEventsSent(e){this.counterEventsSent.increment(e),this.counterEventsSent.record()}recordRequestsEvents(e){this.counterRequestsEvents.increment(e),this.counterRequestsEvents.record()}recordRequestsSuccess(e){this.counterRequestsSuccess.increment(e),this.counterRequestsSuccess.record()}recordRequestsAttempts(e){this.counterRequestsAttempts.increment(e),this.counterRequestsAttempts.record()}recordRequestsFailed(e,t){const i=this.metricsReporter.createCounter({ns:Y,name:"pap/web/requests/failure"},t);i.increment(e),i.record()}recordQueueSize(e){this.statsQueueSize.record(e)}createSendEventsTimer(e){return this.metricsReporter.createTimer({ns:Y,name:"analytics-client-logger/events/send-timer"},e)}recordEventStats(e,t,i){const n=this.metricsReporter.createCounter({ns:Y,name:"analytics-client-event/"+t+"/"+e},i);n.increment(1),n.record()}recordPerformance(e){const t={latency:this.metricsReporter.createStats({ns:Y,name:"pap/web/requests/latency"}),transferSize:this.metricsReporter.createStats({ns:Y,name:"pap/web/requests/transfer_size"}),encodedBodySize:this.metricsReporter.createStats({ns:Y,name:"pap/web/requests/encoded_body_size"})};t.latency.recordDuration(e.duration,s.TimeUnit.MILLISECONDS),t.transferSize.record(e.transferSize),t.encodedBodySize.record(e.encodedBodySize)}recordPermanentlyFailedEvent(){const e=this.metricsReporter.createCounter({ns:Y,name:"pap/web/events/permanently_failed"});e.increment(1),e.record()}}const Z={application:{productName:"core_dropbox"}};class ee{constructor(e){if(this.resetPersistentFields=()=>this.persistentFields=Z,this.getPersistentFields=()=>this.persistentFields,this.setPersistentFields=e=>{var t;this.persistentFields=Object.assign(Object.assign(Object.assign({},this.persistentFields),{application:Object.assign(Object.assign({},this.persistentFields.application),e.application)}),(this.persistentFields.identity||e.identity)&&{identity:Object.assign(Object.assign({},this.persistentFields.identity),null!==(t=e.identity)&&void 0!==t?t:{})})},this.observerCallback=e=>{try{const t=e.getEntriesByName("https://www.dropbox.com/2/pap_event_logging/log_events","resource");for(const e of t)this.metricsReporter.recordPerformance(e)}catch(e){N({err:e,tags:["web_analytics_client"]})}},this.metricsReporter=new X({transport:e.transport}),this.logger=new $({transport:e.transport,sendBeaconTransport:e.sendBeaconTransport,metricsReporter:this.metricsReporter}),this.persistentFields=Z,"undefined"!=typeof window&&window.PerformanceObserver)try{new window.PerformanceObserver(this.observerCallback).observe({entryTypes:["resource"]})}catch(e){N({err:e,tags:["web_analytics_client"]})}}updateConfigs(e){this.logger.updateConfigs(e)}logExposureEvent(e,t,i,n,r){const s={experiment_variant:t,feature:e,population_id:i,identity_gid:n,stormcrow_metadata_json:r,".tag":"stormcrow_exposure_event"};this.logEvent(s)}logEvent(e,t={},i,n=!1){var r,s;if(!T(e)){const t=n?{caller:C()}:{};this.metricsReporter.recordEventStats(O(e),"pap",t)}const o=i||(null===(s=null===(r=this.persistentFields)||void 0===r?void 0:r.application)||void 0===s?void 0:s.productName)||"core_dropbox";this.logger.add(e,Object.assign(Object.assign({},t),{onFailedToSendEvent:e=>{e||this.metricsReporter.recordPermanentlyFailedEvent(),t.onFailedToSendEvent&&t.onFailedToSendEvent(e)}}),Object.assign(Object.assign({},this.persistentFields),{application:{productName:o}}))}}let te;function ie(){return te||(te=new ee({transport:{type:D.apiv2,apiV2Client:new t.NoAuthApiV2Client},sendBeaconTransport:{type:D.apiv2,apiV2Client:new t.NoAuthApiV2Client(new A)}})),te}function ne(){const e=ie().getPersistentFields(),i=function(){var e;const i=t.Viewer.get_viewer(),n=t.getActiveUserId(),r=null==i?void 0:i.team_id,s=null===(e=null==i?void 0:i.get_users().find((({id:e})=>e!==n)))||void 0===e?void 0:e.id;return Object.assign(Object.assign(Object.assign({},n&&{userId:n}),r&&{teamId:r}),s&&{pairedUserId:s})}(),n=[i,e.identity||{}].some((e=>Object.keys(e).length));ie().setPersistentFields(Object.assign(Object.assign({},e),!!n&&{identity:Object.assign(Object.assign({},i),e.identity)}))}e.getAnalyticsClientSingleton=ie,e.logEvent=function(e,t={},i="core_dropbox",n=!1){ne(),ie().logEvent(e,t,i,n)},e.setPersistentFields=function(e){ie().setPersistentFields(e)},e.updateConfigs=function(e){ie().updateConfigs(e)}}));
//# sourceMappingURL=c_pap-client_analytics_client.js-vflfWf_MC.map
