define(["exports","react"],(function(t,e){"use strict";function s(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(s){if("default"!==s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}})),e.default=t,Object.freeze(e)}var r=s(e);class i{unregisterChild(t){this.children=this.children.filter((e=>e!==t)),this.updateStatus()}registerChild(t){this.children=[...this.children,t],this.updateStatus()}updateStatus(){(this.children.length>0||this.callbacks.length>0)!==this.isActive&&(this.isActive?(this.isActive=!1,this.parents.forEach((t=>t.unregisterChild(this)))):(this.isActive=!0,this.previousValue=this.currentValue,this.parents.forEach((t=>t.registerChild(this)))))}obs(t){const e=(e,s)=>t(e,s);return this.callbacks=[...this.callbacks,e],this.updateStatus(),()=>{this.cancelledCallbacks.set(e,!0),this.callbacks=this.callbacks.filter((t=>t!==e)),this.updateStatus()}}updateValue(){const t=this.parents;if(this.generation=this.tracker.generation,this.tracker.stack.push([]),this.currentValue=this.getter(this.currentValue),this.parents=this.tracker.stack.pop()||[],!this.isActive)return;this.currentValue!==this.previousValue&&(this.tracker.toUpdate=[...this.tracker.toUpdate,...this.children],this.tracker.toNotify=[...this.tracker.toNotify,this]);const e=this.parents,s=e.filter((e=>!t.find((t=>e===t)))),r=t.filter((t=>!e.find((e=>t===e))));s.forEach((t=>t.registerChild(this))),r.forEach((t=>t.unregisterChild(this)))}get(){return(this.tracker.stack[this.tracker.stack.length-1]||[]).push(this),this.generation!==this.tracker.generation&&this.updateValue(),this.currentValue}notify(){if(this.currentValue===this.previousValue)return;const t=this.previousValue;this.previousValue=this.currentValue,this.callbacks.forEach((e=>{this.cancelledCallbacks.has(e)||e(this.currentValue,t)}))}set(t){if(this.tracker.depth++,this.tracker.generation++,this.tracker.toUpdate.push(this),this.setter(t),this.tracker.depth--,0===this.tracker.depth){for(;this.tracker.toUpdate.length>0;){const t=this.tracker.toUpdate;this.tracker.toUpdate=[],t.forEach((t=>t.updateValue()))}for(;this.tracker.toNotify.length>0;){const t=this.tracker.toNotify;this.tracker.toNotify=[],t.forEach((t=>t.notify()))}}}constructor(t,e,s){this.callbacks=[],this.children=[],this.parents=[],this.isActive=!1,this.cancelledCallbacks=new WeakMap,this.tracker=t,this.getter=e,this.setter=s,this.currentValue=this.getter(null),this.previousValue=this.currentValue,this.generation=this.tracker.generation,this.updateValue()}}const a=new class{constructor(){this.stack=[],this.depth=0,this.generation=0,this.toNotify=[],this.toUpdate=[]}},h=t=>{let e=t;return new i(a,(()=>e),(t=>{e=t}))},c=t=>{const[,e]=r.useState((()=>t.get()));return r.useEffect((()=>t.obs((t=>e(t)))),[t]),t.get()};t.batch=t=>(t=>{const e=new i(a,(()=>null),(e=>t(...e)));return(...t)=>e.set(t)})(t)(),t.proxy=(t,e)=>new i(a,t,e||(()=>{})),t.store=h,t.useInitStore=(t,e)=>{const s=(t=>{const[e]=r.useState((()=>h(t)));return e.set(t),e})(t);return r.useState((()=>e(s)))[0]},t.useStore=c}));
//# sourceMappingURL=c_utils_dsx_dsx-react.js-vflIQz2lN.map
