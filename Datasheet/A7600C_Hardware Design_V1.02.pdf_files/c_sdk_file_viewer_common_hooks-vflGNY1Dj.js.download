define(["exports","./c_tslib","react","./e_file_viewer_edison_shmodel_file_async","./c_core_i18n","./c_ui-icon_fill_star"],(function(e,t,r,a,s,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=n(r);var l;!function(e){e.HOME_STARRED="HOME_STARRED",e.HOME_RECENTS="HOME_RECENTS",e.BROWSE="BROWSE",e.FILE_VIEWER="FILE_VIEWER",e.SUGGESTED_STARS="SUGGESTED_STARS",e.HOME_TASKS="HOME_TASKS",e.QUICK_VIEW_BROWSE="QUICK_VIEW_BROWSE"}(l||(l={}));const d=[l.HOME_STARRED,l.HOME_RECENTS];const c=new class{logClick(e,t,r,s,i,n){if("BROWSE"===i)return Promise.resolve();const o=[];if(d.includes(i)){const i=n?a.StarredLoggingTypes.CLICK_STAR:a.StarredLoggingTypes.CLICK_UNSTAR;o.push(a.logHomeActivity({eventName:i,role:e.role,extra:{resource_id:t,id_type:r,is_dir:s}}))}const l=n?a.WebUserActionLogEvent.STAR:a.WebUserActionLogEvent.REMOVE_STAR;return o.push(a.WebUserActionLog.log(e.id,l,{resource_id:t,id_type:r,is_dir:s,role:e.role,source:i})),Promise.all(o)}};const u=({user:e,id:t,idType:n,isDir:l,source:d,itemName:u,onStarClick:S,tooltipPlacement:_,isReadOnly:E,isTabbing:f,tabIndex:g,starButtonClassName:m,alwaysShowUnstarred:R,ariaLabelledBy:C})=>{const p=a.useSelector((e=>a.getFileStarredData(e,t)));let T=!1,b=!0;(null==p?void 0:p.loadingState)===a.StarredLoadingStateEnum.LOAD_SUCCESS&&(T=p.isStarred,b=!1);const[I]=o.default.useState((()=>function(e){const t=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1),r=t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t();return e?e+r:r}("star-"))),v=a.useDispatch(),A=o.default.useRef(null),[O,M]=r.useState(!1),N=()=>{M(!1)};r.useEffect((()=>(O?window.addEventListener("scroll",N,!0):window.removeEventListener("scroll",N,!0),()=>window.removeEventListener("scroll",N,!0))),[O]);const h=o.default.useMemo((()=>E?T?s.intl.formatMessage({id:"LAVXPn",defaultMessage:"Starred"}):null:T?s.intl.formatMessage({id:"XQNf7s",defaultMessage:"Remove from Starred"}):s.intl.formatMessage({id:"iGfiaV",defaultMessage:"Add to Starred"})),[T,E]),L=o.default.useCallback((r=>{if(r.stopPropagation(),r.preventDefault(),!b){const r=!T;c.logClick(e,t,n,l,d,r),S&&S(r),v(a.updateStarredStatus({id:t,idType:n,newStatus:r,itemName:u,showSnackbar:!0}))}}),[b,T]);if(void 0===T)return null;if(E&&!T)return null;const y={star__toggle:!0,"star__toggle--starred":T,"star__toggle--unstarred":!T&&!f&&!R,"star__toggle--loading":b};return o.default.createElement("div",{ref:A,onMouseOver:()=>M(!0),onMouseOut:N},o.default.createElement(a.Tooltip.Control,{triggerRef:A,placement:_||"top",open:O},h),o.default.createElement("button",{className:a.cx(y,m),role:"button","aria-pressed":T,"aria-label":h,onClick:L,onDoubleClick:L,disabled:E,tabIndex:g,id:I,"aria-labelledby":a.cx(I,C)},o.default.createElement("span",{hidden:!0},h),o.default.createElement(a.UIIcon,{src:T?i.StarFill:a.StarLine})))};function S(e,s,n,o,l){r.useEffect((()=>{l&&e(a.fetchMissingStarredStatuses([{id:s.file_id,type:a.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID}]))}),[s,l,e]);const d=r.useCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){const t=yield e(a.updateStarredStatus({id:s.file_id,newStatus:!n,showSnackbar:!1}));try{a.unwrapResult(t),a.displayStarSnackbar({itemName:a.itemNameFromStarrableItem(s),isStarred:!n,success:!0}),null==o||o(!n,!0)}catch(e){a.displayStarSnackbar({itemName:a.itemNameFromStarrableItem(s),isStarred:!n,success:!1}),null==o||o(!n,!1)}}))),[o,e,s,n]);return{message:n?a.UNSTAR_ACTION_STRING:a.STAR_ACTION_STRING,iconSrc:n?i.StarFill:a.StarLine,handleClick:d,isStarred:n}}u.displayName="_Star",a.requireCssWithComponent(u,["/static/metaserver/static/css/starred/star-vflnmwtfY.css"]),e.useStarControl=function({getActiveFile:e,onChange:t,user:r}){const{file:s}=e(),i=a.useDispatch(),n=a.useSelector((e=>a.getIsStarred(e,s.file_id)));return S(i,s,n,t,r)},e.useStarControlWithStore=function({getActiveFile:e,onChange:t,user:s,starredStore:i}){const{file:n}=e(),o=i.dispatch,[l,d]=r.useState(a.getIsStarred(i.getState(),n.file_id));return r.useEffect((()=>{const e=i.subscribe((()=>d(a.getIsStarred(i.getState(),n.file_id))));return()=>e()}),[n.file_id,i]),S(o,n,l,t,s)}}));
//# sourceMappingURL=c_sdk_file_viewer_common_hooks.js-vfleu_ciA.map
