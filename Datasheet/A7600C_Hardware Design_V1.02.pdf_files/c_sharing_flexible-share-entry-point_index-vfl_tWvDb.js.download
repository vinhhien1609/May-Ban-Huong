define(["require","exports","./c_tslib","react","./e_file_viewer_edison_shmodel_file_async","./c_utils_dsx_dsx-react","./c_core_i18n","./c_ui-icon_line_email","./c_ui-icon_line_settings","./e_edison","./c_apex-metrics_src_types","./e_core_exception","./c_core_exception_info","./c_lodash-es_lodash","./c_core_notify","react-dom","metaserver/static/js/modules/constants/env","./c_src_sink_index","metaserver/static/js/modules/constants/viewer","./c_core_xhr","./c_csrf","./c_init_data_runtime","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/fingerprintjs_constants","metaserver/static/js/modules/constants/sharing","./c_security_util","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/constants/pdf_editing","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/unity","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/langpack"],(function(e,t,n,o,i,a,r,l,s,c,_,d,m,u,g,p,b,y,f,w,v,x,h,E,B,S,q,A,k,C,T,N,I,j,O,L,$,P,M){"use strict";function z(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var R=z(o);const D=["copy_link","invite","cancel","clickaway","settings","qr_code"];function F(e){return D.find((t=>t===(null==e?void 0:e.toLowerCase())))}const W=Symbol("ON_SELECT_FLEXIBLE_ENTRY_POINT_ACTION"),Y=Symbol("ON_HOVER_FLEXIBLE_ENTRY_POINT_ACTION"),V=Symbol("ON_LOG_FLEXIBLE_ENTRY_POINT_ACTION_DWELL_TIME"),{useEmitter:U,defaultEmitter:H}=i.defineLogger((({event:e,getContextValue:t})=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=t(i.Context),o=t(i.Context$1),a=yield i.getHashedKeys(o),r=Object.assign(Object.assign({},i.getTags(a)),i.getTags$1(n));if(e.key!==W)if(e.key!==Y)if(e.key!==V);else i.UDCL.logEvent(function(e){return{class:"sharing_sender",action:"log",object:"flexible_sharing_entrypoint_action_dwell_time",properties:e}}({flexibleSharingEntryPointAction:F(e.payload.action),fileExtension:e.payload.fileExtension,flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:e.payload.selected}),{tags:r});else i.UDCL.logEvent(function(e){return{class:"sharing_sender",action:"hover",object:"flexible_sharing_entrypoint_action",properties:e}}({flexibleSharingEntryPointAction:F(e.payload.action),fileExtension:e.payload.fileExtension}),{tags:r});else i.UDCL.logEvent({class:"sharing_sender",action:"select",object:"flexible_sharing_entrypoint_action",properties:{flexibleSharingEntryPointAction:F(e.payload.action),fileExtension:e.payload.fileExtension,flexibleSharingEntryPointTimeToAction:e.payload.timeToAction}},{tags:r})})))),K=e=>R.default.useCallback((()=>{e.$dwellFlexibleEntryPointActionTimestamp.set(Date.now())}),[e.$dwellFlexibleEntryPointActionTimestamp]),G=e=>{const t=U();return R.default.useCallback(((n,o)=>{const a=e.$dwellFlexibleEntryPointActionTimestamp.get();if(a){const r=Date.now()-a;t.select(V).emit({action:n,fileExtension:i.getExtension(e.$file.get()),dwellTime:r,selected:o}),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}}),[e.$dwellFlexibleEntryPointActionTimestamp,e.$file,t])};i.injectInternalStyle("/static/typescript/component_libraries/retrieval-components/src/browse-action-bar/action_bar_simple_button.module.out-vfldu-itH.css",(e=>"._browseActionBarSimpleButton_mwqly_1,.browseActionBarSimpleButton{border-radius:var(--dig-radius__large);cursor:pointer;height:76px;overflow:hidden;text-align:left;width:140px}._browseActionBarSimpleButton_mwqly_1._browseActionBarSimpleButton--iconOnly_mwqly_11{height:48px;width:48px}._browseActionBarSimpleButton-content_mwqly_16{box-sizing:border-box;display:flex;flex-direction:column;gap:var(--spacing__unit--1_5);height:100%;padding:var(--spacing__unit--1_5);width:100%}._browseActionBarSimpleButton-content_mwqly_16 ._browseActionBarSimpleButton-label_mwqly_26{flex-shrink:0;font-family:var(--type__title__standard--fontfamily);font-size:13px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}._browseActionBarActionButton-label_mwqly_37{font-size:var(--type__body__small--fontsize);font-weight:var(--type__body__standard--fontweight_strong);line-height:var(--type__body__small--lineheight);padding-top:var(--dig-spacing__micro__xsmall)}._browseActionBarSimpleButton--icon_mwqly_11{flex-shrink:0}._browseActionBarSimpleButton_mwqly_1._browseActionBarSimpleButton--iconOnly_mwqly_11 ._browseActionBarSimpleButton-label_mwqly_26{display:none}._browseActionBarSimpleButton--loading_mwqly_53,.browseActionBarSimpleButton--loading{background-color:var(--dig-color__background__base);border:1px solid var(--dig-color__border__subtle);margin-left:var(--spacing__unit--2)}._browseActionBarSimpleButton--primary_mwqly_61,.browseActionBarSimpleButton--primary{background-color:var(--dig-color__primary-cta__base);color:var(--dig-color__primary-cta__on-base)}._browseActionBarSimpleButton--primary_mwqly_61._browseActionBarSimpleButton--isDisabled_mwqly_67{background-color:var(--dig-color__disabled__base);color:var(--dig-color__disabled__on-base)}._browseActionBarSimpleButton--primary_mwqly_61:hover{background-color:var(--dig-color__primary-cta__base--state-1)}._browseActionBarSimpleButton--primary_mwqly_61:active,._browseActionBarSimpleButton--primary_mwqly_61[aria-expanded=true]{background-color:var(--dig-color__primary-cta__base--state-2)}._browseActionBarSimpleButton--secondary_mwqly_81{background-color:var(--dig-color__background__base);border:1px solid var(--dig-color__border__subtle)}._browseActionBarSimpleButton--secondary_mwqly_81:active,._browseActionBarSimpleButton--secondary_mwqly_81:hover,._browseActionBarSimpleButton--secondary_mwqly_81[aria-expanded=true]{background-color:var(--dig-color__background__subtle)}._browseActionBarSimpleButton--dropzone_mwqly_92{background-color:var(--dig-color__background__base);border:1px dashed var(--dig-color__border__base)}._browseActionBarSimpleButton--dropzone_mwqly_92:active,._browseActionBarSimpleButton--dropzone_mwqly_92:hover,._browseActionBarSimpleButton--dropzone_mwqly_92[aria-expanded=true]{background-color:var(--dig-color__background__subtle)}._browseActionBarSimpleButton--isDisabled_mwqly_67{color:var(--dig-color__disabled__on-surface);cursor:auto;pointer-events:none}._highlightedRowAcessory_mwqly_109{background-color:var(--dig-color__background__base);margin-left:0;margin-right:var(--dig-spacing__micro__large);margin-top:var(--dig-spacing__micro__small);padding:var(--dig-spacing__micro__xsmall)}._noScrollBar_mwqly_117{overflow:hidden}._highlightedIllustrationContainer_mwqly_121{align-items:center;background-color:var(--dig-color__background__base);display:flex;height:126px;justify-content:center;max-width:inherit;overflow:hidden}._highlightedTooltipTitle_mwqly_131{padding-top:var(--dig-spacing__micro__small)}._highlightedMenuItem_mwqly_135,._highlightedMenuItem_mwqly_135:hover{background-color:var(--dig-color__background__subtle);margin-bottom:calc(var(--dig-spacing__micro__small)*-1);padding-bottom:var(--dig-spacing__micro__xsmall);padding-top:var(--dig-spacing__micro__small)}._roundedDiv_mwqly_144{border-radius:var(--dig-radius__medium)}._highlightedMenuItemLabel_mwqly_148{font-size:var(--type__body__small--fontsize);font-weight:var(--type__body__standard--fontweight_strong);line-height:var(--type__body__small--lineheight);margin-bottom:0;padding-top:0}._highlightedActionButtonContainer_mwqly_156{padding-top:var(--dig-spacing__micro__medium)}"));const X="_browseActionBarSimpleButton_mwqly_1",Q="_browseActionBarSimpleButton--iconOnly_mwqly_11",Z="_browseActionBarSimpleButton-content_mwqly_16",J="_browseActionBarSimpleButton-label_mwqly_26",ee="_browseActionBarSimpleButton--icon_mwqly_11",te="_browseActionBarSimpleButton--loading_mwqly_53",ne="_browseActionBarSimpleButton--primary_mwqly_61",oe="_browseActionBarSimpleButton--isDisabled_mwqly_67",ie="_browseActionBarSimpleButton--secondary_mwqly_81",ae="_browseActionBarSimpleButton--dropzone_mwqly_92",re=R.default.forwardRef(((e,t)=>{var o,a,{className:r,disabled:l=!1,disabledTooltip:s,icon:c,iconOnly:_,label:d,onClick:m,tooltip:u,variant:g,buttonRef:p,campaignsElementId:b}=e,y=n.__rest(e,["className","disabled","disabledTooltip","icon","iconOnly","label","onClick","tooltip","variant","buttonRef","campaignsElementId"]);const f=R.default.useRef(null),[w,v]=R.default.useState(!1),x=i.cx(X,{[ne]:"primary"===g,[ie]:"secondary"===g,[ae]:"dropzone"===g,[oe]:l,[Q]:_},r);R.default.useEffect((()=>{var e,t,n,o;const i=(null!==(t=null===(e=f.current)||void 0===e?void 0:e.scrollWidth)&&void 0!==t?t:0)>(null!==(o=null===(n=f.current)||void 0===n?void 0:n.clientWidth)&&void 0!==o?o:0);i&&!w?v(!0):!i&&w&&v(!1)}),[w,null===(o=f.current)||void 0===o?void 0:o.scrollWidth,null===(a=f.current)||void 0===a?void 0:a.clientWidth]);const h=R.default.createElement(i.StylelessButton,Object.assign({ref:p||t,onClick:m,disabled:l,className:x,"aria-label":d,"data-campaigns-element-id":b},y),R.default.createElement("span",{className:Z},R.default.createElement(i.UIIcon,{className:ee,src:c}),R.default.createElement(i.Text,{className:J,color:"inherit",isBold:!0,size:"small",variant:"label",ref:f},d)));return l&&s?R.default.createElement(i.Tooltip,Object.assign({},s),R.default.createElement("div",{tabIndex:0},h)):u?R.default.createElement(i.Tooltip,Object.assign({},u),R.default.createElement("div",null,h)):w?R.default.createElement(i.Tooltip,{title:d,placement:"bottom-start"},R.default.createElement("div",null,h)):h}));re.displayName="ActionBarSimpleButton";R.default.forwardRef((({},e)=>{const t=i.cx(X,te);return R.default.createElement(i.StylelessButton,{ref:e,onClick:()=>{},disabled:!0,className:t,"aria-label":"loading","data-campaigns-element-id":""},R.default.createElement("span",{className:Z}))})).displayName="ActionBarSimpleButtonLoading";i.injectInternalStyle("/static/metaserver/static/js/sharing/flexible-share-entry-point/flexible-share-entry-point.module.out-vflW3Z_c3.css",(e=>"._header-wrapper_1q4gb_1{align-items:center;display:flex;width:100%}._header-file-icon-container_1q4gb_7{align-items:center;display:flex;flex-grow:0;justify-content:center;margin-right:8}._header-file-name-container_1q4gb_15{align-items:flex-start;display:flex;flex-direction:column;flex-grow:1;justify-content:center;overflow:hidden}._header-file-name_1q4gb_15{white-space:nowrap;width:100%}._share-entry-point-container_1q4gb_29{background:var(--dig-color__background__base);flex-shrink:0;padding:30px;width:344px}._body-wrapper_1q4gb_40,._share-entry-point-container_1q4gb_29{align-items:center;display:flex;flex-direction:column;gap:12px}._body-wrapper_1q4gb_40{align-self:stretch;padding-top:8px}._body-copy-button-container_1q4gb_49{align-content:center;align-items:center;align-self:stretch;display:flex;flex-wrap:wrap;gap:12px}._body-copy-button_1q4gb_49{display:flex;flex-grow:1}._body-share-button-container_1q4gb_63{align-content:center;align-items:center;align-self:stretch;display:flex;flex-wrap:wrap;gap:12px 8px;justify-content:center;padding-top:8px}._body-share-button_1q4gb_63{border:1px solid var(--dig-color__border__subtle)}._body-share-button-icon-container_1q4gb_78{align-items:center;display:flex;flex:1;flex-direction:row;justify-content:flex-start}._body-share-button-icon-container-text_1q4gb_86{font-size:12px;font-style:normal;font-weight:500;letter-spacing:.24px;line-height:16px;padding-left:12px}._share-entry-point-click-outside_1q4gb_95{margin-left:0}"));const le="_header-wrapper_1q4gb_1",se="_header-file-icon-container_1q4gb_7",ce="_header-file-name-container_1q4gb_15",_e="_header-file-name_1q4gb_15",de="_share-entry-point-container_1q4gb_29",me="_body-wrapper_1q4gb_40",ue="_body-copy-button-container_1q4gb_49",ge="_body-copy-button_1q4gb_49",pe="_body-share-button-container_1q4gb_63",be="_body-share-button_1q4gb_63",ye="_body-share-button-icon-container_1q4gb_78",fe="_body-share-button-icon-container-text_1q4gb_86",we="_share-entry-point-click-outside_1q4gb_95";var ve;!function(e){e.CLICKAWAY="clickaway",e.SETTINGS="settings",e.CANCEL="cancel",e.COPY_LINK="copy_link",e.INVITE="invite"}(ve||(ve={}));const xe=e=>{const t=(e=>a.useInitStore(e,(e=>{const t=a.proxy((()=>e.get().file)),n=a.proxy((()=>e.get().user)),o=a.proxy((()=>e.get().shareModalExtras)),i=a.proxy((()=>e.get().modalRef)),r=a.proxy((()=>e.get().isOpen)),l=a.store(Date.now()),s=a.store(void 0);return{$file:t,$user:n,$shareModalExtras:o,$modalRef:i,$isOpen:r,$onRequestClose:a.proxy((()=>()=>{e.get().onRequestClose(),s.set(void 0)})),$openFlexibleEntryPointTimestamp:l,$dwellFlexibleEntryPointActionTimestamp:s}})))(e),n=a.useStore(t.$file),o=a.useStore(t.$isOpen),r=a.useStore(t.$modalRef),l=a.useStore(t.$openFlexibleEntryPointTimestamp),s=a.useStore(t.$onRequestClose),c=U(),_=R.useCallback((()=>{const e=l&&Date.now()-l;c.select(W).emit({action:ve.CLICKAWAY,fileExtension:i.getExtension(n),timeToAction:e}),s()}),[n,s,l,c]);return R.createElement("div",{className:we},R.createElement(i.ClickOutside,{isActive:!0,onClickOutside:_},R.createElement(i.Menu.Content,{triggerOffset:16,triggerRef:r,open:o,placement:"bottom-end"},R.createElement("div",{className:de},R.createElement(he,Object.assign({},t)),R.createElement(Ee,Object.assign({},t))))))};xe.displayName="FlexibleShareEntryPoint";const he=e=>{const t=a.useStore(e.$file),n=a.useStore(e.$user),o=a.useStore(e.$shareModalExtras),r=a.useStore(e.$openFlexibleEntryPointTimestamp),l=a.useStore(e.$onRequestClose),c=U(),_=K(e),d=G(e),m=R.useCallback((()=>{const e=r&&Date.now()-r;c.select(W).emit({action:ve.SETTINGS,fileExtension:i.getExtension(t),timeToAction:e}),d("settings",!0),l(),i.share(t,n,null,Object.assign(Object.assign({},o),{initialScreen:"settings"}))}),[t,n,o,l,r,d,c]),u=R.useCallback((()=>{_(),c.select(Y).emit({action:ve.SETTINGS,fileExtension:i.getExtension(t)})}),[t,_,c]),g=R.useCallback((()=>{const e=r&&Date.now()-r;c.select(W).emit({action:ve.CANCEL,fileExtension:i.getExtension(t),timeToAction:e}),d(ve.CANCEL,!0),l()}),[t,l,r,d,c]),p=R.useCallback((()=>{_(),c.select(Y).emit({action:ve.CANCEL,fileExtension:i.getExtension(t)})}),[t,_,c]),b=R.useMemo((()=>{const e=i.getFilename(t);return i.Emstring.em_snippet(e,13)}),[t]);return R.createElement("div",{className:le},R.createElement("div",{className:se},R.createElement(i.FileIcon,{size:"small",extension:i.getExtension(t)})),R.createElement("div",{className:ce},R.createElement(i.Title,{className:_e,size:"small",weightVariant:"emphasized"},b),R.createElement("div",null,R.createElement(i.Text,{color:"faint",style:{lineHeight:"18px"}},i.format_bytes$1(t.bytes)))),R.createElement("div",null,R.createElement(i.IconButton,{onClick:m,onMouseEnter:u,onMouseLeave:()=>d("settings",!1),size:"medium",variant:"borderless"},R.createElement(i.UIIcon,{src:s.SettingsLine}))),R.createElement("div",null,R.createElement(i.IconButton,{onClick:g,onMouseEnter:p,onMouseLeave:()=>d("cancel",!1),variant:"borderless"},R.createElement(i.UIIcon,{src:i.CloseLine}))))};he.displayName="Header";const Ee=t=>{const o=a.useStore(t.$file),s=a.useStore(t.$user),c=a.useStore(t.$shareModalExtras),_=a.useStore(t.$modalRef),d=a.useStore(t.$openFlexibleEntryPointTimestamp),m=a.useStore(t.$onRequestClose),u=U(),g=K(t),p=G(t),b=i.useAfterDisplayPassthroughCallback({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return new Promise((function(t,n){e(["./c_views_copy_link_mini_modal"],t,n)})).then((({CopyLinkMiniModal:e})=>({default:{fn:e.show}})))}))}),y=R.useCallback((()=>{const e=d&&Date.now()-d;u.select(W).emit({action:ve.COPY_LINK,fileExtension:i.getExtension(o),timeToAction:e});const t={user:s,filePath:o.file_id,setIsCreatingSharedLink:()=>{},anchorRef:_,zIndexOverride:500,yOffsetDistance:8,userActionSurfaceLogValue:i.ActionSurfaceLogValue.FLEXIBLE_SHARING_ENTRYPOINT};p("copy_link",!0),m(),b.fn(t)}),[o,s,_,m,b,d,p,u]),f=R.useCallback((()=>{g(),u.select(Y).emit({action:ve.COPY_LINK,fileExtension:i.getExtension(o)})}),[o,g,u]),w=R.useCallback((()=>{const e=d&&Date.now()-d;u.select(W).emit({action:ve.INVITE,fileExtension:i.getExtension(o),timeToAction:e}),p("invite",!0),m(),i.share(o,s,null,Object.assign({},c))}),[o,m,c,s,d,p,u]),v=R.useCallback((()=>{g(),u.select(Y).emit({action:ve.INVITE,fileExtension:i.getExtension(o)})}),[o,g,u]);return R.createElement("div",{className:me},R.createElement("div",{className:ue},R.createElement(re,{className:ge,icon:i.LinkLine,label:(x=r.intl,x.formatMessage({id:"0EQDHd",defaultMessage:"Copy link"})),variant:"secondary",onClick:y,onMouseEnter:f,onMouseLeave:()=>p("copy_link",!1)})),R.createElement("div",{className:pe},R.createElement(i.Button,{fullWidth:!0,size:"xlarge",variant:"outline",className:be,onClick:w,onMouseEnter:v,onMouseLeave:()=>p("invite",!1)},R.createElement("div",{className:ye},R.createElement(i.UIIcon,{size:"medium",src:l.EmailLine}),R.createElement(i.Text,{className:fe},(e=>e.formatMessage({id:"WEzLsZ",defaultMessage:"Invite via email"}))(r.intl))))));var x};Ee.displayName="Body",t.FlexibleShareEntryPoint=xe}));
//# sourceMappingURL=c_sharing_flexible-share-entry-point_index.js-vflZboCmb.map
