define(["exports"],(function(t){"use strict";t.KMPSearch=class{constructor(t,e){this.segments=[],this.searchResult=new Map,this.searchOptions={parseText:t=>t,shouldAddSyntheticSpace:()=>!0},this.nextHitIndex=0,this._hitCount=0,e&&(this.searchOptions=Object.assign(Object.assign({},this.searchOptions),e)),this.getSegments=t}get hitCount(){return this._hitCount}makePrefixJumps(t){const e=new Array(t.length+1);let s=0;e[0]=-1;for(let h=1;h<e.length-1;h++){if(t[h]===t[s])e[h]=e[s];else for(e[h]=s;s>=0&&t[h]!==t[s];)s=e[s];s++}return e[e.length-1]=s,e}addMatch(t,e,s,h,n){var i,a,r,c;if(this.searchResult.has(t)||this.searchResult.set(t,new Map),(null===(i=this.searchResult.get(t))||void 0===i?void 0:i.has(e))||null===(a=this.searchResult.get(t))||void 0===a||a.set(e,new Set),null===(c=null===(r=this.searchResult.get(t))||void 0===r?void 0:r.get(e))||void 0===c||c.add({startingCharIndex:Math.max(s-h,0),endingCharIndex:s,hitNumber:this.nextHitIndex}),s<h){const i=0===e?t-1:t,a=0===e?this.segments[i].chunks.length-1:e-1,r=this.searchOptions.parseText(this.segments[i].chunks[a].t);this.addMatch(i,a,r.length-1,h-s-1,n)}else n({segments:this.segments,segmentIndex:t,chunkIndex:e,searchPosition:s,searchTermPosition:h}),this.nextHitIndex++,this._hitCount++}searchSegments(t,e=(()=>{}),s=(()=>{})){if(this.segments=this.getSegments(),this.searchResult=new Map,this.nextHitIndex=0,this._hitCount=0,!t||!this.segments)return this.searchResult;let h=0,n=0,i=0;const a=this.makePrefixJumps(t);for(let s=0;s<this.segments.length;s++){const r=this.segments[s].chunks;for(let c=0;c<r.length;c++){const l=this.searchOptions.parseText(r[c].t);for(;h<l.length;)t[n]===l[h]?(n++,h++,n===t.length&&(this.addMatch(s,c,h-1,n-1-i,e),n=0,i=0)):(n=a[n],i=0,n<0&&(n++,h++));c<r.length-1&&0!==l.length&&" "!==l[l.length-1]&&this.searchOptions.shouldAddSyntheticSpace({segments:this.segments,segmentIndex:s,chunkIndex:c,searchPosition:h,searchTermPosition:n})&&(" "===t[n]?(n++,i++,n===t.length&&(this.addMatch(s,c,h-1,n-1-i,e),n=0,i=0)):(n=a[n],i=0,n<0&&n++)),h=0}}return s(this.searchResult),this.searchResult}}}));
//# sourceMappingURL=c_file_viewer_core_kmp_search.js-vflZobRd7.map
