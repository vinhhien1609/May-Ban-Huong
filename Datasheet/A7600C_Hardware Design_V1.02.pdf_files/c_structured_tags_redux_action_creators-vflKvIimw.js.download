define(["exports","./c_tslib","./e_file_viewer_edison_shmodel_file_async","./c_apex-metrics_src_types","./c_tagging_api","./c_capture_redux_store","./c_core_i18n"],(function(t,e,r,s,n,i,a){"use strict";const o=t=>r.getStateAtNamespace(t,r.STRUCTURED_TAGS_NAMESPACE_KEY)||i.defaultStructuredTagState;var u,l;t.TemplateType=void 0,(u=t.TemplateType||(t.TemplateType={}))[u.MANUAL_CLASSIFICATION=0]="MANUAL_CLASSIFICATION",u[u.MANAGED_METADATA=1]="MANAGED_METADATA",s.proto3.util.setEnumType(t.TemplateType,"structured_tags.TemplateType",[{no:0,name:"MANUAL_CLASSIFICATION"},{no:1,name:"MANAGED_METADATA"}]),t.StructuredTagColor=void 0,(l=t.StructuredTagColor||(t.StructuredTagColor={}))[l.GREEN=0]="GREEN",l[l.BLUE=1]="BLUE",l[l.YELLOW=2]="YELLOW",l[l.RED=3]="RED",l[l.GRAY=4]="GRAY",s.proto3.util.setEnumType(t.StructuredTagColor,"structured_tags.StructuredTagColor",[{no:0,name:"GREEN"},{no:1,name:"BLUE"},{no:2,name:"YELLOW"},{no:3,name:"RED"},{no:4,name:"GRAY"}]);class d extends s.Message{constructor(e){super(),this.id=s.protoInt64.zero,this.name="",this.isDeleted=!1,this.description="",this.color=t.StructuredTagColor.GREEN,s.proto3.util.initPartial(e,this)}static fromBinary(t,e){return(new d).fromBinary(t,e)}static fromJson(t,e){return(new d).fromJson(t,e)}static fromJsonString(t,e){return(new d).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(d,t,e)}}d.runtime=s.proto3,d.typeName="structured_tags.StructuredTagsSelectionValue",d.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"id",kind:"scalar",T:4},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"is_deleted",kind:"scalar",T:8},{no:5,name:"description",kind:"scalar",T:9},{no:6,name:"color",kind:"enum",T:s.proto3.getEnumType(t.StructuredTagColor)}]));class c extends s.Message{constructor(t){super(),this.values=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new c).fromBinary(t,e)}static fromJson(t,e){return(new c).fromJson(t,e)}static fromJsonString(t,e){return(new c).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(c,t,e)}}c.runtime=s.proto3,c.typeName="structured_tags.StructuredTagsSelectionValues",c.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"values",kind:"message",T:d,repeated:!0}]));class m extends s.Message{constructor(t){super(),this.id=s.protoInt64.zero,this.name="",this.isDeleted=!1,this.values={case:void 0},s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new m).fromBinary(t,e)}static fromJson(t,e){return(new m).fromJson(t,e)}static fromJsonString(t,e){return(new m).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(m,t,e)}}m.runtime=s.proto3,m.typeName="structured_tags.StructuredTagsField",m.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"id",kind:"scalar",T:4},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"is_deleted",kind:"scalar",T:8},{no:4,name:"selection_values",kind:"message",T:c,oneof:"values"}]));class p extends s.Message{constructor(e){super(),this.id=s.protoInt64.zero,this.name="",this.isDeleted=!1,this.isActivated=!1,this.type=t.TemplateType.MANUAL_CLASSIFICATION,this.fields=[],this.lastModifiedTime=s.protoInt64.zero,s.proto3.util.initPartial(e,this)}static fromBinary(t,e){return(new p).fromBinary(t,e)}static fromJson(t,e){return(new p).fromJson(t,e)}static fromJsonString(t,e){return(new p).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(p,t,e)}}p.runtime=s.proto3,p.typeName="structured_tags.StructuredTagsTemplate",p.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"id",kind:"scalar",T:4},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"is_deleted",kind:"scalar",T:8},{no:4,name:"is_activated",kind:"scalar",T:8},{no:5,name:"type",kind:"enum",T:s.proto3.getEnumType(t.TemplateType)},{no:6,name:"fields",kind:"message",T:m,repeated:!0},{no:7,name:"last_modified_time",kind:"scalar",T:4}]));class f extends s.Message{constructor(t){super(),this.templateId=s.protoInt64.zero,s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new f).fromBinary(t,e)}static fromJson(t,e){return(new f).fromJson(t,e)}static fromJsonString(t,e){return(new f).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(f,t,e)}}f.runtime=s.proto3,f.typeName="structured_tags.StructuredTagCypressKey",f.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"template_id",kind:"scalar",T:4}]));class g extends s.Message{constructor(t){super(),this.fieldValues=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new g).fromBinary(t,e)}static fromJson(t,e){return(new g).fromJson(t,e)}static fromJsonString(t,e){return(new g).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(g,t,e)}}g.runtime=s.proto3,g.typeName="structured_tags.StructuredTagCypressValue",g.fields=s.proto3.util.newFieldList((()=>[{no:2,name:"field_values",kind:"message",T:T,repeated:!0}]));class T extends s.Message{constructor(t){super(),this.fieldId=s.protoInt64.zero,s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new T).fromBinary(t,e)}static fromJson(t,e){return(new T).fromJson(t,e)}static fromJsonString(t,e){return(new T).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(T,t,e)}}T.runtime=s.proto3,T.typeName="structured_tags.SelectedStructuredTagField",T.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"field_id",kind:"scalar",T:4},{no:2,name:"field_value",kind:"message",T:_}]));class _ extends s.Message{constructor(t){super(),this.value={case:void 0},s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new _).fromBinary(t,e)}static fromJson(t,e){return(new _).fromJson(t,e)}static fromJsonString(t,e){return(new _).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(_,t,e)}}_.runtime=s.proto3,_.typeName="structured_tags.StructuredTagFieldValue",_.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"selection_id",kind:"scalar",T:4,oneof:"value"}]));class S extends s.Message{constructor(t){super(),s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new S).fromBinary(t,e)}static fromJson(t,e){return(new S).fromJson(t,e)}static fromJsonString(t,e){return(new S).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(S,t,e)}}S.runtime=s.proto3,S.typeName="structured_tags.GetAllStructuredTagTemplatesRequest",S.fields=s.proto3.util.newFieldList((()=>[]));class y extends s.Message{constructor(t){super(),this.templates=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new y).fromBinary(t,e)}static fromJson(t,e){return(new y).fromJson(t,e)}static fromJsonString(t,e){return(new y).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(y,t,e)}}y.runtime=s.proto3,y.typeName="structured_tags.GetAllStructuredTagTemplatesResponse",y.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"templates",kind:"message",T:p,repeated:!0}]));class w extends s.Message{constructor(t){super(),this.err={case:void 0},s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new w).fromBinary(t,e)}static fromJson(t,e){return(new w).fromJson(t,e)}static fromJsonString(t,e){return(new w).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(w,t,e)}}w.runtime=s.proto3,w.typeName="structured_tags.GetAllStructuredTagTemplatesError",w.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"message",kind:"message",T:s.Empty,oneof:"err"}]));class J extends s.Message{constructor(t){super(),s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new J).fromBinary(t,e)}static fromJson(t,e){return(new J).fromJson(t,e)}static fromJsonString(t,e){return(new J).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(J,t,e)}}J.runtime=s.proto3,J.typeName="structured_tags.CreateOrUpdateStructuredTagTemplateRequest",J.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"template",kind:"message",T:p}]));class v extends s.Message{constructor(t){super(),s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new v).fromBinary(t,e)}static fromJson(t,e){return(new v).fromJson(t,e)}static fromJsonString(t,e){return(new v).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(v,t,e)}}v.runtime=s.proto3,v.typeName="structured_tags.CreateOrUpdateStructuredTagTemplateResponse",v.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"template",kind:"message",T:p}]));class A extends s.Message{constructor(t){super(),this.err={case:void 0},s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new A).fromBinary(t,e)}static fromJson(t,e){return(new A).fromJson(t,e)}static fromJsonString(t,e){return(new A).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(A,t,e)}}A.runtime=s.proto3,A.typeName="structured_tags.CreateOrUpdateStructuredTagTemplateError",A.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"message",kind:"message",T:s.Empty,oneof:"err"}]));class h extends s.Message{constructor(t){super(),this.nsId=s.protoInt64.zero,this.nsPath="",s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new h).fromBinary(t,e)}static fromJson(t,e){return(new h).fromJson(t,e)}static fromJsonString(t,e){return(new h).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(h,t,e)}}h.runtime=s.proto3,h.typeName="structured_tags.ContentId",h.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"ns_id",kind:"scalar",T:3},{no:2,name:"ns_path",kind:"scalar",T:9}]));class E extends s.Message{constructor(t){super(),this.fieldValues=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new E).fromBinary(t,e)}static fromJson(t,e){return(new E).fromJson(t,e)}static fromJsonString(t,e){return(new E).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(E,t,e)}}E.runtime=s.proto3,E.typeName="structured_tags.SelectedStructuredTagObject",E.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"template",kind:"message",T:p},{no:2,name:"field_values",kind:"message",T:T,repeated:!0}]));class I extends s.Message{constructor(t){super(),this.selectedTags=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new I).fromBinary(t,e)}static fromJson(t,e){return(new I).fromJson(t,e)}static fromJsonString(t,e){return(new I).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(I,t,e)}}I.runtime=s.proto3,I.typeName="structured_tags.SelectedStructuredTagsForContent",I.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"content_id",kind:"message",T:h},{no:2,name:"selected_tags",kind:"message",T:E,repeated:!0}]));class N extends s.Message{constructor(t){super(),this.contentIds=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new N).fromBinary(t,e)}static fromJson(t,e){return(new N).fromJson(t,e)}static fromJsonString(t,e){return(new N).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(N,t,e)}}N.runtime=s.proto3,N.typeName="structured_tags.GetStructuredTagsByContentIdsRequest",N.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"content_ids",kind:"message",T:h,repeated:!0}]));class B extends s.Message{constructor(t){super(),this.result=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new B).fromBinary(t,e)}static fromJson(t,e){return(new B).fromJson(t,e)}static fromJsonString(t,e){return(new B).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(B,t,e)}}B.runtime=s.proto3,B.typeName="structured_tags.GetStructuredTagsByContentIdsResponse",B.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"result",kind:"message",T:I,repeated:!0}]));class L extends s.Message{constructor(t){super(),this.err={case:void 0},s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new L).fromBinary(t,e)}static fromJson(t,e){return(new L).fromJson(t,e)}static fromJsonString(t,e){return(new L).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(L,t,e)}}L.runtime=s.proto3,L.typeName="structured_tags.GetStructuredTagsByContentIdsError",L.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"permission_denied",kind:"message",T:s.Empty,oneof:"err"},{no:2,name:"invalid_arguments",kind:"message",T:s.Empty,oneof:"err"}]));class F extends s.Message{constructor(t){super(),this.templateId=s.protoInt64.zero,this.fieldValues=[],s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new F).fromBinary(t,e)}static fromJson(t,e){return(new F).fromJson(t,e)}static fromJsonString(t,e){return(new F).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(F,t,e)}}F.runtime=s.proto3,F.typeName="structured_tags.SetStructuredTagForContentIdRequest",F.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"content_id",kind:"message",T:h},{no:2,name:"template_id",kind:"scalar",T:4},{no:3,name:"field_values",kind:"message",T:T,repeated:!0}]));class C extends s.Message{constructor(t){super(),s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new C).fromBinary(t,e)}static fromJson(t,e){return(new C).fromJson(t,e)}static fromJsonString(t,e){return(new C).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(C,t,e)}}C.runtime=s.proto3,C.typeName="structured_tags.SetStructuredTagForContentIdResponse",C.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"result",kind:"message",T:E}]));class q extends s.Message{constructor(t){super(),this.err={case:void 0},s.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new q).fromBinary(t,e)}static fromJson(t,e){return(new q).fromJson(t,e)}static fromJsonString(t,e){return(new q).fromJsonString(t,e)}static equals(t,e){return s.proto3.util.equals(q,t,e)}}q.runtime=s.proto3,q.typeName="structured_tags.SetStructuredTagForContentIdError",q.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"permission_denied",kind:"message",T:s.Empty,oneof:"err"},{no:2,name:"invalid_arguments",kind:"message",T:s.Empty,oneof:"err"}]));const k=new class{getStructuredTagTemplates(){var t;return e.__awaiter(this,void 0,void 0,(function*(){const e=new r.DefaultUserApiV2Client(r.mustGetActiveUser());try{const r=yield e.ns("structured_tags").rpc("get_all_structured_tag_templates",{},{});return(null===(t=r.templates)||void 0===t?void 0:t.map((t=>G(t))))||[]}catch(t){return[]}}))}getStructuredTagsForFiles(t){return e.__awaiter(this,void 0,void 0,(function*(){const e=new r.DefaultUserApiV2Client(r.mustGetActiveUser());try{const r=yield e.ns("structured_tags").rpc("get_structured_tags_by_content_ids",{content_ids:t.map(n.createContentIdFromFile)},{});return r.result?M(r.result):{}}catch(t){return{}}}))}createOrUpdateStructuredTagTemplate(t){return e.__awaiter(this,void 0,void 0,(function*(){const e=new r.DefaultUserApiV2Client(r.mustGetActiveUser());try{const r=yield e.ns("structured_tags").rpc("create_or_update_structured_tag_template",{template:V(t)},{});return r.template?G(r.template):void 0}catch(t){return}}))}setStructuredTagForFile({file:t,tagData:s}){return e.__awaiter(this,void 0,void 0,(function*(){const e=new r.DefaultUserApiV2Client(r.mustGetActiveUser()),i=n.createContentIdFromFile(t),a={template_id:s.templateId,content_id:i,field_values:s.fieldValues.map((t=>{var e;return"selectionValues"===(null===(e=t.field)||void 0===e?void 0:e.values.case)?{field_id:Number(t.field.id),field_value:{".tag":"selection_id",selection_id:t.selectionValueId}}:{}}))},o=yield e.ns("structured_tags").rpc("set_structured_tag_for_content_id",a,{}),u=r.getFileObjectNsIdAndPathKey({nsId:i.ns_id,nsPath:i.ns_path});return o.result?{[u]:P([o.result])}:{}}))}},M=t=>t.reduce(((t,{content_id:e,selected_tags:s})=>Object.assign(Object.assign({},t),{[r.getFileObjectNsIdAndPathKey({nsId:e.ns_id,nsPath:e.ns_path})]:s?P(s):[]})),{}),P=t=>t.map((t=>{var e;return new E({template:G(t.template),fieldValues:null===(e=t.field_values)||void 0===e?void 0:e.map((t=>D(t)))})})),D=t=>t.field_value&&"selection_id"===t.field_value[".tag"]&&t.field_value.selection_id&&t.field_id?new T({fieldId:s.protoInt64.parse(t.field_id),fieldValue:{value:{value:s.protoInt64.parse(t.field_value.selection_id),case:"selectionId"}}}):new T,G=t=>new p({id:s.protoInt64.parse(t.id),name:t.name,isActivated:t.is_activated,isDeleted:t.is_deleted,type:x(t.type),fields:t.fields.map((t=>R(t))),lastModifiedTime:s.protoInt64.parse(t.last_modified_time)}),R=t=>{const e=new m({id:s.protoInt64.parse(t.id),name:t.name,isDeleted:t.is_deleted});return t.values&&"selection_values"===t.values[".tag"]&&(e.values={value:new c({values:t.values.values.map((t=>U(t)))}),case:"selectionValues"}),e},U=t=>new d({id:s.protoInt64.parse(t.id),name:t.name,color:O(t.color),isDeleted:t.is_deleted,description:t.description}),x=e=>"manual_classification"===e[".tag"]?t.TemplateType.MANUAL_CLASSIFICATION:t.TemplateType.MANAGED_METADATA,O=e=>"green"===e[".tag"]?t.StructuredTagColor.GREEN:"blue"===e[".tag"]?t.StructuredTagColor.BLUE:"yellow"===e[".tag"]?t.StructuredTagColor.YELLOW:"red"===e[".tag"]?t.StructuredTagColor.RED:t.StructuredTagColor.GRAY,V=t=>({id:Number(t.id),name:t.name,is_activated:t.isActivated,is_deleted:t.isDeleted,type:z(t.type),fields:t.fields.map((t=>b(t))),last_modified_time:Number(t.lastModifiedTime)}),b=t=>{const e={id:Number(t.id),name:t.name,is_deleted:t.isDeleted};return t.values&&"selectionValues"===t.values.case&&(e.values={".tag":"selection_values",values:t.values.value.values.map((t=>Y(t)))}),e},Y=t=>({id:Number(t.id),name:t.name,is_deleted:t.isDeleted,description:t.description,color:j(t.color)}),z=e=>e===t.TemplateType.MANUAL_CLASSIFICATION?{".tag":"manual_classification"}:{".tag":"managed_metadata"},j=e=>{switch(Number(e)){case t.StructuredTagColor.GREEN:return{".tag":"green"};case t.StructuredTagColor.BLUE:return{".tag":"blue"};case t.StructuredTagColor.YELLOW:return{".tag":"yellow"};case t.StructuredTagColor.RED:return{".tag":"red"};case t.StructuredTagColor.GRAY:return{".tag":"gray"};default:return{".tag":"other"}}};t.fetchStructuredTagsForFiles=({files:t})=>(r,s)=>e.__awaiter(void 0,void 0,void 0,(function*(){var n;"default"===(n=s(),o(n).status)&&r(((t,r)=>e.__awaiter(void 0,void 0,void 0,(function*(){t({type:i.ActionTypes.SET_STATUS,payload:{status:i.StructuredTagsNamespaceStatus.IS_LOADING}});const e=yield k.getStructuredTagTemplates();t({type:i.ActionTypes.SET_TEMPLATES,payload:{structuredTagTemplates:e}})}))));const a=yield k.getStructuredTagsForFiles(t);r({type:i.ActionTypes.SET_FILE_TO_STRUCTURED_TAGS_MAP,payload:{fileToTags:a}})})),t.selectStructuredTagsByFile=t=>o(t).fileToTags}));
//# sourceMappingURL=c_structured_tags_redux_action_creators.js-vflY78hs7.map
