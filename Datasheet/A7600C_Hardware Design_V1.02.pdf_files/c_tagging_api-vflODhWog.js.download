define(["exports","./c_tslib","./e_file_viewer_edison_shmodel_file_async"],(function(e,t,i){"use strict";function n(e){const t=i.getFileObjectNsIdAndPath(e);return{ns_id:t.nsId,ns_path:t.nsPath}}const a=e=>new Promise((t=>setTimeout(t,e)));const r=new class{getTags(e,a){return t.__awaiter(this,void 0,void 0,(function*(){const t=new i.DefaultUserApiV2Client(e),r={content_ids:a.map(n)};return(yield t.ns("manual_tagging").rpc("tags/get",r,{})).tags_by_content_id.reduce(((e,{content_id:{ns_id:t,ns_path:n},tags:a,typed_tags:r})=>(e[i.getFileObjectNsIdAndPathKey({nsId:t,nsPath:n})]=((e,t)=>t?t.filter(i.isTextTag):e.map((e=>({".tag":"user_generated_tag",tag_text:e}))))(a,r),e)),{})}))}getAllTags(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=new i.DefaultUserApiV2Client(e);return(yield t.ns("manual_tagging").rpc("tags/get_viewable_tags",void 0,{})).tag_and_counts.map((e=>e.typed_tag)).filter(i.isTextTag)}))}addTag(e,a,r){return t.__awaiter(this,void 0,void 0,(function*(){const t=new i.DefaultUserApiV2Client(e),o={tag:a,content_id:n(r)};return(yield t.ns("manual_tagging").rpc("tag/add",o,{})).hlc}))}addTagBulk(e,r,o){return t.__awaiter(this,void 0,void 0,(function*(){const l=new i.DefaultUserApiV2Client(e),d={tag:r,content_ids:o.map(n)},s=yield l.ns("manual_tagging").rpc("tag/add_bulk",d,{});if("complete"===s[".tag"])return s.failed;if("failed"===s[".tag"])throw new Error("tag/add_bulk failed");const{async_job_id:_}=s,g=()=>t.__awaiter(this,void 0,void 0,(function*(){return yield l.ns("manual_tagging").rpc("tag/add_bulk/check",{async_job_id:_},{})}));let c=yield g();for(;"in_progress"===c[".tag"];)yield a(1e3),c=yield g();if("failed"===c[".tag"]||"other"===c[".tag"])throw new Error("tag/add_bulk failed");return c.failed}))}removeTag(e,a,r){return t.__awaiter(this,void 0,void 0,(function*(){const t=new i.DefaultUserApiV2Client(e),o={tag:a,content_id:n(r)};return(yield t.ns("manual_tagging").rpc("tag/remove",o,{})).hlc}))}removeTagBulk(e,r,o){return t.__awaiter(this,void 0,void 0,(function*(){const l=new i.DefaultUserApiV2Client(e),d={tag:r,content_ids:o.map(n)},s=yield l.ns("manual_tagging").rpc("tag/remove_bulk",d,{});if("complete"===s[".tag"])return s.failed;if("failed"===s[".tag"])throw new Error("tag/remove_bulk failed");const{async_job_id:_}=s,g=()=>t.__awaiter(this,void 0,void 0,(function*(){return yield l.ns("manual_tagging").rpc("tag/remove_bulk/check",{async_job_id:_},{})}));let c=yield g();for(;"in_progress"===c[".tag"];)yield a(1e3),c=yield g();if("failed"===c[".tag"]||"other"===c[".tag"])throw new Error("tag/remove_bulk failed");return c.failed}))}listFolder(e,n){var a,r;return t.__awaiter(this,void 0,void 0,(function*(){try{"/"===e&&(e="");const t={fq_path:e,include_deleted:!1,sort_is_ascending:!1,sort_folders_first:!1,include_xattrs:!1,include_folder_overview:!1};let o=!1;const l=[],d=new i.DefaultUserApiV2Client(n);let s=yield d.ns("files").rpc("browse",t,{});for(null===(a=s.paginated_file_info)||void 0===a||a.forEach((e=>e.file_info&&l.push(e.file_info)));s.has_more;){if(l.length>700){o=!0;break}s=yield d.ns("files").rpc("browse_continue",{cursor:s.next_request_voucher},{}),null===(r=s.paginated_file_info)||void 0===r||r.forEach((e=>e.file_info&&l.push(e.file_info)))}return{files:l.map((e=>i.File.fromAnyFileObject(e))),reachedLimit:o}}catch(e){throw new Error("list_folder API error")}}))}};e.createContentIdFromFile=n,e.tagsApiClient=r}));
//# sourceMappingURL=c_tagging_api.js-vflcyWqOe.map
