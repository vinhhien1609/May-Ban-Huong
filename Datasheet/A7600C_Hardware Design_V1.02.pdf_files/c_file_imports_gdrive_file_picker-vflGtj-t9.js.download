define(["exports","./c_tslib","./e_core_exception","./c_core_exception_info","./e_file_viewer_edison_shmodel_file_async","react","./c_core_i18n"],(function(e,r,t,o,i,a,n){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}var s,c,d,p,u=l(a);!function(e){e.OpenGdriveFilePicker="OpenGdriveFilePicker"}(s||(s={})),e.FilePickerAction=void 0,(c=e.FilePickerAction||(e.FilePickerAction={})).PICKED="PICKED",c.CANCELED="CANCELED",e.FilePickerViewId=void 0,(d=e.FilePickerViewId||(e.FilePickerViewId={})).DOCS="all",d.FOLDERS="folders",function(e){e.IframeLoaded="IframeLoaded",e.FilePickerResult="FilePickerResult",e.SignInWithDifferentAccount="SignInWithDifferentAccount",e.UnhandledError="UnhandledError",e.UnhandledRejection="UnhandledRejection"}(p||(p={}));const f=(e,r,o)=>t.reportStack(r,{severity:e,tags:["FileImports"],exc_extra:o,silent:!1}),v={info:(e,r)=>f(o.SEVERITY.OPERATIONAL,e,r),warn:(e,r)=>f(o.SEVERITY.NONCRITICAL,e,r),error:(e,r)=>f(o.SEVERITY.CRITICAL,e,r),uncaught:(e,r)=>f(o.SEVERITY.UNCAUGHT,e,r)};i.injectInternalStyle("/static/metaserver/static/js/file_imports/gdrive/file_picker.module.out-vflUvIQdI.css",(e=>"._overlay_g01kv_1{background-color:var(--color__utility__overlay);height:100%;left:0;position:fixed;top:0;transition-delay:0;transition-duration:.333;transition-property:opacity;transition-timing-function:cubic-bezier(.66,0,0,1);width:100%;z-index:10001}"));const g="_overlay_g01kv_1",m=()=>n.intl.formatMessage({id:"h2PZeS",defaultMessage:"Google"}),_=()=>n.intl.formatMessage({id:"MDiUcD",defaultMessage:"Google Drive"}),E=()=>n.intl.formatMessage({id:"Ur1/IM",defaultMessage:"Microsoft"}),S=()=>n.intl.formatMessage({id:"rfdy2l",defaultMessage:"OneDrive"}),w=()=>n.intl.formatMessage({id:"dObY3n",defaultMessage:"Unknown"}),h=e=>{switch(e[".tag"]){case"gdrive":return _();case"onedrive":return S();case"other":break;default:i.enforceExhaustive(e)}return w()},x=e=>{switch(e[".tag"]){case"gdrive":return m();case"onedrive":return E();case"other":break;default:i.enforceExhaustive(e)}return w()};const b="browse",P=e=>{switch(e[".tag"]){case"gdrive":return"google_drive";case"onedrive":return"one_drive";case"other":break;default:i.enforceExhaustive(e)}},y=e=>{switch(e[".tag"]){case"gdrive":return"google_drive";case"onedrive":return"one_drive";case"other":break;default:i.enforceExhaustive(e)}},k=e=>{i.logEvent({class:"file_imports",action:"select",object:"try_again",properties:{actionSurface:b,externalProvider:y(e)}})},F={GotIt:()=>n.intl.formatMessage({id:"j8BdSl",defaultMessage:"Got it"}),TryAgain:()=>n.intl.formatMessage({id:"HImQBL",defaultMessage:"Try again"}),Cancel:()=>n.intl.formatMessage({id:"cp7jer",defaultMessage:"Cancel"}),CloseAriaLabel:()=>n.intl.formatMessage({id:"F4pNeQ",defaultMessage:"Close"}),ViewDetails:()=>n.intl.formatMessage({id:"YPmkDk",defaultMessage:"View details"}),HideDetails:()=>n.intl.formatMessage({id:"p8xGcP",defaultMessage:"Hide details"})},M=e=>n.intl.formatMessage({id:"ibOvmo",defaultMessage:"Couldnâ€™t get a response from {serviceProvider} servers"},{serviceProvider:x(e)}),C=e=>n.intl.formatMessage({id:"kL19SV",defaultMessage:"You can try again, or download your files and folders from {service} and drag them into Dropbox."},{service:h(e)}),A=({open:e,onRequestClose:r,supportedService:t,tryAgain:o})=>(a.useEffect((()=>{var e;e=t.importType,i.logEvent({class:"file_imports",action:"shown",object:"external_api_error",properties:{actionSurface:b,externalProvider:y(e)}})}),[t.importType]),u.default.createElement(i.Modal$1,{onRequestClose:r,open:e,isCentered:!0,withCloseButton:F.CloseAriaLabel()},u.default.createElement(i.Modal$1.Header,{hasBottomSpacing:"title-standard"},u.default.createElement(i.Modal$1.Title,null,M(t.importType))),u.default.createElement(i.Modal$1.Body,{hasVerticalSpacing:!1},u.default.createElement(i.Text,{tagName:"p"},C(t.importType))),u.default.createElement(i.Modal$1.Footer,null,u.default.createElement(i.Button,{variant:"opacity",onClick:r,autoFocus:!0},F.GotIt()),u.default.createElement(i.Button,{variant:"primary",autoFocus:!0,onClick:()=>{r(),o(),k(t.importType)}},F.TryAgain())))),I=(e,r)=>{i.Modal.showInstance(u.default.createElement(A,{supportedService:e,open:!0,onRequestClose:()=>i.Modal.close(),tryAgain:r}))},T={GDrive:{displayName:"Google Drive",importType:{".tag":"gdrive"},signinServiceDisplayName:"Google",profileServicesConstant:i.ProfileServicesConstants.GOOGLE,profileServicesApiServiceType:{".tag":"google"},defaultDestPath:"Google Drive",profileServicesAction:"link_read_files"},OneDrive:{displayName:"Microsoft OneDrive",importType:{".tag":"onedrive"},signinServiceDisplayName:"Microsoft",profileServicesConstant:i.ProfileServicesConstants.OUTLOOK,profileServicesApiServiceType:{".tag":"outlook"},defaultDestPath:"Microsoft OneDrive",profileServicesAction:"access_files_and_wiki"}},D=e=>r.__awaiter(void 0,void 0,void 0,(function*(){return new Promise((r=>setTimeout(r,e)))}));let j,O,L,N,G=null,R=()=>{},U="",V=()=>{};const B="https://file-imports.dropbox.com",$=e=>{var r;G&&(R(e),null===(r=G.parentNode)||void 0===r||r.removeChild(G),window.removeEventListener("message",N),G=null,R=()=>{})},q=t=>(N=o=>r.__awaiter(void 0,void 0,void 0,(function*(){var a;if(!G||o.origin!==B||o.source!==G.contentWindow||!(null===(a=o.data)||void 0===a?void 0:a.hasOwnProperty("eventType")))return;const n=o.data;switch(n.eventType){case p.IframeLoaded:(null==G?void 0:G.contentWindow)&&G.contentWindow.postMessage({eventType:s.OpenGdriveFilePicker,accessToken:U,views:j,rootId:O,title:L,hideSwitchAccountButton:!V,multiFileImportEnabled:t},B);break;case p.FilePickerResult:$(n.result);break;case p.SignInWithDifferentAccount:$({action:e.FilePickerAction.CANCELED}),null==V||V();break;case p.UnhandledError:v.warn(`Unhandled error in file picker iframe: ${n.error}`),yield r.__awaiter(void 0,void 0,void 0,(function*(){yield D(500),$({action:e.FilePickerAction.CANCELED}),yield D(50)}));I(T.GDrive,(()=>{Y(U,V,j,O,L,t)}));break;case p.UnhandledRejection:v.warn(`Unhandled rejection in file picker iframe: ${n.error}`);break;default:i.enforceExhaustive(n)}})),N),Y=(e,r,t,o,i,a)=>new Promise((n=>{if(G)throw new Error("File picker already open");U=e,V=r,R=n,j=t,O=o,L=i,G=document.createElement("iframe"),G.setAttribute("allowTransparency","true"),G.setAttribute("sandbox","allow-scripts allow-same-origin allow-modals"),G.setAttribute("src",B),G.setAttribute("frameBorder","0"),G.classList.add(g),document.body.appendChild(G),window.addEventListener("message",q(a))}));e.Buttons=F,e.FileImportsExclog=v,e.SupportedServices=T,e.getLocalizedLoginServiceName=x,e.getLocalizedServiceName=h,e.getSupportedService=e=>{switch(e[".tag"]){case"gdrive":return T.GDrive;case"onedrive":return T.OneDrive;case"other":break;default:i.enforceExhaustive(e)}throw new Error(`Bad import type: ${JSON.stringify(e)}`)},e.logCancelImportJob=e=>{i.logEvent({class:"file_imports",action:"cancel",object:"import_job",properties:{actionSurface:b,externalProvider:y(e)}})},e.logFailConnectExternalAccount=e=>{i.logEvent({class:"file_imports",action:"fail",object:"connect_external_account",properties:{actionSurface:b,externalProvider:P(e)}})},e.logPartialSucceedImportJob=({importType:e,srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:o,num4xxErrors:a,num5xxErrors:n,numOtherErrors:l,allErrorCounts:s})=>{i.logEvent({class:"file_imports",action:"partial_succeed",object:"import_job",properties:{actionSurface:b,externalProvider:y(e),srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:o,num_4xxErrors:a,num_5xxErrors:n,numOtherErrors:l,allErrorCounts:s}})},e.logSelectDeleteSource=e=>{i.logEvent({class:"file_imports",action:"select",object:"delete_source",properties:{actionSurface:b,externalProvider:y(e)}})},e.logSelectFolderStructure=e=>{i.logEvent({class:"file_imports",action:"select",object:"folder_structure",properties:{actionSurface:b,externalProvider:y(e)}})},e.logSelectOverquotaUpgrade=e=>{i.logEvent({class:"file_imports",action:"select",object:"overquota_upgrade",properties:{actionSurface:b,externalProvider:y(e)}})},e.logSelectOverwriteFiles=e=>{i.logEvent({class:"file_imports",action:"select",object:"overwrite_files",properties:{actionSurface:b,externalProvider:y(e)}})},e.logSelectTryAgain=k,e.logSelectViewDetails=e=>{i.logEvent({class:"file_imports",action:"select",object:"view_details",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownFailedCancel=e=>{i.logEvent({class:"file_imports",action:"shown",object:"failed_cancel",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownImportAlreadyRunning=e=>{i.logEvent({class:"file_imports",action:"shown",object:"import_already_running",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownImportOptions=e=>{i.logEvent({class:"file_imports",action:"shown",object:"import_options",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownNetworkError=e=>{i.logEvent({class:"file_imports",action:"shown",object:"network_error",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownNoFiles=e=>{i.logEvent({class:"file_imports",action:"shown",object:"no_files",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownOverquotaPrompt=e=>{i.logEvent({class:"file_imports",action:"shown",object:"overquota_prompt",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownPartialUpload=e=>{i.logEvent({class:"file_imports",action:"shown",object:"partial_upload",properties:{actionSurface:b,externalProvider:y(e)}})},e.logShownUnknownError=e=>{i.logEvent({class:"file_imports",action:"shown",object:"unknown_error",properties:{actionSurface:b,externalProvider:y(e)}})},e.logStartImportJob=e=>{i.logEvent({class:"file_imports",action:"start",object:"import_job",properties:{actionSurface:b,externalProvider:y(e)}})},e.logSucceedConnectExternalAccount=e=>{i.logEvent({class:"file_imports",action:"succeed",object:"connect_external_account",properties:{actionSurface:b,externalProvider:P(e)}})},e.logSucceedImportJob=({importType:e,srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:o,num4xxErrors:a})=>{i.logEvent({class:"file_imports",action:"succeed",object:"import_job",properties:{actionSurface:b,externalProvider:y(e),srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:o,num_4xxErrors:a}})},e.openGdriveFilePicker=Y,e.showExternalProviderApiErrorModal=I,e.sleep=D}));
//# sourceMappingURL=c_file_imports_gdrive_file_picker.js-vfl05P_PH.map
